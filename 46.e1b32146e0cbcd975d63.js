(self.webpackChunkaxidraw_web=self.webpackChunkaxidraw_web||[]).push([[46],{5374:function(e,t,n){"use strict";n.d(t,{G7:function(){return r},Hr:function(){return i},d4:function(){return o},Pz:function(){return a},x1:function(){return l},FP:function(){return s}});const r="\r",i="\r\n",o="\n\r",a="OK\r\n",l=1,s=2029},475:function(e,t,n){"use strict";n.d(t,{em:function(){return a.Z},qb:function(){return l.Z},r:function(){return s.Z},sm:function(){return c.Z},sp:function(){return u.Z},tp:function(){return d}});var r=n(848),i=n(5374);(0,r.fA)("A","Get analog values",(function*(){const e=yield"A\r",t=yield*(0,r.Tb)(i.Hr,e);return(0,r.F7)(t,(e=>e.trim().substr(2).split(",").reduce(((e,t)=>{const[n,i]=t.split(":");return{...e,[(0,r.Hq)(n)]:(0,r.Hq)(i)}}),{})))}),{version:"2.2.3"});var o=n(1980);(0,r.fA)("AC","Analog configure",(function*(e,t){const n=yield`AC,${[e,t].join(",")}\r`;return yield*(0,o.Z)(n)}),{version:"2.2.3"}),(0,r.fA)("BL","Enter bootloader",(function*(){const e=yield"BL\r";return yield*(0,o.Z)(e)}),{version:"1.9.5"}),(0,r.fA)("C","Configure pin direction",(function*(e,t,n,r,i){const a=yield`C,${[e,t,n,r,i].join(",")}\r`;return yield*(0,o.Z)(a)})),(0,r.fA)("CK","Check input",(function*(e,t,n,o,a,l,s,c){const u=yield`CK,${[e,t,n,o,a,l,s,c].join(",")}\r`,d=yield*(0,r.Tb)(i.Pz,u);return(0,r.F7)(d,(e=>e.substring(0,e.length-6).split(/\s+/).map(((e,t)=>{const n=e.split("=")[1];return t<6?(0,r.Hq)(n):n}))))})),(0,r.fA)("CS","Clear step position",(function*(){const e=yield"CS\r";return yield*(0,o.Z)(e)}),{version:"2.4.3"}),(0,r.fA)("CU","Configure user options",(function*(e,t){const n=yield`CU,${[e,t].join(",")}\r`;return yield*(0,o.Z)(n)}));var a=n(3326);(0,r.fA)("ES","E stop",(function*(e){const t=yield(0,r.iW)("ES",e),n=yield*(0,r.Tb)(i.Pz,t);return(0,r.F7)(n,(e=>{const t=e.substring(0,e.length-6).split(",").map(r.Hq);return{interrupted:t[0],axis1:{steps:t[1],remain:t[3]},axis2:{steps:t[2],remain:t[4]}}}))}),{version:"2.2.7"}),(0,r.fA)("HM","Home or absolute move",(function*(e,t,n){const i=yield(0,r.iW)(`HM,${e}`,t,n);return yield*(0,o.Z)(i)}),{execution:i.x1,version:"2.6.2"}),(0,r.fA)("I","Input (digital)",(function*(){const e=yield"I\r",t=yield*(0,r.Tb)(i.Hr,e);return(0,r.F7)(t,(e=>e.trim().substr(2).split(",").map(r.Hq)))})),(0,r.fA)("LM","Low-level move, step-limited",(function*(e,t,n,i,a,l,s){const c=yield(0,r.iW)(`LM,${[e,t,n,i,a,l].join(",")}`,s);return yield*(0,o.Z)(c)}),{execution:i.x1,version:"2.7.0"}),(0,r.fA)("LT","Low-level move, time-limited",(function*(e,t,n,i,a,l){const s=yield(0,r.iW)(`LT,${[e,t,n,i,a].join(",")}`,l);return yield*(0,o.Z)(s)}),{execution:i.x1,version:"2.7.0"}),(0,r.fA)("MR","Memory Read",(function*(e){const t=yield`MR,${e}\r`,n=yield*(0,r.Tb)(i.Hr,t);return(0,r.F7)(n,(e=>(0,r.Hq)(e.substr(3))))})),(0,r.fA)("MW","Memory Write",(function*(e,t){const n=yield`MW,${e},${t}\r`;return yield*(0,o.Z)(n)})),(0,r.fA)("ND","Node count decrement",(function*(){const e=yield"ND\r";return yield*(0,o.Z)(e)}),{version:"1.9.5"}),(0,r.fA)("NI","Node count increment",(function*(){const e=yield"NI\r";return yield*(0,o.Z)(e)}),{version:"1.9.5"}),(0,r.fA)("O","Output (digital)",(function*(e,t,n,i,a){const l=yield(0,r.iW)(`O,${e}`,t,n,i,a);return yield*(0,o.Z)(l)})),(0,r.fA)("PC","Pulse configure",(function*(e,t,n,i,a,l,s,c){const u=yield(0,r.iW)(`PC,${e},${t}`,n,i,a,l,s,c);return yield*(0,o.Z)(u)})),(0,r.fA)("PD","Pin direction",(function*(e,t,n){const r=yield`PD,${e},${t},${n}\r`;return yield*(0,o.Z)(r)})),(0,r.fA)("PG","Pulse go",(function*(e){const t=yield`PG,${e}\r`;return yield*(0,o.Z)(t)})),(0,r.fA)("PI","Pin input",(function*(e,t){const n=yield`PI,${e},${t}\r`,o=yield*(0,r.Tb)(i.Hr,n);return(0,r.F7)(o,(e=>(0,r.Hq)(e.substr(3))))})),(0,r.fA)("PO","Pin output",(function*(e,t,n){const r=yield`PO,${e},${t},${n}\r`;return yield*(0,o.Z)(r)}));var l=n(8315);(0,r.fA)("QC","Query current",(function*(){const e=yield"QC\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>{const t=e.substring(0,e.length-6).split(",").map((e=>((0,r.Hq)(e)/1023*3.3).toFixed(2)));return{ra0:{voltage:t[0],maxCurrent:(t[0]/1.76).toFixed(2)},vPlus:{voltage:(9.2*t[1]+.3).toFixed(2)}}}))}),{version:"2.2.3"}),(0,r.fA)("QE","Query motor enable",(function*(){const e=yield"QE\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>e.substring(0,e.length-6).split(",").map(r.Hq)))}),{version:"2.8.0"}),(0,r.fA)("QG","Query general",(function*(){const e=yield"QG\r",t=yield*(0,r.Tb)(i.Hr,e);return(0,r.F7)(t,(e=>{const t=(0,r.Hq)(e);return{fifo:(1&t)>0,mtr2:(2&t)>0,mtr1:(4&t)>0,cmd:(8&t)>0,pen:(16&t)>0,prg:(32&t)>0,rb2:(64&t)>0,rb5:(128&t)>0}}))}),{version:"2.6.2"}),(0,r.fA)("QL","Query layer",(function*(){const e=yield"QL\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.2"}),(0,r.fA)("QM","Query motors",(function*(){const e=yield"QM\r",t=yield*(0,r.Tb)(i.d4,e);return(0,r.F7)(t,(e=>{const t=e.trim().substr(3).split(",").map(r.Hq);return{command:t[0],motor1:t[1],motor2:t[2],fifo:t[3]}}))}),{version:"2.4.4"}),(0,r.fA)("QN","Query node count",(function*(){const e=yield"QN\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.2"}),(0,r.fA)("QP","Query pen",(function*(){const e=yield"QP\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.0"}),(0,r.fA)("QR","Query RC Servo power state",(function*(){const e=yield"QR\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"2.6.0"}),(0,r.fA)("QS","Query step position",(function*(){const e=yield"QS\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>{const t=e.substring(0,e.length-6).split(",").map(r.Hq);return{a1:t[0],a2:t[1]}}))}),{version:"2.4.3"}),(0,r.fA)("QT","Query EBB nickname tag",(function*(){const e=yield"QT\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>e.substring(0,e.length-6)))}),{version:"2.5.4"});var s=n(5707);(0,r.fA)("RB","Reboot",(function*(){return"RB\r"}),{version:"2.5.4"}),(0,r.fA)("S2","General RC Servo output",(function*(e,t,n,i){const a=yield(0,r.iW)(`S2,${e},${t}`,n,i);return yield*(0,o.Z)(a)}),{execution:i.x1,version:"2.2.0"}),(0,r.fA)("SC","Stepper and Servo mode configure",(function*(e,t){const n=yield`SC,${e},${t}\r`;return yield*(0,o.Z)(n)})),(0,r.fA)("SE","Set engraver",(function*(e,t,n){const i=yield(0,r.iW)(`SE,${e}`,t,n);return yield*(0,o.Z)(i)}),{execution:i.x1,version:"2.1.0"}),(0,r.fA)("SL","Set layer",(function*(e){const t=yield`SL,${e}\r`;return yield*(0,o.Z)(t)}),{version:"1.9.2"});var c=n(1632);(0,r.fA)("SN","Set node count",(function*(e){const t=yield`SN,${e}\r`;return yield*(0,o.Z)(t)}),{version:"1.9.5"});var u=n(1519);(0,r.fA)("SR","Set RC Servo power timeout",(function*(e,t){const n=yield(0,r.iW)(`SR,${e}`,t);return yield*(0,o.Z)(n)}),{version:"2.6.0"}),(0,r.fA)("ST","Set EBB nickname tag",(function*(e){const t=yield`ST,${e}\r`;return yield*(0,o.Z)(t)}),{version:"2.5.5"}),(0,r.fA)("T","Timed analog/digital read",(function*(e,t){const n=yield`T,${e},${t}\r`;return yield*(0,o.Z)(n)}));var d=(0,r.fA)("TP","Toggle pen",(function*(e){const t=yield(0,r.iW)("TP",e);return yield*(0,o.Z)(t)}),{version:"1.9.0"});n(2206),(0,r.fA)("XM","Stepper move, mixed-axis geometries",(function*(e,t,n){const r=yield`XM,${e},${t},${n}\r`;return yield*(0,o.Z)(r)}),{execution:i.x1,version:"2.3.0"})},9046:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Bn}});var r=n(7294),i=(n.p,n(5697)),o=n.n(i),a=n(1275);const l=e=>96/25.4*e,s=e=>e/96*25.4,c=(0,r.createContext)();c.displayName="Plotter Context";var u=c;const d=e=>t=>{t.preventDefault(),null==e||e(t)};var p=n(4184),f=n.n(p),m=n(3379),h=n.n(m),g=n(7795),y=n.n(g),v=n(695),b=n.n(v),w=n(9216),x=n.n(w),E=n(306),C={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};C.domAPI=y(),C.insertStyleElement=x(),h()(E.Z,C);var S=E.Z&&E.Z.locals?E.Z.locals:void 0;function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const P=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),i=l(n.width),o=l(n.height),a=l(n.padding),[s,c]=(0,r.useState)(!1);return r.createElement("g",A({onDragOver:d(),onDragEnter:d((()=>c(!0))),onDragLeave:d((()=>c(!1))),onDrop:d((e=>{if(c(!1),!e.dataTransfer.files.length)return;const n=Array.from(e.dataTransfer.files).find((e=>"image/svg+xml"===e.type));n?t.loadFromFile(n):alert("Only SVG files are supported.")}))},e),r.createElement("rect",{className:S.shadow,width:i,height:o,filter:"url(#svgShadow)"}),r.createElement("rect",{className:f()(S.paper,{[S.dropping]:s}),width:i,height:o}),r.createElement("rect",{className:S.printable,width:i-2*a,height:o-2*a,x:a,y:a}))}));P.propTypes={};var $=P,T=n(518),M={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};M.domAPI=y(),M.insertStyleElement=x(),h()(T.Z,M);var Z=T.Z&&T.Z.locals?T.Z.locals:void 0;const k=({margin:e})=>{const t=l(e);return r.createElement("filter",{id:"svgShadow"},r.createElement("feOffset",{id:"svgOffset0",result:"svgOffset0",in:"SourceAlpha",dy:"0",dx:"0"}),r.createElement("feGaussianBlur",{id:"svgBlur0",result:"svgBlur0",in:"svgOffset0",stdDeviation:`${t/4} ${t/4}`}),r.createElement("feBlend",{id:"svgBlend0",result:"svgBlend0",in:"SourceGraphic",in2:"svgBlur0"}))};k.propTypes={margin:o().number};var N=k,F=n(5901);const O=n.n(F)().get("plotter");function*z(e){for(const t of e.children){const e=t.nodeName;switch(e){case"svg":case"g":case"a":yield*z(t);break;case"rect":case"circle":case"ellipse":case"line":case"polyline":case"polygon":case"path":yield{action:"count",el:t,type:e};break;default:yield{action:"discard",el:t,type:e}}}}function L(e){const t={},n=[];for(const r of z(e))switch(r.action){case"count":t[r.type]=(t[r.type]||0)+1;break;case"discard":default:t[r.action]=(t[r.action]||0)+1,O.debug(`Unsupported element type: ${r.type}`),n.push(r.el)}for(const e of n)e.remove();return{counts:t}}const D=([e,t],{a:n,b:r,c:i,d:o,e:a,f:l})=>[n*e+i*t+a,r*e+o*t+l],_=(e,t,n)=>{const[r,i]=D(e,n),[o,a]=D(t,n);return[r,i,o,a]},I=(e,t,n,r)=>Math.atan2(e*r-t*n,e*n+t*r),H=(e,t,n,r)=>[(e+n)/2,(t+r)/2],R=([e,t],[n,r],[i,o])=>[[e+2*(n-e)/3,t+2*(r-t)/3],[i+2*(n-i)/3,o+2*(r-o)/3]];function*Q(e,t,n,r){if(!e||"A"!==e[0])throw new Error(`invalid arc: ${e}`);const{cos:i,sin:o,PI:a}=Math,[l,s]=t;let[c,u,d,p,f,m,[h,g]]=e;if(0===u||0===d){const e=[h,g];return yield _(t,e,n),e}u=Math.abs(u),d=Math.abs(d);const y=p*Math.PI/180,v=i(y),b=o(y),w=new DOMMatrix([v,-b,b,v,0,0]),[x,E]=D([(l-h)/2,(s-g)/2],w);let C=u*u,S=d*d;const A=x*x,P=E*E,$=A/C+P/S;if($>1){const e=Math.sqrt($);u*=e,d*=e,C=u*u,S=d*d}let T=(C*S-C*P-S*A)/(C*P+S*A);T<0&&(T=0);const M=f===m?-1:1,Z=Math.sqrt(T),k=M*Z*u*E/d,N=-M*Z*d*x/u,F=new DOMMatrix([v,b,-b,v,0,0]),[O,z]=D([k,N],F),L=O+(l+h)/2,H=z+(s+g)/2,R=(x-k)/u,Q=(E-N)/d,j=(-x-k)/u,q=(-E-N)/d,B=I(1,0,R,Q),V=2*a,U=I(R,Q,j,q)%V;let W=U;0===m&&U>0&&(W-=V),1===m&&U<0&&(W+=V);const{maxError:G}=r,X=new DOMMatrix([n.a,n.b,n.c,n.d,0,0]);return yield*function*e(t,r,a,l,s,c){const p=(t+r)/2,[f,m]=D([u*i(p),d*o(p)],F),h=f+L,g=m+H,y=((e,t,n,r,i,o)=>Math.abs(n*(o-t)-r*(i-e)+i*t-e*o)/Math.sqrt((i-e)**2+(o-t)**2))(a,l,h,g,s,c),[v,b]=D([y,0],X);v*v+b*b<=G*G?yield _([a,l],[s,c],n):(yield*e(t,p,a,l,h,g),yield*e(p,r,h,g,s,c))}(B,B+W,l,s,h,g),[h,g]}function*j(e,t,n,r){if(!e||"C"!==e[0])throw new Error(`invalid bezier: ${e}`);const[i,o]=t,[a,[l,s],[c,u],[d,p]]=e,{maxError:f}=r,m=n.inverse(),h=new DOMMatrix([m.a,m.b,m.c,m.d,0,0]),[g,y]=D([f,0],h),v=g*g+y*y;return yield*function*e(t,r,i,o,a,l,s,c){if(((e,t,n,r,i,o,a,l,s)=>{let c=(3*n-2*e-a)**2,u=(3*r-2*t-l)**2;const d=(3*i-2*a-e)**2,p=(3*o-2*l-t)**2;return c<d&&(c=d),u<p&&(u=p),c+u<=16*s})(t,r,i,o,a,l,s,c,v))yield _([t,r],[s,c],n);else{const[n,u]=[t,r],[d,p]=[s,c],[f,m]=H(n,u,i,o),[h,g]=H(i,o,a,l),[y,v]=H(f,m,h,g),[b,w]=H(a,l,d,p),[x,E]=H(h,g,b,w),[C,S]=H(y,v,x,E),[A,P]=[C,S];yield*e(n,u,f,m,y,v,C,S),yield*e(A,P,x,E,b,w,d,p)}}(i,o,l,s,c,u,d,p),[d,p]}const q=(e,t)=>({type:e,execute:t}),B=(e,t,n,r,i)=>{const o=e.toUpperCase(),a=e===o;if(a||!n.toAbsolute)return r(t,n,a),[e,...t];const l=i(t,n);return r(l,n,!0),[o,...l]},V=(e,t)=>{const n=[...e],[r,i]=n[n.length-1];return n[n.length-1]=[r+t.x,i+t.y],n},U=([e],t)=>[e+t.x],W=([e],t)=>[e+t.y],G=(e,t)=>e.map((([e,n])=>[e+t.x,n+t.y])),X=(e,t,n)=>{n?t.x=e[0]:t.x+=e[0]},Y=(e,t,n)=>{n?t.y=e[0]:t.y+=e[0]},K=(e,t,n)=>{const r=e[e.length-1];n?(t.x=r[0],t.y=r[1]):(t.x+=r[0],t.y+=r[1])};var J=q("L",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,[e],t,K,V)})),ee=q("M",(function*(e,t){const[n,r,...i]=e;yield B(n,[r],t,((...e)=>{K(...e),((e,t)=>{var n,r;t.startX=null!==(n=t.x)&&void 0!==n?n:0,t.startY=null!==(r=t.y)&&void 0!==r?r:0})(...e)}),V),i.length&&(yield*J.execute([{M:"L",m:"l"}[n],...i],t))})),te=q("H",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,[e],t,X,U)})),ne=q("V",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,[e],t,Y,W)})),re=q("C",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,e,t,K,G)})),ie=q("S",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,e,t,K,G)})),oe=q("Q",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,e,t,K,G)})),ae=q("T",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,[e],t,K,V)})),le=q("A",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,e,t,K,V)})),se=q("Z",(function*(e,t){((e,t)=>{var n,r;t.x=null!==(n=t.startX)&&void 0!==n?n:0,t.y=null!==(r=t.startY)&&void 0!==r?r:0})(0,t),yield[t.isAbsolute?"Z":e[0]]}));const ce={},ue=(...e)=>{const t=e.reduce(((e,t)=>e+t.source),"");return new RegExp(t)},de=(...e)=>{const t=e.map((e=>e.source)).join("|");return new RegExp(`(?:${t})`)},pe=e=>new RegExp(`(?:${e.source})?`),fe=(e,...t)=>function(n,r=0){const i=t.reduce((function(e,t){const r=t(n,e.idx);return e.idx=r.idx,e.values.push(r.value),e}),{idx:r,values:[]});return{idx:i.idx,value:e(...i.values)}},me=e=>{const t=new RegExp((null==e?void 0:e.source)||"","y");return function(e,n=0){t.lastIndex=n;const r=t.exec(e);if(!r)throw ce;const i=r[0];return{idx:t.lastIndex,value:i}}},he=(e,t=null)=>function(n,r){try{return e(n,r)}catch(e){if(e===ce)return{idx:r,value:t};throw e}},ge=/\s/,ye=new RegExp(`(?:${ge.source})*`),ve=me(ye),be=new RegExp(`(?:${ge.source})+`),we=/\d+/,xe=/[+-]/,Ee=ue(/[Ee]/,pe(xe),we),Ce=/\./,Se=de(ue(pe(we),Ce,we),ue(we,Ce)),Ae=de(ue(Se,pe(Ee)),ue(we,Ee)),Pe=we,$e=/,/,Te=de(ue(be,pe($e),ye),ue($e,ye)),Me=me(Te),Ze=me(pe(Te)),ke=fe((e=>parseInt(e,10)),me(/[01]/)),Ne=fe((e=>parseFloat(e)),me(de(Ae,Pe))),Fe=fe((e=>parseFloat(e)),me(ue(pe(xe),de(Ae,Pe)))),Oe=Fe,ze=fe((function(e,t,n){return[e,n]}),Oe,Ze,Oe),Le=(e,t=Ze)=>{return fe((function(e,t){return[e,...t]}),e,(n=fe((function(e,t){return t}),t,e),function(e,t=0){const r=[];let i=t;for(;;)try{const t=n(e,i);r.push(t.value),i=t.idx}catch(e){if(e===ce)break;throw e}return{idx:i,value:r}}));var n},De=Le(ze),_e=(e,t)=>fe((function(e,t,n){return[e,...n]}),e,ve,t),Ie=_e(me(/[Mm]/),De),He=_e(me(/[Ll]/),De),Re=fe((e=>[e]),me(/[Zz]/)),Qe=Le(Oe),je=_e(me(/[Hh]/),Qe),qe=_e(me(/[Vv]/),Qe),Be=Le(fe(((e,t,n,r,i)=>[e,n,i]),ze,Ze,ze,Ze,ze)),Ve=_e(me(/[Cc]/),Be),Ue=Le(fe(((e,t,n)=>[e,n]),ze,Ze,ze)),We=_e(me(/[Ss]/),Ue),Ge=_e(me(/[Qq]/),Ue),Xe=_e(me(/[Tt]/),De),Ye=Le(fe(((e,t,n,r,i,o,a,l,s,c,u)=>[e,n,i,a,s,u]),Ne,Ze,Ne,Ze,Fe,Me,ke,Ze,ke,Ze,ze)),Ke=_e(me(/[Aa]/),Ye);var Je;const et=Le((Je={Z:Re,L:He,H:je,V:qe,C:Ve,S:We,Q:Ge,T:Xe,A:Ke},function(e,t=0){const n=e[t],r=Je[null==n?void 0:n.toUpperCase()];if(!r)throw ce;return r(e,t)}),ve),tt=Le(fe((function(e,t,n){return[e,...n||[]]}),Ie,ve,he(et)),ve),nt=fe((function(e,t){return(null==t?void 0:t.flatMap((e=>e)))||null}),ve,he(tt),ve),rt={M:ee,L:J,H:te,V:ne,C:re,S:ie,Q:oe,T:ae,A:le,Z:se};function*it(e,t){const n=e.getAttribute("d");if(!n)return;const r=e.getCTM();let i,o,a,l=[0,0];for(const e of function*(e="M 0 0",t=!0){const n={x:0,y:0,startX:0,startY:0,toAbsolute:t};for(const t of((e="")=>{if(!e)return[];const t=nt(e);if(!t.value)throw new Error("Invalid svg path.");return t.value})(e)){const e=rt[t[0].toUpperCase()];yield*e.execute(t,n)}}(n))switch(e[0]){case"M":l=e[1],o=l;break;case"L":i=e[1],yield _(l,i,r),l=i;break;case"H":i=[e[1],l[1]],yield _(l,i,r),l=i;break;case"V":i=[l[0],e[1]],yield _(l,i,r),l=i;break;case"Q":{const n=["C",...R(l,e[1],e[2]),e[2]];l=yield*j(n,l,r,t),a=e}break;case"T":{if(!a||"Q"!==a[0]&&"T"!==a[0])throw new Error("invalid T command can only follow by Q or T.");const n=2*l[0]-a[1][0],i=2*l[1]-a[1][1],o=["C",...R(l,[n,i],e[1]),e[1]];l=yield*j(o,l,r,t),a=["Q",[n,i],e[1]]}break;case"C":{const n=e;l=yield*j(n,l,r,t),a=n}break;case"S":{if(!a)throw new Error(`invalid S command: ${e}`);let n,i;switch(a[0]){case"C":[n,i]=a[2];break;case"S":[n,i]=a[1];break;default:throw new Error("invalid S command can only follow by C or S.")}const o=["C",[2*l[0]-n,2*l[1]-i],e[1],e[2]];l=yield*j(o,l,r,t),a=e}break;case"A":l=yield*Q(e,l,r,t);break;case"Z":o&&(yield _(l,o,r),l=o)}}const ot=(e,t)=>{var n,r;return null!==(n=null===(r=e[t])||void 0===r?void 0:r.baseVal.value)&&void 0!==n?n:0};function*at(e,t){switch(e.nodeName){case"rect":case"circle":case"ellipse":yield*function*(e,t){let n="";switch(e.nodeName){case"rect":{let t=ot(e,"width"),r=ot(e,"height");const i=ot(e,"x"),o=ot(e,"y");let a=ot(e,"rx"),l=ot(e,"ry");a=Math.min(a,t/2),l=Math.min(l,r/2),0===a||0===l?n+=`M${i} ${o} v${r} h${t} v${-r} h${-t}`:(t-=2*a,r-=2*l,n+=`M${i} ${o+l}v${r} a${a} ${l} 0 0 0 ${a} ${l} h${t} a${a} ${l} 0 0 0 ${a} ${-l} v${-t} a${a} ${l} 0 0 0 ${-a} ${-l} h`+-t+`a${a} ${l} 0 0 0 ${-a} ${l} `)}break;case"circle":case"ellipse":{const t=ot(e,"cx"),r=ot(e,"cy"),i=ot(e,"r"),o="circle"===e.nodeName?i:ot(e,"rx"),a="circle"===e.nodeName?i:ot(e,"ry");if(0===o||0===a)return;n+=`M${t} ${r-a}a${o} ${a} 0 0 0 0 ${2*a}a${o} ${a} 0 0 0 0 ${2*-a}`}}const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",n),r.getCTM=()=>e.getCTM(),yield*it(r,t)}(e,t);break;case"line":case"polyline":case"polygon":yield*function*(e,t){const n=e.getCTM();switch(e.nodeName){case"line":{const t=[ot(e,"x1"),ot(e,"y1")],r=[ot(e,"x2"),ot(e,"y2")];return void(yield _(t,r,n))}case"polyline":case"polygon":{const{points:t}=e,r=t.length;for(let e=0;e<r-1;e+=1){const r=t[e],i=t[e+1];yield _([r.x,r.y],[i.x,i.y],n)}if("polygon"===e.nodeName){const e=t[r-1],i=t[0];yield _([e.x,e.y],[i.x,i.y],n)}}}}(e);break;case"path":yield*it(e,t)}}function*lt(e,t){for(const n of e.children)switch(n.nodeName){case"svg":case"g":case"a":yield*lt(n,t);break;case"rect":case"circle":case"ellipse":case"line":case"polyline":case"polygon":case"path":yield*at(n,t);break;default:O.info(`unsupported type: ${n.nodeName}`)}}const st={maxError:l(.1)};var ct=n(2849),ut={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};ut.domAPI=y(),ut.insertStyleElement=x(),h()(ct.Z,ut);var dt=ct.Z&&ct.Z.locals?ct.Z.locals:void 0,pt=n(8949);const ft=e=>(e[0]-e[2])**2+(e[1]-e[3])**2,mt=([e,t],[n,r],[i,o])=>Math.abs(e*(o-r)-t*(i-n)+i*r-n*o)/Math.sqrt((i-n)**2+(o-r)**2);function*ht(e,t,n){if(!e||0===e.length)return{skip:0};const{connectedError:r}=n;if(1===e.length)return yield{line:t(e[0]),pen:0},{skip:1};const i=l(r**2),o=[];let a=0,s=null;for(let t=e.length;a<t-1;a+=1){const t=e[a],n=e[a+1];s=[t[2],t[3],n[0],n[1]],o.push(t);const r=ft(s);if(r>i)break;r>0&&o.push(s),s=null}const c=((e,t)=>{if(null==e||!e.length)return{lines:[]};if(1===e.length)return{lines:e};const n=l(t.flatLineError);if(!n)return{lines:e};const r=e.map((e=>[e[0],e[1]])),i=e[e.length-1];return r.push([i[2],i[3]]),[...function*e(t,i){if(t>=i)return;const o=r[t],a=r[i];let l=-1,s=Number.MIN_VALUE;const c=o[0]===a[0]&&o[1]===a[1]?[a[0]+1,a[1]]:a;for(let e=t+1;e<i;e+=1){const t=mt(r[e],o,c);t>s&&(l=e,s=t)}if(s>n)yield*e(t,l),yield*e(l,i);else{const e=i-t-1,n=[...o,...a];yield{reduced:e,line:n}}}(0,r.length-1)].reduce(((e,t)=>{var n;return e.lines.push(t.line),e.reduced+=null!==(n=t.reduced)&&void 0!==n?n:0,e}),{lines:[],reduced:0})})(o,n);for(const e of c.lines)yield{line:t(e),pen:0};return s?(yield{line:t(s),pen:1},{skip:a+1,reduced:c.reduced}):{skip:a,reduced:c.reduced}}function*gt(e,t){if(!e||!e.length)return;const{screenToPageMatrix:n,origin:r}=t,i={x:r[0],y:r[1],pen:1},o=e=>_([e[0],e[1]],[e[2],e[3]],n),a=e[0];yield{line:o([i.x,i.y,a[0],a[1]]),pen:1};const s=l(t.planAhead);let c=0;for(let n=0,r=e.length;n<r;){var u;const r=[e[n]];let i=0,a=1;for(;i<s;){const t=e[n+a];if(!t)break;i+=(d=t,Math.sqrt((d[0]-d[2])**2+(d[1]-d[3])**2)),r.push(t),a+=1}const l=yield*ht(r,o,t);n+=l.skip,c+=null!==(u=l.reduced)&&void 0!==u?u:0}var d;O.info(`Reduced lines ${c}`);const p=e[e.length-1];i.x=p[2],i.y=p[3],yield{line:o([i.x,i.y,r[0],r[1]]),pen:1}}const yt={connectedError:.2,planAhead:10,flatLineError:.1},vt=e=>{const t={x:0,y:0};return e?e.reduce(((e,n)=>(n[0]===t.x&&n[1]===t.y?e.push(`${n[2]} ${n[3]}`):e.push(`M ${n[0]} ${n[1]} ${n[2]} ${n[3]}`),t.x=n[2],t.y=n[3],e)),["M 0 0"]).join(" "):"M 0 0"},bt="axidraw-web-planning-phase-setup",wt="axidraw-web-planning-phase-planning",xt="axidraw-web-planning-phase-plotting";function Et(){return(Et=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Ct=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),i=(0,r.useRef)(null),o=l(n.padding),a=l(n.width),s=l(n.height),{contentFitPage:c,contentPreserveAspectRatio:d}=n;return(0,r.useLayoutEffect)((()=>{const e=i.current,n=null==e?void 0:e.children[0];if(!n)return;if(!n.hasAttribute("data-cleaned")){const e=L(n);t.updateFileInfo(e.counts),n.setAttribute("data-cleaned",!0)}if(!n.hasAttribute("data-original-viewBox")){const e=n.getAttribute("viewBox");n.setAttribute("data-original-viewBox",e)}n.setAttribute("width",a-2*o),n.setAttribute("height",s-2*o),n.setAttribute("x",o),n.setAttribute("y",o),n.setAttribute("preserveAspectRatio",d);const r=n.getAttribute("data-original-viewBox"),l=n.getBBox();n.setAttribute("viewBox",c?`${l.x} ${l.y} ${l.width} ${l.height}`:r)}),[n.size,n.padding,n.orientation,n.alignment.vertical,n.alignment.horizontal,n.contentFitPage,t.svgContent]),(0,r.useLayoutEffect)((()=>{if(t.phase===wt){const e=i.current,n=null==e?void 0:e.children[0];if(!n)return;t.updateLines([...lt(n,{...st})])}}),[t.phase]),r.createElement("g",Et({className:f()(dt.root,t.phase===bt?"block":"hidden"),dangerouslySetInnerHTML:{__html:t.svgContent},ref:i},e))}));Ct.propTypes={};var St=Ct,At=n(3273),Pt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Pt.domAPI=y(),Pt.insertStyleElement=x(),h()(At.Z,Pt);var $t=At.Z&&At.Z.locals?At.Z.locals:void 0;function Tt(){return(Tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Mt=(0,a.Pi)((({strokeWidth:e,...t})=>{const{planning:n,page:i}=(0,r.useContext)(u),o=s(1);return r.createElement("g",Tt({className:f()($t.root,n.phase===wt||n.phase===xt?"block":"hidden"),style:{"--planning-stroke-width":e*o+"%"},transform:i.pageToScreenMatrix.toString()},t),r.createElement("path",{className:$t.motionPenUp,d:n.connectionsAsPathDef}),r.createElement("path",{className:$t.motionPenDown,d:n.linesAsPathDef}))}));Mt.propTypes={strokeWidth:o().number};var Zt=Mt,kt=n(9930),Nt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Nt.domAPI=y(),Nt.insertStyleElement=x(),h()(kt.Z,Nt);var Ft=kt.Z&&kt.Z.locals?kt.Z.locals:void 0;const Ot="axidraw-web-page-orientation-landscape",zt="axidraw-web-page-orientation-portrait",Lt="axidraw-web-page-alignment-vertical-center",Dt="axidraw-web-page-alignment-vertical-top",_t="axidraw-web-page-alignment-vertical-bottom",It="axidraw-web-page-alignment-horizontal-center",Ht="axidraw-web-page-alignment-horizontal-start",Rt="axidraw-web-page-alignment-horizontal-end",Qt=[{type:"axidraw-web-page-size-a4",alias:"A4 (297mm x 210mm)",width:297,height:210,defaultPadding:15},{type:"axidraw-web-page-size-a5",alias:"A5 (210mm x 148mm)",width:210,height:148,defaultPadding:10},{type:"axidraw-web-page-size-a6",alias:"A6 (148mm x 105mm)",width:148,height:105,defaultPadding:5}],jt=Qt[0];function qt(){return(qt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Bt=(0,a.Pi)((({...e})=>{const{page:t}=(0,r.useContext)(u);return r.createElement("g",qt({className:Ft.root,transform:t.orientation===zt?`translate(${l(t.width)},0) rotate(90) `:null},e),r.createElement("polyline",{className:f()(Ft.axis,Ft.x),points:`0,0 ${l(10)},0 ${l(8)},${l(-2)}`}),r.createElement("polyline",{className:f()(Ft.axis,Ft.y),points:`0,0 0,${l(10)} ${l(-2)},${l(8)}`}),r.createElement("circle",{className:Ft.z,r:l(2),cx:"0",cy:"0"}))}));Bt.propTypes={};var Vt=Bt;const Ut=(0,a.Pi)((({margin:e=20})=>{const{page:t,planning:n}=(0,r.useContext)(u),i=l(e),o=`${-i} ${-i} ${l(t.width)+2*i} ${l(t.height)+2*i}`,a=(0,r.useRef)(null),[s,c]=(0,r.useState)(1);return(0,r.useLayoutEffect)((()=>{c(l(n.previewStrokeWidth)/(e=>{const{width:t,height:n}=e.baseVal;return Math.sqrt(t**2+n**2)/Math.sqrt(2)})(a.current.viewBox)*100)}),[o,n.previewStrokeWidth]),r.createElement("svg",{className:Z.root,viewBox:o,preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",ref:a},r.createElement("defs",null,r.createElement(N,{margin:e})),r.createElement($,null),r.createElement(St,null),r.createElement(Zt,{strokeWidth:s}),r.createElement(Vt,null))}));Ut.propTypes={margin:o().number};var Wt=Ut,Gt=n(4697),Xt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Xt.domAPI=y(),Xt.insertStyleElement=x(),h()(Gt.Z,Xt);var Yt=Gt.Z&&Gt.Z.locals?Gt.Z.locals:void 0,Kt=n(475),Jt=n(5374);const en=({x:e,y:t},n=1)=>{const r=Jt.FP/2**(n-1)/25.4;return(({x:e,y:t})=>({a1:e+t,a2:e-t}))({x:r*e|0,y:r*t|0})};var tn=n(9062);const nn="axidraw-web-plotter-status-standby",rn="axidraw-web-plotter-status-paused",on="axidraw-web-plotter-status-plotting",an="axidraw-web-plotter-action-pause",ln="axidraw-web-plotter-action-stop",sn={x:0,y:0,a1:0,a2:0,pen:1};function*cn({t:e,stepLong:t,stepShort:n}){const r=Math.abs(n),i=1310*r,o=Math.sign(n),a=Math.floor((e-i)/(r+1)),l=t/e,s=Math.floor(l*a),c=Math.floor(1310*l);let u=e,d=t;for(let e=0,t=2*r+1;e<t;e+=1)e%2==0?a>0&&(yield{time:a,longStep:s,shortStep:0},u-=a,d-=s):(yield{time:1310,longStep:c,shortStep:o},u-=1310,d-=c);d>0&&(yield{time:Math.max(1,u),longStep:d,shortStep:0})}var un=n(2105),dn=n(2221),pn=n(5589),fn=n(7446),mn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};mn.domAPI=y(),mn.insertStyleElement=x(),h()(fn.Z,mn);var hn=fn.Z&&fn.Z.locals?fn.Z.locals:void 0;function gn(){return(gn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const yn=({active:e,children:t,...n})=>r.createElement("div",gn({className:f()(hn.root,e?hn.active:"")},n),t);yn.propTypes={active:o().bool,children:o().node};var vn=yn,bn=n(3848),wn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};wn.domAPI=y(),wn.insertStyleElement=x(),h()(bn.Z,wn);var xn=bn.Z&&bn.Z.locals?bn.Z.locals:void 0;const En=(0,n(6010).f)("plotter");function Cn(){return(Cn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Sn=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),i=(0,r.useRef)(null);return r.createElement(vn,Cn({active:t.phase===bt},e),r.createElement("section",null,r.createElement("h3",null,"Setup"),r.createElement("p",null,"In this phase, you could load svg and set up the page."),r.createElement("div",{className:"flex my-4 justify-center"},r.createElement("input",{className:"hidden",type:"file",accept:"image/svg+xml",ref:i,onChange:async e=>{const{files:n}=e.target;n.length&&t.loadFromFile(n[0])}}),r.createElement(dn.Z,{variant:t.svgContent?"secondary":"primary",onClick:()=>{var e;En("load svg"),null===(e=i.current)||void 0===e||e.click()}},"Load SVG")),r.createElement("p",null,"Or simply ",r.createElement("b",null,"Drag & Drop")," your svg into the page area.")),r.createElement("section",{className:xn.inputs},r.createElement("h4",{className:"col-span-2"},"Dimension"),r.createElement("label",{htmlFor:"page-size"},"Page Size: "),r.createElement("select",{id:"page-size",value:n.size.type,onChange:e=>{const t=Qt.find((t=>t.type===e.target.value));t&&n.setSize(t)}},Qt.map((e=>r.createElement("option",{key:e.type,value:e.type},e.alias)))),r.createElement("label",{htmlFor:"page-padding"},"Padding(mm): "),r.createElement("input",{id:"page-padding",type:"number",min:"0",value:n.padding,onChange:e=>n.setPadding(e.target.value)}),r.createElement("label",null,"Orientation:"),r.createElement("div",{className:"inline-flex items-center"},r.createElement("label",{className:f()(un.Z.radioLabel,"mr-2")},r.createElement("input",{type:"radio",name:"orientation",value:Ot,checked:n.orientation===Ot,onChange:()=>n.setOrientation(Ot)}),r.createElement("span",null,"Landscape")),r.createElement("label",{className:un.Z.radioLabel},r.createElement("input",{type:"radio",name:"orientation",value:zt,checked:n.orientation===zt,onChange:()=>n.setOrientation(zt)}),r.createElement("span",null,"Portrait"))),r.createElement("label",{className:f()(un.Z.checkboxLabel,"col-start-2"),htmlFor:"page-fit"},r.createElement("input",{type:"checkbox",id:"page-fit",checked:n.contentFitPage,onChange:e=>{n.setContentFitPage(e.target.checked)}}),r.createElement("span",null,"Fit content to page")),r.createElement("h4",{className:"col-span-2"},"Alignment"),r.createElement("label",{htmlFor:"page-align-h"},"Horizontal:"),r.createElement("select",{id:"page-align-h",value:n.alignment.horizontal,onChange:e=>n.setAlignmentHorizontal(e.target.value)},r.createElement("option",{value:Ht},"Left"),r.createElement("option",{value:It},"Center"),r.createElement("option",{value:Rt},"Right")),r.createElement("label",{className:"aw-label",htmlFor:"page-align-v"},"Vertical:"),r.createElement("select",{id:"page-align-v",value:n.alignment.vertical,onChange:e=>n.setAlignmentVertical(e.target.value)},r.createElement("option",{value:Dt},"Top"),r.createElement("option",{value:Lt},"Center"),r.createElement("option",{value:_t},"Bottom"))),r.createElement("section",{className:"grid grid-cols-1 gap-4"},t.svgContent?r.createElement(pn.Z,{type:"info"},"Plan the motion before sending it to the plotter."):r.createElement(pn.Z,{type:"warn"},"Load SVG first."),r.createElement(dn.Z,{variant:t.svgContent?"primary":"secondary",disabled:!t.svgContent,onClick:()=>{t.setPhase(wt),En("go to",wt)}},r.createElement("span",{className:"inline-block w-32"},"Next")),t.fileInfo&&r.createElement(r.Fragment,null,r.createElement("h4",null,"Svg Counts:"),r.createElement("textarea",{value:JSON.stringify(t.fileInfo,null,2),readOnly:!0}))))}));Sn.propTypes={};var An=Sn,Pn=n(7536),$n={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};$n.domAPI=y(),$n.insertStyleElement=x(),h()(Pn.Z,$n);var Tn=Pn.Z&&Pn.Z.locals?Pn.Z.locals:void 0;function Mn(){return(Mn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Zn=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),[i,o]=(0,r.useState)(.2),[a,s]=(0,r.useState)(.1),c=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{t.phase===wt&&c.current.click()}),[t.phase]),r.createElement(vn,Mn({active:t.phase===wt},e),r.createElement("section",null,r.createElement("h3",null,"Planning"),r.createElement("p",{className:"mb-4"},"In this phase, the SVG would be transformed into coordinates on the page, then it will plan the motion for AxiDraw to plot the picture."),r.createElement(dn.Z,{onClick:()=>{t.setPhase(bt),En("go to",bt)}},"Back to Setup")),r.createElement("section",null,r.createElement("form",{className:Tn.form,onSubmit:e=>{e.preventDefault(),En("plan"),t.planMotion({screenToPageMatrix:n.screenToPageMatrix,origin:n.orientation===Ot?[0,0]:[l(n.size.height),0],connectedError:i,flatLineError:a})}},r.createElement("label",{htmlFor:"connected-error"},"Connected: "),r.createElement("input",{id:"connected-error",type:"number",min:"0",step:"0.05",max:"10",value:i,onChange:e=>o(parseFloat(e.target.value))}),r.createElement("label",{htmlFor:"flatten-error"},"Flatten: "),r.createElement("input",{id:"flatten-error",type:"number",min:"0",step:"0.01",max:"2",value:a,onChange:e=>s(parseFloat(e.target.value))}),r.createElement("div",{className:"col-start-2"},r.createElement(dn.Z,{submit:!0,ref:c},"Re-plan")))),r.createElement("section",{className:"grid grid-cols-1 gap-4"},r.createElement(pn.Z,{type:"info"},"Adjust parameters above and redo the planning until you are satisfied."),r.createElement(dn.Z,{variant:"primary",onClick:()=>{t.setPhase(xt),En("go to",xt)}},r.createElement("span",{className:"inline-block w-32"},"Next"))))}));Zn.propTypes={};var kn=Zn,Nn=n(6370);const Fn=[{cmd:Kt.r},{cmd:Kt.em,title:"Disable Motor",params:[0,0]},{cmd:Kt.tp},{cmd:Kt.sp,title:"Pen Up",params:[1]},{cmd:Kt.sp,title:"Pen Down",params:[0]}],On=({device:e})=>{const[t,n]=(0,r.useState)(""),i=(0,r.useCallback)((async(t,r=[])=>{try{const i=await e.executeCommand(t,...r);n("object"==typeof i?JSON.stringify(i):i)}catch(e){n(e.toString())}}),[e]);return r.createElement("form",{className:un.Z.root},r.createElement("h3",null,"Simple Debugger"),r.createElement(pn.Z,{type:"info"},"Debug AxiDraw before plotting."),r.createElement("div",{className:"grid grid-cols-2 gap-2 lg:grid-cols-3"},Fn.map((e=>{const t=e.title||e.cmd.title;return r.createElement(dn.Z,{key:t,onClick:()=>{i(e.cmd,e.params),En("debug",t)}},t)}))),r.createElement("label",{className:un.Z.inputLabel},r.createElement("span",null,"Result:"),r.createElement("textarea",{rows:"3",defaultValue:t,readOnly:!0})))};On.propTypes={device:o().object.isRequired};var zn=On,Ln=n(3409),Dn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Dn.domAPI=y(),Dn.insertStyleElement=x(),h()(Ln.Z,Dn);var _n=Ln.Z&&Ln.Z.locals?Ln.Z.locals:void 0;function In(){return(In=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Hn=(0,a.Pi)((({...e})=>{const{planning:t,work:n}=(0,r.useContext)(u),i=n.device.get(),o=n.plottingInProgress.get(),[a,l]=(0,r.useState)(null);return(0,r.useEffect)((()=>(n.setDevice(a),()=>{null==a||a.disconnectDevice()})),[a]),r.createElement(vn,In({active:t.phase===xt},e),!i&&r.createElement("section",{className:"space-y-4"},r.createElement("h3",null,"Plotting"),r.createElement(pn.Z,{type:"warn"},"Please connect to device before plotting."),r.createElement("div",{className:"grid grid-cols-2 gap-6"},r.createElement(dn.Z,{onClick:()=>{t.setPhase(wt),En("go to",wt)}},"Back to planning"))),r.createElement(Nn.Z,{onConnected:e=>l(e),onDisconnected:()=>l(null)}),i&&r.createElement("section",{className:"space-y-4"},r.createElement("h3",null,"Plotting"),r.createElement("form",{className:_n.form,onSubmit:e=>{e.preventDefault(),o||(En("control","plot"),n.plot({motions:t.motions}))}},r.createElement("label",{htmlFor:"pen-down-speed"},"Speed(Pen-down):"),r.createElement("input",{id:"pen-down-speed",type:"number",min:"1000",step:"100",max:"20000",value:n.penDownMoveSpeed,onChange:e=>n.setPenDownMoveSpeed(parseFloat(e.target.value))}),r.createElement("label",{htmlFor:"pen-up-speed"},"Speed(Pen-up):"),r.createElement("input",{id:"pen-up-speed",type:"number",min:"1000",step:"100",max:"20000",value:n.penUpMoveSpeed,onChange:e=>n.setPenUpMoveSpeed(parseFloat(e.target.value))}),r.createElement("div",{className:"col-start-2"},n.plotterStatus===nn&&r.createElement(dn.Z,{variant:"primary",submit:!0},"Start"),r.createElement("div",{className:"grid grid-cols-2 gap-4"},n.plotterStatus===on&&r.createElement(dn.Z,{onClick:()=>{n.pause(),En("control","pause")},disabled:null!==n.control.get()},"Pause"),n.plotterStatus===rn&&r.createElement(dn.Z,{onClick:()=>{n.resume(),En("control","resume")}},"Resume"),n.plotterStatus!==nn&&r.createElement(dn.Z,{onClick:()=>{n.stop(),En("control","stop")},disabled:null!==n.control.get()},"Stop"))))),i&&n.plotterStatus===nn&&r.createElement(zn,{device:i}))}));Hn.propTypes={};var Rn=Hn;const Qn=(0,pt.ky)({size:jt,padding:jt.defaultPadding,orientation:Ot,alignment:{vertical:Lt,horizontal:It},contentFitPage:!0,get width(){return this.orientation===Ot?this.size.width:this.size.height},get height(){return this.orientation===Ot?this.size.height:this.size.width},setSize(e){this.size=e,this.padding=e.defaultPadding},setPadding(e){this.padding=e},setOrientation(e){this.orientation=e},setAlignmentVertical(e){this.alignment.vertical=e},setAlignmentHorizontal(e){this.alignment.horizontal=e},setContentFitPage(e){this.contentFitPage=e},get contentPreserveAspectRatio(){return`${{[Ht]:"xMin",[It]:"xMid",[Rt]:"xMax"}[this.alignment.horizontal]}${{[Dt]:"YMin",[Lt]:"YMid",[_t]:"YMax"}[this.alignment.vertical]} meet`},get screenToPageMatrix(){const e=s(1),t=new DOMMatrix;if(t.scaleSelf(e),this.orientation===Ot)return t;const n=new DOMMatrix;n.translateSelf(-this.size.height,0);const r=new DOMMatrix;return r.rotateSelf(0,0,-90),r.multiply(n).multiply(t)},get pageToScreenMatrix(){return this.screenToPageMatrix.inverse()}}),jn=(0,pt.ky)({svgContent:null,lines:null,motions:null,fileInfo:null,previewStrokeWidth:.4,setPreviewStrokeWidth(e){this.previewStrokeWidth=e},phase:bt,setPhase(e){this.phase=e},loadFromUrl(e){fetch(e).then((e=>e.text())).then((e=>{this.loadSVGContent(e)}))},loadFromFile(e){const t=new FileReader;t.onload=e=>{this.loadSVGContent(e.target.result)},t.readAsText(e)},loadSVGContent(e){this.svgContent=e,this.lines=null,this.motions=null},updateFileInfo(e){this.fileInfo=e},updateLines(e){this.lines=e,this.motions=null},planMotion(e){var t;if(null===(t=this.lines)||void 0===t||!t.length)throw new Error("Lines are not ready");this.motions=function(e,t={}){return[...gt(e,{...yt,...t})]}(this.lines,e)},get linesAsPathDef(){var e;return vt(null===(e=this.motions)||void 0===e?void 0:e.filter((e=>0===e.pen)).map((e=>e.line)))},get connectionsAsPathDef(){var e;return vt(null===(e=this.motions)||void 0===e?void 0:e.filter((e=>1===e.pen)).map((e=>e.line)))}},null,{name:"axidraw-web-work",deep:!1}),qn=(0,pt.ky)({device:pt.LO.box(null,{deep:!1}),setDevice(e){this.device.set(e);const t=this.plottingInProgress.get();!e&&t&&(t.return(),this.plottingInProgress.set(null))},penDownMoveSpeed:pt.LO.box(2e3),penUpMoveSpeed:pt.LO.box(5e3),setPenDownMoveSpeed(e){this.penDownMoveSpeed.set(e)},setPenUpMoveSpeed(e){this.penUpMoveSpeed.set(e)},control:pt.LO.box(null),plotterStatus:nn,plottingInProgress:pt.LO.box(null,{deep:!1}),async plot({motions:e}){const t=this.device.get();if(!t)throw new Error("Device is not connect.");const n=async function*({device:e,penUpMoveSpeed:t,penDownMoveSpeed:n,motions:r,control:i}){let o=null;const a=async()=>{o={...sn},await e.executeCommand(Kt.r),await e.executeCommand(Kt.sp,1,500)};await a();let l=0;try{for(const{line:a,pen:s}of r){const r=await e.executeCommand(Kt.qb);let c=i.get();(r||c===an)&&(O.debug("action: pause"),await e.executeCommand(Kt.sp,1,500),o.pen=1,c=yield rn);const u=c===ln;u&&O.debug("action: stop");const d=u?1:s,p=u?[o.x,o.y,0,0]:a;o.pen!==d&&(O.debug("pen "+(1===d?"up":"down")),await e.executeCommand(Kt.sp,d,500),o.pen=d);const f=0===d?n.get():t.get(),m=en({x:p[2],y:p[3]}),h=m.a1-o.a1,g=m.a2-o.a2;let y=Math.ceil(Math.sqrt(h**2+g**2)/f*1e3);const v=Math.abs(h),b=Math.abs(g),w=1310*v,x=1310*b;if(y>w&&y>x&&(y=Math.max(w,x)),y>w&&v>0){O.warn(`Vertical edge occurs: SM,${y},${h},${g}`);for(const t of cn({t:y,stepLong:g,stepShort:h}))await e.executeCommand(Kt.sm,t.time,t.shortStep,t.longStep)}else if(y>x&&b>0){O.warn(`Horizontal edge occurs: SM,${y},${h},${g}`);for(const t of cn({t:y,stepLong:h,stepShort:g}))await e.executeCommand(Kt.sm,t.time,t.longStep,t.shortStep)}else y>0&&(O.debug(`step-move: ${h}, ${g} in ${y}ms`),await e.executeCommand(Kt.sm,y,h,g));if(o.x=p[2],o.y=p[3],o.a1=m.a1,o.a2=m.a2,l=y,u){O.debug("stop plotting");break}}l+=3e3,O.debug(`pen is homing: ${l}`),await(0,tn.g)(l)}catch(e){O.error(e)}finally{await a(),O.debug("finished plotting")}return nn}({device:t,motions:e,penUpMoveSpeed:this.penUpMoveSpeed,penDownMoveSpeed:this.penDownMoveSpeed,control:this.control});this.plottingInProgress.set(n),await this.resume()},async resume({action:e}={}){const t=this.plottingInProgress.get();if(!t)return;this.plotterStatus=on;const n=await t.next(e);this.plotterStatus=n.value,this.control.set(null),n.done&&(this.plottingInProgress.set(null),this.device.get().disconnectDevice())},pause(){this.control.set(an)},async stop(){this.plotterStatus===rn?this.resume({action:ln}):this.control.set(ln)}});var Bn=()=>r.createElement(u.Provider,{value:{planning:jn,page:Qn,work:qn}},r.createElement("main",{className:Yt.workspace},r.createElement(Wt,null)),r.createElement("aside",{className:Yt.panel},r.createElement(An,null),r.createElement(kn,null),r.createElement(Rn,null)))},9062:function(e,t,n){"use strict";n.d(t,{g:function(){return r},V:function(){return i}});const r=e=>new Promise((t=>{setTimeout(t,e)})),i=(e,t)=>new Promise(((n,r)=>{setTimeout((()=>{r(new Error(t))}),e)}))},7446:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,'._10ryd{bottom:0;left:0;position:absolute;right:0;top:0}._10ryd>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}._10ryd{display:none;overflow-y:scroll;padding-left:2rem;padding-right:2rem}._10ryd:after,._10ryd:before{content:"";height:2rem}._2RtXA,._10ryd:after,._10ryd:before{display:block}',""]),i.locals={root:"_10ryd",active:"_2RtXA"},t.Z=i},7536:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._3eMFG{align-items:center;display:grid;gap:1rem;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;margin-bottom:1rem}",""]),i.locals={form:"_3eMFG"},t.Z=i},3409:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._3iEUx{align-items:center;display:grid;gap:1rem;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;margin-bottom:1rem}",""]),i.locals={form:"_3iEUx"},t.Z=i},3848:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._11H5z{align-items:center;display:grid;gap:1rem;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;margin-bottom:1rem}",""]),i.locals={inputs:"_11H5z"},t.Z=i},9930:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._2uf5o{fill:none}._1w0lW{stroke-width:1mm;stroke-linejoin:round;stroke-linecap:round}.uNj6-{stroke:red}._25v8K{stroke:#0f0}._2lXdL{fill:#00f}",""]),i.locals={root:"_2uf5o",axis:"_1w0lW",x:"uNj6-",y:"_25v8K",z:"_2lXdL"},t.Z=i},306:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,".VetUz{fill:rgba(0,0,0,.25)}.Iwi1G{fill:#fff}.Iwi1G.CZ6FL{fill:#eef}._1Q1eR{fill:none;stroke:#b8b8b8;stroke-width:.4mm;stroke-dasharray:5 5}",""]),i.locals={shadow:"VetUz",paper:"Iwi1G",dropping:"CZ6FL",printable:"_1Q1eR"},t.Z=i},3273:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,":root{--planning-stroke-width:1}.py2vP{stroke-width:var(--planning-stroke-width);stroke-linecap:round;stroke-linejoin:round;fill:none}._1iEPV{stroke:#e2e2e2}._3HiNq{stroke:#333}",""]),i.locals={root:"py2vP",motionPenUp:"_1iEPV",motionPenDown:"_3HiNq"},t.Z=i},2849:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._1MCds *{stroke:#333!important}",""]),i.locals={root:"_1MCds"},t.Z=i},518:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._1VH7z{height:100%;width:100%}",""]),i.locals={root:"_1VH7z"},t.Z=i},4697:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._3w6hI{right:0;right:450px}._3jRw_,._3w6hI{bottom:0;left:0;position:fixed;top:0}._3jRw_{background-color:#efefef;font-size:1rem;left:auto;line-height:1.5rem;right:0;width:450px}",""]),i.locals={workspace:"_3w6hI",panel:"_3jRw_"},t.Z=i}}]);