(self.webpackChunkaxidraw_web=self.webpackChunkaxidraw_web||[]).push([[520],{5374:function(e,t,n){"use strict";n.d(t,{G7:function(){return r},Hr:function(){return i},d4:function(){return o},Pz:function(){return a},x1:function(){return s},FP:function(){return l}});const r="\r",i="\r\n",o="\n\r",a="OK\r\n",s=1,l=2029},4854:function(e,t,n){"use strict";n.d(t,{em:function(){return a.Z},lm:function(){return s},r:function(){return l.Z},sm:function(){return c.Z},sp:function(){return u.Z},sr:function(){return d},tp:function(){return p}});var r=n(848),i=n(5374);(0,r.fA)("A","Get analog values",(function*(){const e=yield"A\r",t=yield*(0,r.Tb)(i.Hr,e);return(0,r.F7)(t,(e=>e.trim().substr(2).split(",").reduce(((e,t)=>{const[n,i]=t.split(":");return{...e,[(0,r.Hq)(n)]:(0,r.Hq)(i)}}),{})))}),{version:"2.2.3"});var o=n(1980);(0,r.fA)("AC","Analog configure",(function*(e,t){const n=yield`AC,${[e,t].join(",")}\r`;return yield*(0,o.Z)(n)}),{version:"2.2.3"}),(0,r.fA)("BL","Enter bootloader",(function*(){const e=yield"BL\r";return yield*(0,o.Z)(e)}),{version:"1.9.5"}),(0,r.fA)("C","Configure pin direction",(function*(e,t,n,r,i){const a=yield`C,${[e,t,n,r,i].join(",")}\r`;return yield*(0,o.Z)(a)})),(0,r.fA)("CK","Check input",(function*(e,t,n,o,a,s,l,c){const u=yield`CK,${[e,t,n,o,a,s,l,c].join(",")}\r`,d=yield*(0,r.Tb)(i.Pz,u);return(0,r.F7)(d,(e=>e.substring(0,e.length-6).split(/\s+/).map(((e,t)=>{const n=e.split("=")[1];return t<6?(0,r.Hq)(n):n}))))})),(0,r.fA)("CS","Clear step position",(function*(){const e=yield"CS\r";return yield*(0,o.Z)(e)}),{version:"2.4.3"}),(0,r.fA)("CU","Configure user options",(function*(e,t){const n=yield`CU,${[e,t].join(",")}\r`;return yield*(0,o.Z)(n)}));var a=n(3326);(0,r.fA)("ES","E stop",(function*(e){const t=yield(0,r.iW)("ES",e),n=yield*(0,r.Tb)(i.Pz,t);return(0,r.F7)(n,(e=>{const t=e.substring(0,e.length-6).split(",").map(r.Hq);return{interrupted:t[0],axis1:{steps:t[1],remain:t[3]},axis2:{steps:t[2],remain:t[4]}}}))}),{version:"2.2.7"}),(0,r.fA)("HM","Home or absolute move",(function*(e,t,n){const i=yield(0,r.iW)(`HM,${e}`,t,n);return yield*(0,o.Z)(i)}),{execution:i.x1,version:"2.6.2"}),(0,r.fA)("I","Input (digital)",(function*(){const e=yield"I\r",t=yield*(0,r.Tb)(i.Hr,e);return(0,r.F7)(t,(e=>e.trim().substr(2).split(",").map(r.Hq)))}));var s=(0,r.fA)("LM","Low-level move, step-limited",(function*(e,t,n,i,a,s,l){const c=yield(0,r.iW)(`LM,${[e,t,n,i,a,s].join(",")}`,l);return yield*(0,o.Z)(c)}),{execution:i.x1,version:"2.7.0"});(0,r.fA)("LT","Low-level move, time-limited",(function*(e,t,n,i,a,s){const l=yield(0,r.iW)(`LT,${[e,t,n,i,a].join(",")}`,s);return yield*(0,o.Z)(l)}),{execution:i.x1,version:"2.7.0"}),(0,r.fA)("MR","Memory Read",(function*(e){const t=yield`MR,${e}\r`,n=yield*(0,r.Tb)(i.Hr,t);return(0,r.F7)(n,(e=>(0,r.Hq)(e.substr(3))))})),(0,r.fA)("MW","Memory Write",(function*(e,t){const n=yield`MW,${e},${t}\r`;return yield*(0,o.Z)(n)})),(0,r.fA)("ND","Node count decrement",(function*(){const e=yield"ND\r";return yield*(0,o.Z)(e)}),{version:"1.9.5"}),(0,r.fA)("NI","Node count increment",(function*(){const e=yield"NI\r";return yield*(0,o.Z)(e)}),{version:"1.9.5"}),(0,r.fA)("O","Output (digital)",(function*(e,t,n,i,a){const s=yield(0,r.iW)(`O,${e}`,t,n,i,a);return yield*(0,o.Z)(s)})),(0,r.fA)("PC","Pulse configure",(function*(e,t,n,i,a,s,l,c){const u=yield(0,r.iW)(`PC,${e},${t}`,n,i,a,s,l,c);return yield*(0,o.Z)(u)})),(0,r.fA)("PD","Pin direction",(function*(e,t,n){const r=yield`PD,${e},${t},${n}\r`;return yield*(0,o.Z)(r)})),(0,r.fA)("PG","Pulse go",(function*(e){const t=yield`PG,${e}\r`;return yield*(0,o.Z)(t)})),(0,r.fA)("PI","Pin input",(function*(e,t){const n=yield`PI,${e},${t}\r`,o=yield*(0,r.Tb)(i.Hr,n);return(0,r.F7)(o,(e=>(0,r.Hq)(e.substr(3))))})),(0,r.fA)("PO","Pin output",(function*(e,t,n){const r=yield`PO,${e},${t},${n}\r`;return yield*(0,o.Z)(r)})),(0,r.fA)("QB","Query button",(function*(){const e=yield"QB\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.2"}),(0,r.fA)("QC","Query current",(function*(){const e=yield"QC\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>{const t=e.substring(0,e.length-6).split(",").map((e=>((0,r.Hq)(e)/1023*3.3).toFixed(2)));return{ra0:{voltage:t[0],maxCurrent:(t[0]/1.76).toFixed(2)},vPlus:{voltage:(9.2*t[1]+.3).toFixed(2)}}}))}),{version:"2.2.3"}),(0,r.fA)("QE","Query motor enable",(function*(){const e=yield"QE\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>e.substring(0,e.length-6).split(",").map(r.Hq)))}),{version:"2.8.0"}),(0,r.fA)("QG","Query general",(function*(){const e=yield"QG\r",t=yield*(0,r.Tb)(i.Hr,e);return(0,r.F7)(t,(e=>{const t=(0,r.Hq)(e);return{fifo:(1&t)>0,mtr2:(2&t)>0,mtr1:(4&t)>0,cmd:(8&t)>0,pen:(16&t)>0,prg:(32&t)>0,rb2:(64&t)>0,rb5:(128&t)>0}}))}),{version:"2.6.2"}),(0,r.fA)("QL","Query layer",(function*(){const e=yield"QL\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.2"}),(0,r.fA)("QM","Query motors",(function*(){const e=yield"QM\r",t=yield*(0,r.Tb)(i.d4,e);return(0,r.F7)(t,(e=>{const t=e.trim().substr(3).split(",").map(r.Hq);return{command:t[0],motor1:t[1],motor2:t[2],fifo:t[3]}}))}),{version:"2.4.4"}),(0,r.fA)("QN","Query node count",(function*(){const e=yield"QN\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.2"}),(0,r.fA)("QP","Query pen",(function*(){const e=yield"QP\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.0"}),(0,r.fA)("QR","Query RC Servo power state",(function*(){const e=yield"QR\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"2.6.0"}),(0,r.fA)("QS","Query step position",(function*(){const e=yield"QS\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>{const t=e.substring(0,e.length-6).split(",").map(r.Hq);return{a1:t[0],a2:t[1]}}))}),{version:"2.4.3"}),(0,r.fA)("QT","Query EBB nickname tag",(function*(){const e=yield"QT\r",t=yield*(0,r.Tb)(i.Pz,e);return(0,r.F7)(t,(e=>e.substring(0,e.length-6)))}),{version:"2.5.4"});var l=n(5707);(0,r.fA)("RB","Reboot",(function*(){return"RB\r"}),{version:"2.5.4"}),(0,r.fA)("S2","General RC Servo output",(function*(e,t,n,i){const a=yield(0,r.iW)(`S2,${e},${t}`,n,i);return yield*(0,o.Z)(a)}),{execution:i.x1,version:"2.2.0"}),(0,r.fA)("SC","Stepper and Servo mode configure",(function*(e,t){const n=yield`SC,${e},${t}\r`;return yield*(0,o.Z)(n)})),(0,r.fA)("SE","Set engraver",(function*(e,t,n){const i=yield(0,r.iW)(`SE,${e}`,t,n);return yield*(0,o.Z)(i)}),{execution:i.x1,version:"2.1.0"}),(0,r.fA)("SL","Set layer",(function*(e){const t=yield`SL,${e}\r`;return yield*(0,o.Z)(t)}),{version:"1.9.2"});var c=n(1632);(0,r.fA)("SN","Set node count",(function*(e){const t=yield`SN,${e}\r`;return yield*(0,o.Z)(t)}),{version:"1.9.5"});var u=n(1519),d=(0,r.fA)("SR","Set RC Servo power timeout",(function*(e,t){const n=yield(0,r.iW)(`SR,${e}`,t);return yield*(0,o.Z)(n)}),{version:"2.6.0"});(0,r.fA)("ST","Set EBB nickname tag",(function*(e){const t=yield`ST,${e}\r`;return yield*(0,o.Z)(t)}),{version:"2.5.5"}),(0,r.fA)("T","Timed analog/digital read",(function*(e,t){const n=yield`T,${e},${t}\r`;return yield*(0,o.Z)(n)}));var p=(0,r.fA)("TP","Toggle pen",(function*(e){const t=yield(0,r.iW)("TP",e);return yield*(0,o.Z)(t)}),{version:"1.9.0"});n(2206),(0,r.fA)("XM","Stepper move, mixed-axis geometries",(function*(e,t,n){const r=yield`XM,${e},${t},${n}\r`;return yield*(0,o.Z)(r)}),{execution:i.x1,version:"2.3.0"})},7520:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return tr}});var r=n(7294),i=(n.p,n(5697)),o=n.n(i),a=n(1275);const s=e=>96/25.4*e,l=e=>e/96*25.4,c=(0,r.createContext)();c.displayName="Plotter Context";var u=c;const d=e=>t=>{t.preventDefault(),null==e||e(t)};var p=n(4184),m=n.n(p),f=n(3379),h=n.n(f),g=n(7795),v=n.n(g),y=n(695),b=n.n(y),w=n(9216),x=n.n(w),E=n(306),C={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};C.domAPI=v(),C.insertStyleElement=x(),h()(E.Z,C);var S=E.Z&&E.Z.locals?E.Z.locals:void 0;function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const A=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),i=s(n.width),o=s(n.height),a=s(n.padding),[l,c]=(0,r.useState)(!1);return r.createElement("g",M({onDragOver:d(),onDragEnter:d((()=>c(!0))),onDragLeave:d((()=>c(!1))),onDrop:d((e=>{if(c(!1),!e.dataTransfer.files.length)return;const n=Array.from(e.dataTransfer.files).find((e=>"image/svg+xml"===e.type));n?t.loadFromFile(n):alert("Only SVG files are supported.")}))},e),r.createElement("rect",{className:S.shadow,width:i,height:o,filter:"url(#svgShadow)"}),r.createElement("rect",{className:m()(S.paper,{[S.dropping]:l}),width:i,height:o}),r.createElement("rect",{className:S.printable,width:i-2*a,height:o-2*a,x:a,y:a}))}));A.propTypes={};var P=A,$=n(518),T={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};T.domAPI=v(),T.insertStyleElement=x(),h()($.Z,T);var Z=$.Z&&$.Z.locals?$.Z.locals:void 0;const k=({margin:e})=>{const t=s(e);return r.createElement("filter",{id:"svgShadow"},r.createElement("feOffset",{id:"svgOffset0",result:"svgOffset0",in:"SourceAlpha",dy:"0",dx:"0"}),r.createElement("feGaussianBlur",{id:"svgBlur0",result:"svgBlur0",in:"svgOffset0",stdDeviation:`${t/4} ${t/4}`}),r.createElement("feBlend",{id:"svgBlend0",result:"svgBlend0",in:"SourceGraphic",in2:"svgBlur0"}))};k.propTypes={margin:o().number};var N=k,F=n(5901);const D=n.n(F)().get("plotter");function*O(e){for(const t of e.children){const e=t.nodeName;switch(e){case"svg":case"g":case"a":yield*O(t);break;case"rect":case"circle":case"ellipse":case"line":case"polyline":case"polygon":case"path":yield{action:"count",el:t,type:e};break;default:yield{action:"discard",el:t,type:e}}}}function L(e){const t={},n=[];for(const r of O(e))switch(r.action){case"count":t[r.type]=(t[r.type]||0)+1;break;case"discard":default:t[r.action]=(t[r.action]||0)+1,D.debug(`Unsupported element type: ${r.type}`),n.push(r.el)}for(const e of n)e.remove();return{counts:t}}const z=([e,t],{a:n,b:r,c:i,d:o,e:a,f:s})=>[n*e+i*t+a,r*e+o*t+s],R=(e,t,n)=>{const[r,i]=z(e,n),[o,a]=z(t,n);return[r,i,o,a]},_=(e,t,n,r)=>Math.atan2(e*r-t*n,e*n+t*r),I=(e,t,n,r)=>[(e+n)/2,(t+r)/2],Q=([e,t],[n,r],[i,o])=>[[e+2*(n-e)/3,t+2*(r-t)/3],[i+2*(n-i)/3,o+2*(r-o)/3]];function*H(e,t,n,r){if(!e||"A"!==e[0])throw new Error(`invalid arc: ${e}`);const{cos:i,sin:o,PI:a}=Math,[s,l]=t;let[c,u,d,p,m,f,[h,g]]=e;if(0===u||0===d){const e=[h,g];return yield R(t,e,n),e}u=Math.abs(u),d=Math.abs(d);const v=p*Math.PI/180,y=i(v),b=o(v),w=new DOMMatrix([y,-b,b,y,0,0]),[x,E]=z([(s-h)/2,(l-g)/2],w);let C=u*u,S=d*d;const M=x*x,A=E*E,P=M/C+A/S;if(P>1){const e=Math.sqrt(P);u*=e,d*=e,C=u*u,S=d*d}let $=(C*S-C*A-S*M)/(C*A+S*M);$<0&&($=0);const T=m===f?-1:1,Z=Math.sqrt($),k=T*Z*u*E/d,N=-T*Z*d*x/u,F=new DOMMatrix([y,b,-b,y,0,0]),[D,O]=z([k,N],F),L=D+(s+h)/2,I=O+(l+g)/2,Q=(x-k)/u,H=(E-N)/d,q=(-x-k)/u,j=(-E-N)/d,B=_(1,0,Q,H),V=2*a,U=_(Q,H,q,j)%V;let W=U;0===f&&U>0&&(W-=V),1===f&&U<0&&(W+=V);const{maxError:G}=r,X=new DOMMatrix([n.a,n.b,n.c,n.d,0,0]);return yield*function*e(t,r,a,s,l,c){const p=(t+r)/2,[m,f]=z([u*i(p),d*o(p)],F),h=m+L,g=f+I,v=((e,t,n,r,i,o)=>Math.abs(n*(o-t)-r*(i-e)+i*t-e*o)/Math.sqrt((i-e)**2+(o-t)**2))(a,s,h,g,l,c),[y,b]=z([v,0],X);y*y+b*b<=G*G?yield R([a,s],[l,c],n):(yield*e(t,p,a,s,h,g),yield*e(p,r,h,g,l,c))}(B,B+W,s,l,h,g),[h,g]}function*q(e,t,n,r){if(!e||"C"!==e[0])throw new Error(`invalid bezier: ${e}`);const[i,o]=t,[a,[s,l],[c,u],[d,p]]=e,{maxError:m}=r,f=n.inverse(),h=new DOMMatrix([f.a,f.b,f.c,f.d,0,0]),[g,v]=z([m,0],h),y=g*g+v*v;return yield*function*e(t,r,i,o,a,s,l,c){if(((e,t,n,r,i,o,a,s,l)=>{let c=(3*n-2*e-a)**2,u=(3*r-2*t-s)**2;const d=(3*i-2*a-e)**2,p=(3*o-2*s-t)**2;return c<d&&(c=d),u<p&&(u=p),c+u<=16*l})(t,r,i,o,a,s,l,c,y))yield R([t,r],[l,c],n);else{const[n,u]=[t,r],[d,p]=[l,c],[m,f]=I(n,u,i,o),[h,g]=I(i,o,a,s),[v,y]=I(m,f,h,g),[b,w]=I(a,s,d,p),[x,E]=I(h,g,b,w),[C,S]=I(v,y,x,E),[M,A]=[C,S];yield*e(n,u,m,f,v,y,C,S),yield*e(M,A,x,E,b,w,d,p)}}(i,o,s,l,c,u,d,p),[d,p]}const j=(e,t)=>({type:e,execute:t}),B=(e,t,n,r,i)=>{const o=e.toUpperCase(),a=e===o;if(a||!n.toAbsolute)return r(t,n,a),[e,...t];const s=i(t,n);return r(s,n,!0),[o,...s]},V=(e,t)=>{const n=[...e],[r,i]=n[n.length-1];return n[n.length-1]=[r+t.x,i+t.y],n},U=([e],t)=>[e+t.x],W=([e],t)=>[e+t.y],G=(e,t)=>e.map((([e,n])=>[e+t.x,n+t.y])),X=(e,t,n)=>{n?t.x=e[0]:t.x+=e[0]},Y=(e,t,n)=>{n?t.y=e[0]:t.y+=e[0]},K=(e,t,n)=>{const r=e[e.length-1];n?(t.x=r[0],t.y=r[1]):(t.x+=r[0],t.y+=r[1])};var J=j("L",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,[e],t,K,V)})),ee=j("M",(function*(e,t){const[n,r,...i]=e;yield B(n,[r],t,((...e)=>{K(...e),((e,t)=>{var n,r;t.startX=null!==(n=t.x)&&void 0!==n?n:0,t.startY=null!==(r=t.y)&&void 0!==r?r:0})(...e)}),V),i.length&&(yield*J.execute([{M:"L",m:"l"}[n],...i],t))})),te=j("H",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,[e],t,X,U)})),ne=j("V",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,[e],t,Y,W)})),re=j("C",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,e,t,K,G)})),ie=j("S",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,e,t,K,G)})),oe=j("Q",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,e,t,K,G)})),ae=j("T",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,[e],t,K,V)})),se=j("A",(function*(e,t){const[n,...r]=e;for(const e of r)yield B(n,e,t,K,V)})),le=j("Z",(function*(e,t){((e,t)=>{var n,r;t.x=null!==(n=t.startX)&&void 0!==n?n:0,t.y=null!==(r=t.startY)&&void 0!==r?r:0})(0,t),yield[t.isAbsolute?"Z":e[0]]}));const ce={},ue=(...e)=>{const t=e.reduce(((e,t)=>e+t.source),"");return new RegExp(t)},de=(...e)=>{const t=e.map((e=>e.source)).join("|");return new RegExp(`(?:${t})`)},pe=e=>new RegExp(`(?:${e.source})?`),me=(e,...t)=>function(n,r=0){const i=t.reduce((function(e,t){const r=t(n,e.idx);return e.idx=r.idx,e.values.push(r.value),e}),{idx:r,values:[]});return{idx:i.idx,value:e(...i.values)}},fe=e=>{const t=new RegExp((null==e?void 0:e.source)||"","y");return function(e,n=0){t.lastIndex=n;const r=t.exec(e);if(!r)throw ce;const i=r[0];return{idx:t.lastIndex,value:i}}},he=(e,t=null)=>function(n,r){try{return e(n,r)}catch(e){if(e===ce)return{idx:r,value:t};throw e}},ge=/\s/,ve=new RegExp(`(?:${ge.source})*`),ye=fe(ve),be=new RegExp(`(?:${ge.source})+`),we=/\d+/,xe=/[+-]/,Ee=ue(/[Ee]/,pe(xe),we),Ce=/\./,Se=de(ue(pe(we),Ce,we),ue(we,Ce)),Me=de(ue(Se,pe(Ee)),ue(we,Ee)),Ae=we,Pe=/,/,$e=de(ue(be,pe(Pe),ve),ue(Pe,ve)),Te=fe($e),Ze=fe(pe($e)),ke=me((e=>parseInt(e,10)),fe(/[01]/)),Ne=me((e=>parseFloat(e)),fe(de(Me,Ae))),Fe=me((e=>parseFloat(e)),fe(ue(pe(xe),de(Me,Ae)))),De=Fe,Oe=me((function(e,t,n){return[e,n]}),De,Ze,De),Le=(e,t=Ze)=>{return me((function(e,t){return[e,...t]}),e,(n=me((function(e,t){return t}),t,e),function(e,t=0){const r=[];let i=t;for(;;)try{const t=n(e,i);r.push(t.value),i=t.idx}catch(e){if(e===ce)break;throw e}return{idx:i,value:r}}));var n},ze=Le(Oe),Re=(e,t)=>me((function(e,t,n){return[e,...n]}),e,ye,t),_e=Re(fe(/[Mm]/),ze),Ie=Re(fe(/[Ll]/),ze),Qe=me((e=>[e]),fe(/[Zz]/)),He=Le(De),qe=Re(fe(/[Hh]/),He),je=Re(fe(/[Vv]/),He),Be=Le(me(((e,t,n,r,i)=>[e,n,i]),Oe,Ze,Oe,Ze,Oe)),Ve=Re(fe(/[Cc]/),Be),Ue=Le(me(((e,t,n)=>[e,n]),Oe,Ze,Oe)),We=Re(fe(/[Ss]/),Ue),Ge=Re(fe(/[Qq]/),Ue),Xe=Re(fe(/[Tt]/),ze),Ye=Le(me(((e,t,n,r,i,o,a,s,l,c,u)=>[e,n,i,a,l,u]),Ne,Ze,Ne,Ze,Fe,Te,ke,Ze,ke,Ze,Oe)),Ke=Re(fe(/[Aa]/),Ye);var Je;const et=Le((Je={Z:Qe,L:Ie,H:qe,V:je,C:Ve,S:We,Q:Ge,T:Xe,A:Ke},function(e,t=0){const n=e[t],r=Je[null==n?void 0:n.toUpperCase()];if(!r)throw ce;return r(e,t)}),ye),tt=Le(me((function(e,t,n){return[e,...n||[]]}),_e,ye,he(et)),ye),nt=me((function(e,t){return(null==t?void 0:t.flatMap((e=>e)))||null}),ye,he(tt),ye),rt={M:ee,L:J,H:te,V:ne,C:re,S:ie,Q:oe,T:ae,A:se,Z:le};function*it(e,t){const n=e.getAttribute("d");if(!n)return;const r=e.getCTM();let i,o,a,s=[0,0];for(const e of function*(e="M 0 0",t=!0){const n={x:0,y:0,startX:0,startY:0,toAbsolute:t};for(const t of((e="")=>{if(!e)return[];const t=nt(e);if(!t.value)throw new Error("Invalid svg path.");return t.value})(e)){const e=rt[t[0].toUpperCase()];yield*e.execute(t,n)}}(n))switch(e[0]){case"M":s=e[1],o=s;break;case"L":i=e[1],yield R(s,i,r),s=i;break;case"H":i=[e[1],s[1]],yield R(s,i,r),s=i;break;case"V":i=[s[0],e[1]],yield R(s,i,r),s=i;break;case"Q":{const n=["C",...Q(s,e[1],e[2]),e[2]];s=yield*q(n,s,r,t),a=e}break;case"T":{if(!a||"Q"!==a[0]&&"T"!==a[0])throw new Error("invalid T command can only follow by Q or T.");const n=2*s[0]-a[1][0],i=2*s[1]-a[1][1],o=["C",...Q(s,[n,i],e[1]),e[1]];s=yield*q(o,s,r,t),a=["Q",[n,i],e[1]]}break;case"C":{const n=e;s=yield*q(n,s,r,t),a=n}break;case"S":{if(!a)throw new Error(`invalid S command: ${e}`);let n,i;switch(a[0]){case"C":[n,i]=a[2];break;case"S":[n,i]=a[1];break;default:throw new Error("invalid S command can only follow by C or S.")}const o=["C",[2*s[0]-n,2*s[1]-i],e[1],e[2]];s=yield*q(o,s,r,t),a=e}break;case"A":s=yield*H(e,s,r,t);break;case"Z":o&&(yield R(s,o,r),s=o)}}const ot=(e,t)=>{var n,r;return null!==(n=null===(r=e[t])||void 0===r?void 0:r.baseVal.value)&&void 0!==n?n:0};function*at(e,t){switch(e.nodeName){case"rect":case"circle":case"ellipse":yield*function*(e,t){let n="";switch(e.nodeName){case"rect":{let t=ot(e,"width"),r=ot(e,"height");const i=ot(e,"x"),o=ot(e,"y");let a=ot(e,"rx"),s=ot(e,"ry");a=Math.min(a,t/2),s=Math.min(s,r/2),0===a||0===s?n+=`M${i} ${o} v${r} h${t} v${-r} h${-t}`:(t-=2*a,r-=2*s,n+=`M${i} ${o+s}v${r} a${a} ${s} 0 0 0 ${a} ${s} h${t} a${a} ${s} 0 0 0 ${a} ${-s} v${-t} a${a} ${s} 0 0 0 ${-a} ${-s} h`+-t+`a${a} ${s} 0 0 0 ${-a} ${s} `)}break;case"circle":case"ellipse":{const t=ot(e,"cx"),r=ot(e,"cy"),i=ot(e,"r"),o="circle"===e.nodeName?i:ot(e,"rx"),a="circle"===e.nodeName?i:ot(e,"ry");if(0===o||0===a)return;n+=`M${t} ${r-a}a${o} ${a} 0 0 0 0 ${2*a}a${o} ${a} 0 0 0 0 ${2*-a}`}}const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",n),r.getCTM=()=>e.getCTM(),yield*it(r,t)}(e,t);break;case"line":case"polyline":case"polygon":yield*function*(e,t){const n=e.getCTM();switch(e.nodeName){case"line":{const t=[ot(e,"x1"),ot(e,"y1")],r=[ot(e,"x2"),ot(e,"y2")];return void(yield R(t,r,n))}case"polyline":case"polygon":{const{points:t}=e,r=t.length;for(let e=0;e<r-1;e+=1){const r=t[e],i=t[e+1];yield R([r.x,r.y],[i.x,i.y],n)}if("polygon"===e.nodeName){const e=t[r-1],i=t[0];yield R([e.x,e.y],[i.x,i.y],n)}}}}(e);break;case"path":yield*it(e,t)}}function*st(e,t){for(const n of e.children)switch(n.nodeName){case"svg":case"g":case"a":yield*st(n,t);break;case"rect":case"circle":case"ellipse":case"line":case"polyline":case"polygon":case"path":yield*at(n,t);break;default:D.info(`unsupported type: ${n.nodeName}`)}}const lt={maxError:s(.1)};var ct=n(2849),ut={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};ut.domAPI=v(),ut.insertStyleElement=x(),h()(ct.Z,ut);var dt=ct.Z&&ct.Z.locals?ct.Z.locals:void 0,pt=n(8949);const mt=e=>(e[0]-e[2])**2+(e[1]-e[3])**2,ft="axidraw-web-plotter-status-standby",ht="axidraw-web-plotter-status-paused",gt="axidraw-web-plotter-status-plotting",vt="axidraw-web-plotter-action-pause",yt="axidraw-web-plotter-action-stop",bt="axidraw-web-plotter-speed-mode-constant",wt="axidraw-web-plotter-speed-mode-accelerating",xt=([e,t],[n,r],[i,o])=>Math.abs(e*(o-r)-t*(i-n)+i*r-n*o)/Math.sqrt((i-n)**2+(o-r)**2);function*Et(e,t,n){if(!e||0===e.length)return{skip:0};const{connectedError:r}=n;if(1===e.length)return yield{line:t(e[0]),pen:0},{skip:1};const i=s(r**2),o=[];let a=0,l=null;for(let t=e.length;a<t-1;a+=1){const t=e[a],n=e[a+1];l=[t[2],t[3],n[0],n[1]],o.push(t);const r=mt(l);if(r>i)break;r>0&&o.push(l),l=null}const c=((e,t)=>{if(null==e||!e.length)return{lines:[]};if(1===e.length)return{lines:e};const n=s(t.flatLineError);if(!n)return{lines:e};const r=e.map((e=>[e[0],e[1]])),i=e[e.length-1];return r.push([i[2],i[3]]),[...function*e(t,i){if(t>=i)return;const o=r[t],a=r[i];let s=-1,l=Number.MIN_VALUE;const c=o[0]===a[0]&&o[1]===a[1]?[a[0]+1,a[1]]:a;for(let e=t+1;e<i;e+=1){const t=xt(r[e],o,c);t>l&&(s=e,l=t)}if(l>n)yield*e(t,s),yield*e(s,i);else{const e=i-t-1,n=[...o,...a];yield{reduced:e,line:n}}}(0,r.length-1)].reduce(((e,t)=>{var n;return e.lines.push(t.line),e.reduced+=null!==(n=t.reduced)&&void 0!==n?n:0,e}),{lines:[],reduced:0})})(o,n);for(const e of c.lines)yield{line:t(e),pen:0};return l?(yield{line:t(l),pen:1},{skip:a+1,reduced:c.reduced}):{skip:a,reduced:c.reduced}}function*Ct(e,t){if(!e||!e.length)return;const{screenToPageMatrix:n,origin:r}=t,i={x:r[0],y:r[1],pen:1},o=e=>R([e[0],e[1]],[e[2],e[3]],n),a=e[0];yield{line:o([i.x,i.y,a[0],a[1]]),pen:1};const l=s(t.planAhead);let c=0;for(let n=0,r=e.length;n<r;){var u;const r=[e[n]];let i=0,a=1;for(;i<l;){const t=e[n+a];if(!t)break;i+=(d=t,Math.sqrt((d[0]-d[2])**2+(d[1]-d[3])**2)),r.push(t),a+=1}const s=yield*Et(r,o,t);n+=s.skip,c+=null!==(u=s.reduced)&&void 0!==u?u:0}var d;D.info(`Reduced lines ${c}`);const p=e[e.length-1];i.x=p[2],i.y=p[3],yield{line:o([i.x,i.y,r[0],r[1]]),pen:1}}const St={connectedError:.2,planAhead:10,flatLineError:.1},Mt=e=>{const t={x:0,y:0};if(!e)return"M 0 0";const n=e=>e.toFixed(3);return e.reduce(((e,r)=>(r[0]===t.x&&r[1]===t.y?e.push(`${n(r[2])} ${n(r[3])}`):e.push(`M ${n(r[0])} ${n(r[1])} ${n(r[2])} ${n(r[3])}`),t.x=r[2],t.y=r[3],e)),["M 0 0"]).join(" ")},At="axidraw-web-planning-phase-setup",Pt="axidraw-web-planning-phase-planning",$t="axidraw-web-planning-phase-plotting";function Tt(){return(Tt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Zt=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),i=(0,r.useRef)(null),o=s(n.padding),a=s(n.width),l=s(n.height),{contentFitPage:c,contentPreserveAspectRatio:d}=n;return(0,r.useLayoutEffect)((()=>{const e=i.current,n=null==e?void 0:e.children[0];if(!n)return;if(!n.hasAttribute("data-cleaned")){const e=L(n);t.updateFileInfo(Object.entries(e.counts)),n.setAttribute("data-cleaned",!0)}if(!n.hasAttribute("data-original-viewBox")){const e=n.getAttribute("viewBox");n.setAttribute("data-original-viewBox",e)}n.setAttribute("width",a-2*o),n.setAttribute("height",l-2*o),n.setAttribute("x",o),n.setAttribute("y",o),n.setAttribute("preserveAspectRatio",d);const r=n.getAttribute("data-original-viewBox"),s=n.getBBox();n.setAttribute("viewBox",c?`${s.x} ${s.y} ${s.width} ${s.height}`:r)}),[n.size,n.padding,n.orientation,n.alignment.vertical,n.alignment.horizontal,n.contentFitPage,t.svgContent]),(0,r.useLayoutEffect)((()=>{if(t.phase===Pt){const e=i.current,n=null==e?void 0:e.children[0];if(!n)return;t.updateLines([...st(n,{...lt})])}}),[t.phase]),r.createElement("g",Tt({className:m()(dt.root,t.phase===At?"block":"hidden"),dangerouslySetInnerHTML:{__html:t.svgContent},ref:i},e))}));Zt.propTypes={};var kt=Zt,Nt=n(3273),Ft={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Ft.domAPI=v(),Ft.insertStyleElement=x(),h()(Nt.Z,Ft);var Dt=Nt.Z&&Nt.Z.locals?Nt.Z.locals:void 0;function Ot(){return(Ot=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Lt=(0,a.Pi)((({strokeWidth:e,...t})=>{const{planning:n,page:i}=(0,r.useContext)(u),o=l(1);return r.createElement("g",Ot({className:m()(Dt.root,n.phase===Pt||n.phase===$t?"block":"hidden"),style:{"--planning-stroke-width":e*o+"%"},transform:i.pageToScreenMatrix.toString()},t),r.createElement("path",{className:Dt.motionPenUp,d:n.connectionsAsPathDef}),r.createElement("path",{className:Dt.motionPenDown,d:n.linesAsPathDef}))}));Lt.propTypes={strokeWidth:o().number};var zt=Lt,Rt=n(9930),_t={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};_t.domAPI=v(),_t.insertStyleElement=x(),h()(Rt.Z,_t);var It=Rt.Z&&Rt.Z.locals?Rt.Z.locals:void 0;const Qt="axidraw-web-page-orientation-landscape",Ht="axidraw-web-page-orientation-portrait",qt="axidraw-web-page-alignment-vertical-center",jt="axidraw-web-page-alignment-vertical-top",Bt="axidraw-web-page-alignment-vertical-bottom",Vt="axidraw-web-page-alignment-horizontal-center",Ut="axidraw-web-page-alignment-horizontal-start",Wt="axidraw-web-page-alignment-horizontal-end",Gt=[{type:"axidraw-web-page-size-a4",alias:"A4 (297mm x 210mm)",width:297,height:210,defaultPadding:15},{type:"axidraw-web-page-size-a5",alias:"A5 (210mm x 148mm)",width:210,height:148,defaultPadding:10},{type:"axidraw-web-page-size-a6",alias:"A6 (148mm x 105mm)",width:148,height:105,defaultPadding:5}],Xt=Gt[0];function Yt(){return(Yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Kt=(0,a.Pi)((({...e})=>{const{page:t}=(0,r.useContext)(u);return r.createElement("g",Yt({className:It.root,transform:t.orientation===Ht?`translate(${s(t.width)},0) rotate(90) `:null},e),r.createElement("polyline",{className:m()(It.axis,It.x),points:`0,0 ${s(10)},0 ${s(8)},${s(-2)}`}),r.createElement("polyline",{className:m()(It.axis,It.y),points:`0,0 0,${s(10)} ${s(-2)},${s(8)}`}),r.createElement("circle",{className:It.z,r:s(2),cx:"0",cy:"0"}))}));Kt.propTypes={};var Jt=Kt;const en=(0,a.Pi)((({margin:e=20})=>{const{page:t,planning:n}=(0,r.useContext)(u),i=s(e),o=`${-i} ${-i} ${s(t.width)+2*i} ${s(t.height)+2*i}`,a=(0,r.useRef)(null),[l,c]=(0,r.useState)(1);return(0,r.useLayoutEffect)((()=>{c(s(n.previewStrokeWidth)/(e=>{const{width:t,height:n}=e.baseVal;return Math.sqrt(t**2+n**2)/Math.sqrt(2)})(a.current.viewBox)*100)}),[o,n.previewStrokeWidth]),r.createElement("svg",{className:Z.root,viewBox:o,preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",ref:a},r.createElement("defs",null,r.createElement(N,{margin:e})),r.createElement(P,null),r.createElement(kt,null),r.createElement(zt,{strokeWidth:l}),r.createElement(Jt,null))}));en.propTypes={margin:o().number};var tn=en,nn=n(4697),rn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};rn.domAPI=v(),rn.insertStyleElement=x(),h()(nn.Z,rn);var on=nn.Z&&nn.Z.locals?nn.Z.locals:void 0,an=n(4854),sn=n(5374);const ln=e=>85899.34592*Math.abs(e)|0,cn=(e,t=1)=>sn.FP/2**(t-1)/25.4*e|0,un=({x:e,y:t},n=1)=>(({x:e,y:t})=>({a1:e+t,a2:e-t}))({x:cn(e,n),y:cn(t,n)});var dn=n(9062);function*pn({t:e,stepLong:t,stepShort:n}){const r=Math.abs(n),i=1310*r,o=Math.sign(n),a=Math.floor((e-i)/(r+1)),s=t/e,l=Math.floor(s*a),c=Math.floor(1310*s);let u=t;for(let e=0,t=2*r+1;e<t;e+=1)e%2==0?a>0&&(u-=l,yield{time:a,longStep:l,shortStep:0,remaining:u}):(u-=c,yield{time:1310,longStep:c,shortStep:o,remaining:u})}const mn=([e,t],[n,r],i,o)=>{const a=(e*n+t*r)/(Math.sqrt(e*e+t*t)*Math.sqrt(n*n+r*r)),s=Math.sqrt((1-a)/2),l=cn(o.delta)*s/(1-s);return Math.sqrt(i*l)},fn=(e,t,n,r,i,o,a={})=>{const s={delta:.1,lookingForward:10,...a},l=e[t];if(1===l.pen)return 0;const c=[l];for(let n=1;n<s.lookingForward;n+=1){const r=e[t+n];if(1===r.pen)break;c.push(r)}if(1===c.length)return 0;const u={exitRate:0};for(let e=c.length-1;e>0;e-=1){const t=c[e],n=c[e-1],[o,a]=n.line,[l,d,p,m]=t.line,f=un({x:o-l,y:a-d}),h=un({x:p-l,y:m-d}),g=Math.sqrt(h.a1**2+h.a2**2),v=Math.sqrt(i*g*2+u.exitRate),y=mn([f.a1,f.a2],[h.a1,h.a2],i,s);u.exitRate=Math.min(y,v,r)}const d=Math.sqrt(i*o*2+n);return 0|Math.min(d,u.exitRate)},hn=(e,t,n,r,i)=>{if(t!==r){const o=Math.sign(r-t),a=Math.abs(t-r)/i,s=(t+r)*a/2,l=e-s|0;if(l<0)throw new Error("Don't have enough room to accelerating");const c={s:s,t:a,v0:t,vt:r,dir:o};return 0===l?[c]:t<r?[c,...hn(l,r,n,r,i)]:[...hn(l,t,n,t,i),c]}const o=(n-t)/i,a=(t+n)*o/2,s={s:a,t:o,v0:t,vt:n,dir:1},l={s:a,t:o,v0:n,vt:t,dir:-1};if(a===e/2)return[s,l];if(a<e/2){const t=e-2*a;return[a>0?s:null,{s:t,t:t/n,v0:n,vt:n,dir:0},a>0?l:null].filter(Boolean)}const c=Math.sqrt(i*e+t*t),u=(c-t)/i;return[{s:e/2,t:u,v0:t,vt:c,dir:1},{s:e/2,t:u,v0:c,vt:t,dir:-1}]};function gn(e){if((null==e?void 0:e.length)<2)return e;const t=[];for(let n=0;n<e.length;n+=1){const r=e[n],i=e[n+1];i&&r.vt===i.v0&&r.dir===i.dir?(t.push({s:r.s+i.s,t:r.t+i.t,v0:r.v0,vt:i.vt,dir:r.dir}),n+=1):t.push(r)}return t}const vn=(e,t,n)=>{const r=Math.sqrt(t**2+n**2),i=t/r,o=n/r;let a=t,s=n;const l=[];for(const t of e){const e=ln(t.v0),n=t.v0<=t.vt?1:-1,r=(ln(t.vt)-ln(t.v0))/(25e3*t.t),c=0|Math.abs(e*i),u=0|Math.abs(e*o),d=t.s*i|0,p=t.s*o|0,m=n*Math.abs(r*i)|0,f=n*Math.abs(r*o)|0;0===d&&0===p||0!==d&&0===c&&0===m||0!==p&&0===u&&0===f||(D.debug(`low-level-move: ${d}, ${p} with v0 ${c}, ${u} acc ${m}, ${f}`),l.push({initRate1:c,step1:d,accel1:m,initRate2:u,step2:p,accel2:f}),a-=d,s-=p)}return{LMParams:l,remaining:{a1:a,a2:s}}},yn={x:0,y:0,a1:0,a2:0,rate:0,pen:1};var bn=n(2105),wn=n(2221),xn=n(5589),En=n(7446),Cn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Cn.domAPI=v(),Cn.insertStyleElement=x(),h()(En.Z,Cn);var Sn=En.Z&&En.Z.locals?En.Z.locals:void 0;function Mn(){return(Mn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const An=({active:e,children:t,...n})=>r.createElement("div",Mn({className:m()(Sn.root,e?Sn.active:"")},n),t);An.propTypes={active:o().bool,children:o().node};var Pn=An,$n=n(3848),Tn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Tn.domAPI=v(),Tn.insertStyleElement=x(),h()($n.Z,Tn);var Zn=$n.Z&&$n.Z.locals?$n.Z.locals:void 0;const kn=(0,n(6010).f)("plotter");function Nn(){return(Nn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Fn=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),i=(0,r.useRef)(null);return r.createElement(Pn,Nn({active:t.phase===At},e),r.createElement("section",null,r.createElement("h3",null,"Setup"),r.createElement("p",null,"In this phase, you could"," ",r.createElement("input",{className:"hidden",type:"file",accept:"image/svg+xml",ref:i,onChange:async e=>{const{files:n}=e.target;n.length&&t.loadFromFile(n[0])}}),r.createElement(wn.Z,{variant:t.svgContent?"secondary":"primary",onClick:()=>{var e;kn("load svg"),null===(e=i.current)||void 0===e||e.click()}},"Load SVG")," ","and set up the page. Or simply ",r.createElement("b",null,"Drag & Drop")," your svg into the page area.")),r.createElement("section",{className:Zn.inputs},r.createElement("h4",{className:"col-span-2"},"Dimension"),r.createElement("label",{htmlFor:"page-size"},"Page Size: "),r.createElement("select",{id:"page-size",value:n.size.type,onChange:e=>{const t=Gt.find((t=>t.type===e.target.value));t&&n.setSize(t)}},Gt.map((e=>r.createElement("option",{key:e.type,value:e.type},e.alias)))),r.createElement("label",{htmlFor:"page-padding"},"Padding(mm): "),r.createElement("input",{id:"page-padding",type:"number",min:"0",value:n.padding,onChange:e=>n.setPadding(e.target.value)}),r.createElement("label",null,"Orientation:"),r.createElement("div",{className:"inline-flex items-center"},r.createElement("label",{className:m()(bn.Z.radioLabel,"mr-2")},r.createElement("input",{type:"radio",name:"orientation",value:Qt,checked:n.orientation===Qt,onChange:()=>n.setOrientation(Qt)}),r.createElement("span",null,"Landscape")),r.createElement("label",{className:bn.Z.radioLabel},r.createElement("input",{type:"radio",name:"orientation",value:Ht,checked:n.orientation===Ht,onChange:()=>n.setOrientation(Ht)}),r.createElement("span",null,"Portrait"))),r.createElement("label",{className:m()(bn.Z.checkboxLabel,"col-start-2"),htmlFor:"page-fit"},r.createElement("input",{type:"checkbox",id:"page-fit",checked:n.contentFitPage,onChange:e=>{n.setContentFitPage(e.target.checked)}}),r.createElement("span",null,"Fit content to page")),r.createElement("h4",{className:"col-span-2"},"Alignment"),r.createElement("label",{htmlFor:"page-align-h"},"Horizontal:"),r.createElement("select",{id:"page-align-h",value:n.alignment.horizontal,onChange:e=>n.setAlignmentHorizontal(e.target.value)},r.createElement("option",{value:Ut},"Left"),r.createElement("option",{value:Vt},"Center"),r.createElement("option",{value:Wt},"Right")),r.createElement("label",{className:"aw-label",htmlFor:"page-align-v"},"Vertical:"),r.createElement("select",{id:"page-align-v",value:n.alignment.vertical,onChange:e=>n.setAlignmentVertical(e.target.value)},r.createElement("option",{value:jt},"Top"),r.createElement("option",{value:qt},"Center"),r.createElement("option",{value:Bt},"Bottom"))),r.createElement("section",{className:"grid grid-cols-1 gap-4"},t.svgContent?r.createElement(xn.Z,{type:"info"},"Plan the motion before sending it to the plotter."):r.createElement(xn.Z,{type:"warn"},"Load SVG first."),r.createElement(wn.Z,{variant:t.svgContent?"primary":"secondary",disabled:!t.svgContent,onClick:()=>{t.setPhase(Pt),kn("go to",Pt)}},r.createElement("span",{className:"inline-block w-32"},"Next")),t.fileInfo&&r.createElement(r.Fragment,null,r.createElement("h4",null,"Svg Info:"),r.createElement("dl",{className:"grid grid-cols-2 gap-4"},t.fileInfo.map((e=>r.createElement(r.Fragment,null,r.createElement("dt",null,e[0]),r.createElement("dd",null,e[1]))))))))}));Fn.propTypes={};var Dn=Fn,On=n(3162),Ln=n(7536),zn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};zn.domAPI=v(),zn.insertStyleElement=x(),h()(Ln.Z,zn);var Rn=Ln.Z&&Ln.Z.locals?Ln.Z.locals:void 0;function _n(){return(_n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const In=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),[i,o]=(0,r.useState)(.2),[a,l]=(0,r.useState)(.1),c=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{t.phase===Pt&&c.current.click()}),[t.phase]),r.createElement(Pn,_n({active:t.phase===Pt},e),r.createElement("section",null,r.createElement("h3",null,"Planning"),r.createElement("p",{className:"mb-4"},"In this phase, the SVG would be transformed into coordinates on the page, then it will plan the motion for AxiDraw to plot the picture."),r.createElement(wn.Z,{onClick:()=>{t.setPhase(At),kn("go to",At)}},"Back to Setup")),r.createElement("section",null,r.createElement("form",{className:Rn.form,onSubmit:e=>{e.preventDefault(),kn("plan"),t.planMotion({screenToPageMatrix:n.screenToPageMatrix,origin:n.orientation===Qt?[0,0]:[s(n.size.height),0],connectedError:i,flatLineError:a})}},r.createElement("label",{htmlFor:"connected-error"},"Connected: "),r.createElement("input",{id:"connected-error",type:"number",min:"0",step:"0.05",max:"10",value:i,onChange:e=>o(parseFloat(e.target.value))}),r.createElement("label",{htmlFor:"flatten-error"},"Flatten: "),r.createElement("input",{id:"flatten-error",type:"number",min:"0",step:"0.01",max:"2",value:a,onChange:e=>l(parseFloat(e.target.value))}),r.createElement("div",{className:"col-start-2 grid grid-cols-2 gap-4"},r.createElement(wn.Z,{submit:!0,ref:c},"Re-plan"),r.createElement(wn.Z,{onClick:()=>{const e=new Blob([`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="${n.width}mm" height="${n.height}mm" viewBox="0 0 ${n.width} ${n.height}">\n  <g style="stroke: #000000; stroke-width: 0.1; fill: none;">\n      <path d="${t.linesAsPathDef}"></path>\n  </g>  \n</svg>\n`],{type:"image/svg+xml;charset=utf-8"});(0,On.saveAs)(e,`${t.filename}-aw.svg`)}},"Export SVG")))),r.createElement("section",{className:"grid grid-cols-1 gap-4"},r.createElement(xn.Z,{type:"info"},"Adjust parameters above and redo the planning until you are satisfied."),r.createElement(wn.Z,{variant:"primary",onClick:()=>{t.setPhase($t),kn("go to",$t)}},r.createElement("span",{className:"inline-block w-32"},"Next"))))}));In.propTypes={};var Qn=In,Hn=n(6370);const qn=[{cmd:an.r},{cmd:an.em,title:"Disable Motor",params:[0,0]},{cmd:an.tp},{cmd:an.sp,title:"Pen Up",params:[1]},{cmd:an.sp,title:"Pen Down",params:[0]}],jn=({device:e})=>{const[t,n]=(0,r.useState)(""),i=(0,r.useCallback)((async(t,r=[])=>{try{const i=await e.executeCommand(t,...r);n("object"==typeof i?JSON.stringify(i):i)}catch(e){n(e.toString())}}),[e]);return r.createElement("form",{className:bn.Z.root},r.createElement("h3",null,"Simple Debugger"),r.createElement(xn.Z,{type:"info"},"Debug AxiDraw before plotting here."),r.createElement("div",{className:"grid grid-cols-2 gap-2 lg:grid-cols-3"},qn.map((e=>{const t=e.title||e.cmd.title;return r.createElement(wn.Z,{key:t,onClick:()=>{i(e.cmd,e.params),kn("debug",t)}},t)}))),r.createElement("label",{className:bn.Z.inputLabel},r.createElement("span",null,"Result:"),r.createElement("textarea",{rows:"3",defaultValue:t,readOnly:!0})))};jn.propTypes={device:o().object.isRequired};var Bn=jn,Vn=n(3409),Un={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Un.domAPI=v(),Un.insertStyleElement=x(),h()(Vn.Z,Un);var Wn=Vn.Z&&Vn.Z.locals?Vn.Z.locals:void 0;function Gn(){return(Gn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Xn=(0,a.Pi)((({...e})=>{const{planning:t,work:n}=(0,r.useContext)(u),i=n.device.get(),o=n.plottingInProgress.get(),[a,s]=(0,r.useState)(null);return(0,r.useEffect)((()=>(n.setDevice(a),()=>{null==a||a.disconnectDevice()})),[a]),r.createElement(Pn,Gn({active:t.phase===$t},e),!i&&r.createElement("section",{className:"space-y-4"},r.createElement("h3",null,"Plotting"),r.createElement(xn.Z,{type:"warn"},"Please connect to device before plotting."),r.createElement("div",{className:"grid grid-cols-2 gap-6"},r.createElement(wn.Z,{onClick:()=>{t.setPhase(Pt),kn("go to",Pt)}},"Back to planning"))),r.createElement(Hn.Z,{onConnected:e=>s(e),onDisconnected:()=>s(null)}),i&&r.createElement("section",{className:"space-y-4"},r.createElement("h3",null,"Plotting"),r.createElement("form",{className:Wn.form,onSubmit:e=>{e.preventDefault(),o||(kn("control","plot"),n.plot({motions:t.motions}))}},r.createElement("label",{className:"mr-2"},"Constant"),r.createElement("div",{className:"flex items-center"},r.createElement("label",{className:m()(bn.Z.radioLabel,"mr-2")},r.createElement("input",{type:"radio",value:bt,disabled:n.plotterStatus!==ft,checked:n.speedMode===bt,onChange:()=>{n.setSpeedMode(bt)}}),r.createElement("span",null,"Velocity"))," ",r.createElement("label",{className:bn.Z.radioLabel},r.createElement("input",{type:"radio",value:wt,disabled:n.plotterStatus!==ft,checked:n.speedMode===wt,onChange:()=>{n.setSpeedMode(wt)}}),r.createElement("span",null,"Acceleration"))),n.speedMode===wt&&r.createElement(r.Fragment,null,r.createElement("h4",{className:"col-span-2"},"Moving Acceleration"),r.createElement("label",{htmlFor:"pen-down-accel"},"Pen Down"),r.createElement("input",{id:"pen-down-accel",type:"number",min:"100",step:"100",max:"100000",value:n.penDownMoveAccel,onChange:e=>n.setPenDownMoveAccel(parseFloat(e.target.value))})),r.createElement("h4",{className:"col-span-2"},"Moving Speed"," ",n.speedMode===wt&&"(Max)"),r.createElement("label",{htmlFor:"pen-down-speed"},"Pen Down"),r.createElement("input",{id:"pen-down-speed",type:"number",min:"1000",step:"100",max:"20000",value:n.penDownMoveSpeed,onChange:e=>n.setPenDownMoveSpeed(parseFloat(e.target.value))}),r.createElement("label",{htmlFor:"pen-up-speed"},"Pen Up"),r.createElement("input",{id:"pen-up-speed",type:"number",min:"1000",step:"100",max:"20000",value:n.penUpMoveSpeed,onChange:e=>n.setPenUpMoveSpeed(parseFloat(e.target.value))}),r.createElement("div",{className:"col-start-2"},n.plotterStatus===ft&&r.createElement(wn.Z,{variant:"primary",submit:!0},"Start"),r.createElement("div",{className:"grid grid-cols-2 gap-4"},n.plotterStatus===gt&&r.createElement(wn.Z,{onClick:()=>{n.pause(),kn("control","pause")},disabled:null!==n.control.get()},"Pause"),n.plotterStatus===ht&&r.createElement(wn.Z,{onClick:()=>{n.resume(),kn("control","resume")}},"Resume"),n.plotterStatus!==ft&&r.createElement(wn.Z,{onClick:()=>{n.stop(),kn("control","stop")},disabled:null!==n.control.get()},"Stop"))))),i&&n.plotterStatus===ft&&r.createElement(Bn,{device:i}))}));Xn.propTypes={};var Yn=Xn;const Kn=(0,pt.ky)({size:Xt,padding:Xt.defaultPadding,orientation:Qt,alignment:{vertical:qt,horizontal:Vt},contentFitPage:!0,get width(){return this.orientation===Qt?this.size.width:this.size.height},get height(){return this.orientation===Qt?this.size.height:this.size.width},setSize(e){this.size=e,this.padding=e.defaultPadding},setPadding(e){this.padding=e},setOrientation(e){this.orientation=e},setAlignmentVertical(e){this.alignment.vertical=e},setAlignmentHorizontal(e){this.alignment.horizontal=e},setContentFitPage(e){this.contentFitPage=e},get contentPreserveAspectRatio(){return`${{[Ut]:"xMin",[Vt]:"xMid",[Wt]:"xMax"}[this.alignment.horizontal]}${{[jt]:"YMin",[qt]:"YMid",[Bt]:"YMax"}[this.alignment.vertical]} meet`},get screenToPageMatrix(){const e=l(1),t=new DOMMatrix;if(t.scaleSelf(e),this.orientation===Qt)return t;const n=new DOMMatrix;n.translateSelf(-this.size.height,0);const r=new DOMMatrix;return r.rotateSelf(0,0,-90),r.multiply(n).multiply(t)},get pageToScreenMatrix(){return this.screenToPageMatrix.inverse()}}),Jn=(0,pt.ky)({svgContent:null,filename:null,lines:null,motions:null,fileInfo:null,previewStrokeWidth:.4,setPreviewStrokeWidth(e){this.previewStrokeWidth=e},phase:At,setPhase(e){this.phase=e},loadFromUrl(e){fetch(e).then((e=>e.text())).then((t=>{const n=e.split("/").pop();this.loadSVGContent(n.split(/\.svg/i)[0],t)}))},loadFromFile(e){const t=new FileReader;t.onload=t=>{this.loadSVGContent(e.name,t.target.result)},t.readAsText(e)},loadSVGContent(e,t){this.filename=e.split(/\.svg/i)[0],this.svgContent=t,this.lines=null,this.motions=null},updateFileInfo(e){this.fileInfo=e},updateLines(e){this.lines=e,this.motions=null},planMotion(e){var t;if(null===(t=this.lines)||void 0===t||!t.length)throw new Error("Lines are not ready");this.motions=function(e,t={}){return[...Ct(e,{...St,...t})]}(this.lines,e)},get linesAsPathDef(){var e;return Mt(null===(e=this.motions)||void 0===e?void 0:e.filter((e=>0===e.pen)).map((e=>e.line)))},get connectionsAsPathDef(){var e;return Mt(null===(e=this.motions)||void 0===e?void 0:e.filter((e=>1===e.pen)).map((e=>e.line)))}},null,{name:"axidraw-web-work",deep:!1}),er=(0,pt.ky)({device:pt.LO.box(null,{deep:!1}),setDevice(e){this.device.set(e);const t=this.plottingInProgress.get();!e&&t&&(t.return(),this.plottingInProgress.set(null))},speedMode:bt,setSpeedMode(e){this.speedMode=e},penDownMoveAccel:pt.LO.box(4e4),penDownMoveSpeed:pt.LO.box(5e3),penUpMoveSpeed:pt.LO.box(1e4),setPenDownMoveAccel(e){this.penDownMoveAccel.set(e)},setPenDownMoveSpeed(e){this.penDownMoveSpeed.set(e)},setPenUpMoveSpeed(e){this.penUpMoveSpeed.set(e)},control:pt.LO.box(null),plotterStatus:ft,plottingInProgress:pt.LO.box(null,{deep:!1}),async plot({motions:e}){const t=this.device.get();if(!t)throw new Error("Device is not connect.");const n=async function*({device:e,speedMode:t,penUpMoveSpeed:n,penDownMoveSpeed:r,penDownMoveAccel:i,motions:o,control:a}){let s=null;const l=async()=>{s={...yn},await e.executeCommand(an.r),await e.executeCommand(an.sp,1,500),await e.executeCommand(an.sr,6e4)};await l();let c=0;try{for(let l=0,u=o.length;l<u;l+=1){const{line:u,pen:d}=o[l];let p=a.get();p===vt&&(D.debug("action: pause"),await e.executeCommand(an.sp,1,500),s.pen=1,p=yield ht);const m=p===yt;m&&D.debug("action: stop");const f=m?1:d,h=m?[s.x,s.y,0,0]:u;s.pen!==f&&(D.debug("pen "+(1===f?"up":"down")),await e.executeCommand(an.sp,f,500),s.pen=f,s.rate=0);const g=0===f?r.get():n.get(),v=un({x:h[2],y:h[3]}),y=v.a1-s.a1,b=v.a2-s.a2,w=Math.sqrt(y**2+b**2);let x=0,E=0,C=0;if(t===bt){const t=Math.abs(y),n=Math.abs(b),r=1310*t,i=1310*n;if(x=Math.ceil(w/g*1e3),x>r&&x>i&&(x=Math.max(r,i)),x>r&&t>0){D.warn(`Vertical edge occurs: SM,${x},${y},${b}`);for(const{longStep:t,shortStep:n,time:r,remaining:i}of pn({t:x,stepLong:b,stepShort:y}))await e.executeCommand(an.sm,r,n,t),C=i}else if(x>i&&n>0){D.warn(`Horizontal edge occurs: SM,${x},${y},${b}`);for(const{longStep:t,shortStep:n,time:r,remaining:i}of pn({t:x,stepLong:y,stepShort:b}))await e.executeCommand(an.sm,r,t,n),E=i}else x>0&&(D.debug(`step-move: ${y}, ${b} in ${x}ms`),await e.executeCommand(an.sm,x,y,b));s.rate=g}else{const t=i.get(),n=fn(o,l,s.rate,g,t,w),r=hn(w,s.rate,g,n,t),{LMParams:a,remaining:c}=vn(gn(r),y,b);for(const{initRate1:t,step1:n,accel1:r,initRate2:i,step2:o,accel2:s}of a)await e.executeCommand(an.lm,t,n,r,i,o,s,3);E=c.a1,C=c.a2,x=1e3*r.reduce(((e,t)=>e+t.t),0),s.rate=n}if(s.x=h[2],s.y=h[3],s.a1=v.a1-E,s.a2=v.a2-C,c=x,m){D.debug("stop plotting");break}}c+=3e3,D.debug(`pen is homing: ${c}`),await(0,dn.g)(c)}catch(e){D.error(e)}finally{await l(),D.debug("finished plotting")}return ft}({device:t,motions:e,speedMode:this.speedMode,penDownMoveAccel:this.penDownMoveAccel,penUpMoveSpeed:this.penUpMoveSpeed,penDownMoveSpeed:this.penDownMoveSpeed,control:this.control});this.plottingInProgress.set(n),await this.resume()},async resume({action:e}={}){const t=this.plottingInProgress.get();if(!t)return;this.plotterStatus=gt;const n=await t.next(e);this.plotterStatus=n.value,this.control.set(null),n.done&&(this.plottingInProgress.set(null),this.device.get().disconnectDevice())},pause(){this.control.set(vt)},async stop(){this.plotterStatus===ht?this.resume({action:yt}):this.control.set(yt)}});var tr=()=>r.createElement(u.Provider,{value:{planning:Jn,page:Kn,work:er}},r.createElement("main",{className:on.workspace},r.createElement(tn,null)),r.createElement("aside",{className:on.panel},r.createElement(Dn,null),r.createElement(Qn,null),r.createElement(Yn,null)))},9062:function(e,t,n){"use strict";n.d(t,{g:function(){return r},V:function(){return i}});const r=e=>new Promise((t=>{setTimeout(t,e)})),i=(e,t)=>new Promise(((n,r)=>{setTimeout((()=>{r(new Error(t))}),e)}))},7446:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,'._10ryd{bottom:0;left:0;position:absolute;right:0;top:0}._10ryd>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}._10ryd{display:none;overflow-y:scroll;padding-left:2rem;padding-right:2rem}._10ryd:after,._10ryd:before{content:"";height:2rem}._2RtXA,._10ryd:after,._10ryd:before{display:block}',""]),i.locals={root:"_10ryd",active:"_2RtXA"},t.Z=i},7536:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._3eMFG{align-items:center;display:grid;gap:1rem;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;margin-bottom:1rem}",""]),i.locals={form:"_3eMFG"},t.Z=i},3409:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._3iEUx{align-items:center;display:grid;gap:1rem;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;margin-bottom:1rem}",""]),i.locals={form:"_3iEUx"},t.Z=i},3848:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._11H5z{align-items:center;display:grid;gap:1rem;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;margin-bottom:1rem}",""]),i.locals={inputs:"_11H5z"},t.Z=i},9930:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._2uf5o{fill:none}._1w0lW{stroke-width:1mm;stroke-linejoin:round;stroke-linecap:round}.uNj6-{stroke:red}._25v8K{stroke:#0f0}._2lXdL{fill:#00f}",""]),i.locals={root:"_2uf5o",axis:"_1w0lW",x:"uNj6-",y:"_25v8K",z:"_2lXdL"},t.Z=i},306:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,".VetUz{fill:rgba(0,0,0,.25)}.Iwi1G{fill:#fff}.Iwi1G.CZ6FL{fill:#eef}._1Q1eR{fill:none;stroke:#b8b8b8;stroke-width:.4mm;stroke-dasharray:5 5}",""]),i.locals={shadow:"VetUz",paper:"Iwi1G",dropping:"CZ6FL",printable:"_1Q1eR"},t.Z=i},3273:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,":root{--planning-stroke-width:1}.py2vP{stroke-width:var(--planning-stroke-width);stroke-linecap:round;stroke-linejoin:round;fill:none}._1iEPV{stroke:#e2e2e2}._3HiNq{stroke:#333}",""]),i.locals={root:"py2vP",motionPenUp:"_1iEPV",motionPenDown:"_3HiNq"},t.Z=i},2849:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._1MCds *{stroke:#333!important}",""]),i.locals={root:"_1MCds"},t.Z=i},518:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._1VH7z{height:100%;width:100%}",""]),i.locals={root:"_1VH7z"},t.Z=i},4697:function(e,t,n){"use strict";var r=n(3645),i=n.n(r)()((function(e){return e[1]}));i.push([e.id,"._3w6hI{right:0;right:450px}._3jRw_,._3w6hI{bottom:0;left:0;position:fixed;top:0}._3jRw_{background-color:#efefef;font-size:1rem;left:auto;line-height:1.5rem;right:0;width:450px}",""]),i.locals={workspace:"_3w6hI",panel:"_3jRw_"},t.Z=i}}]);