(self.webpackChunkaxidraw_web=self.webpackChunkaxidraw_web||[]).push([[71],{3326:function(e,t,n){"use strict";var r=n(848),a=n(1980),i=n(5374);t.Z=(0,r.fA)("EM","Enable Motors",(function*(e,t){const n=yield`EM,${[e,t].join(",")}\r`;return yield*(0,a.Z)(n)}),{execution:i.x1})},8315:function(e,t,n){"use strict";var r=n(848),a=n(5374);t.Z=(0,r.fA)("QB","Query button",(function*(){const e=yield"QB\r",t=yield*(0,r.Tb)(a.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.2"})},5707:function(e,t,n){"use strict";var r=n(848),a=n(1980);t.Z=(0,r.fA)("R","Reset",(function*(){let e=yield"R\r";const t=yield*(0,a.Z)(e);return e=yield t,yield*(0,a.Z)(e)}))},1632:function(e,t,n){"use strict";var r=n(848),a=n(5374),i=n(1980);t.Z=(0,r.fA)("SM","Stepper move",(function*(e,t,n){const a=yield(0,r.iW)(`SM,${e},${t}`,n);return yield*(0,i.Z)(a)}),{execution:a.x1})},1519:function(e,t,n){"use strict";var r=n(848),a=n(5374),i=n(1980);t.Z=(0,r.fA)("SP","Set pen state",(function*(e,t,n){const a=yield(0,r.iW)(`SP,${e}`,t,n);return yield*(0,i.Z)(a)}),{execution:a.x1})},2206:function(e,t,n){"use strict";var r=n(848),a=n(5374);t.Z=(0,r.fA)("V","Version",(function*(){const e=yield"V\r",t=yield*(0,r.Tb)(a.Hr,e);return(0,r.F7)(t,(e=>e.trim()))}))},1980:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(5374),a=n(848);function*i(e){const t=yield*(0,a.Tb)(r.Pz,e);return(0,a.F7)(t,(e=>e.trim()))}},848:function(e,t,n){"use strict";n.d(t,{kg:function(){return a},Hq:function(){return i},fA:function(){return o},Jx:function(){return s},cv:function(){return l},iW:function(){return u},Tb:function(){return b},F7:function(){return v},Ye:function(){return f}});var r=n(5901);const a=n.n(r)().get("ebb"),i=e=>parseInt(e,10),o=(e,t,n,r)=>({cmd:e,title:t,create:n,...r}),c=new TextDecoder,s=e=>c.decode(Uint8Array.from(e)),d=new TextEncoder,l=e=>d.encode(e),u=(e,...t)=>{let n=e;for(const e of t){if(void 0===e)break;n+=`,${e}`}return`${n}\r`},b=function*(e,t){let n="",r=-1,a=0,i=t;do{const t=s(i);if(n+=t,r=n.indexOf(e),-1!==r){r+=e.length;break}i=yield{consumed:t.length},a+=t.length}while(-1===r);return{result:n.substring(0,r).trimStart(),consumed:r-a,remain:n.substring(r)}},v=(e,t)=>({...e,result:t(e.result)}),f=(e,t)=>{const[n,r,a]=e.split("."),[i,o,c]=t.split(".");return i<n||!(n<i)&&(o<r||!(r<o)&&c<=a)}},6370:function(e,t,n){"use strict";n.d(t,{Z:function(){return j}});var r=n(7294),a=n(5697),i=n.n(a);const o="axidraw-web-device-type-usb",c="axidraw-web-device-type-ws",s="axidraw-web-device-event-connected",d="axidraw-web-device-event-disconnected",l="axidraw-web-ws-status-disconnected",u="axidraw-web-ws-status-standby",b="axidraw-web-ws-event-connected",v="axidraw-web-ws-event-disconnected",f="axidraw-web-ws-event-message";var p=n(7187),m=n.n(p),w=n(848),g=n(5374);function*y(){let e=null,t="";do{const n=yield e;e=yield*(0,w.Tb)(g.G7,n),t+=e.result}while("!"===e.remain[0]);return{...e,result:t}}function*h(e){let t=[],n=null;for(;;){const r=yield;for(t.push(...new Uint8Array(r));t.length;)if(e.length){t[0]==="!".charCodeAt(0)&&(n||(n=y(),n.next()));const r=e[0],a=n||r.parser,i=a.next(t),{result:o,consumed:c}=i.value;c&&(t=t.slice(c)),i.done&&(a===n?(n=null,r.reject(o)):(w.kg.debug(`Received message: ${o}`),r.resolve(o)),e.shift())}else{const e=(0,w.Jx)(t);w.kg.debug(`Discard garbage message: ${e}`),t.length=0}}}var k=n(5901),x=n.n(k),E=n(2206),D=n(5707),S=n(9062);const C=x().get("device"),Z=async e=>e[0],_=({isReady:e,checkStatus:t,send:n,disconnect:r,onDisconnected:a})=>({isReady:e,checkStatus:t,send:n,disconnect:r,onDisconnected:a}),T=({type:e,connectDevice:t})=>{let n=null,r="";const a=new(m()),i=[],o=async(e,...t)=>{if(!n)throw new Error("Device is not connected yet");return n.checkStatus(),(async(e,t,n,r,...a)=>{if(!r)throw new Error("Invalid command.");if(r.version&&!(0,w.Ye)(e,r.version))throw new Error(`"${r.title}" command expects higher firmware version: ${r.version}.`);const i=r.create(...a),o=i.next();return await t(o.value),o.done?Promise.resolve():Promise.race([new Promise(((e,t)=>{n.push({resolve:e,reject:t,parser:i})})),(0,S.V)(6e4,`EBB Command timeout: ${r.cmd}`)])})(r,(e=>n.send(e)),i,e,...t)};return{connectDevice:async(...e)=>{var c;if(null===(c=n)||void 0===c||!c.isReady){n=await t(i,...e),n.onDisconnected((e=>{i.length=0,n=null,r="",a.emit(d,e)})),await o(D.Z);const c=await o(E.Z);r=c.match(/\d\.\d\.\d/)[0],a.emit(s)}},disconnectDevice:async()=>{var e;null!==(e=n)&&void 0!==e&&e.isReady&&await n.disconnect()},executeCommand:o,on(e,t){a.on(e,t)},off(e,t){a.off(e,t)},get type(){return e},get version(){return r},get isConnected(){var e;return null===(e=n)||void 0===e?void 0:e.isReady}}},A=({devicePicker:e})=>async(t,n=!1)=>{if(!navigator.usb)throw new Error("WebUSB feature is not supported in this browser!");let r;const a=new(m()),i=await navigator.usb.getDevices();if(i.forEach((e=>{C.debug(`Found device: ${e.productName}`)})),n||!i.length){if(r=await navigator.usb.requestDevice({filters:[{vendorId:1240,productId:64914}]}),!r)throw new Error("No EBB communication.device available.")}else r=await e(i);return r.opened||(C.debug("Opening communication.device..."),await r.open()),C.debug("Selecting configuration.."),await r.selectConfiguration(1),C.debug("Claiming interface..."),await r.claimInterface(1),setTimeout((async()=>{C.debug("Start listening data.");const e=h(t);e.next();try{for(;;){var n;if(null===(n=r)||void 0===n||!n.opened){C.debug("Stop listening data.");break}const t=await r.transferIn(2,64);if("ok"!==t.status)throw new Error(`Unexpected response status: ${t.status}`);e.next(t.data.buffer)}}catch(t){e.return(),C.debug(t.message),a.emit(d,t.message)}})),_({get isReady(){var e;return(null===(e=r)||void 0===e?void 0:e.configuration.interfaces.findIndex((e=>e.claimed)))>=0},checkStatus(){if(!r.opened)throw new Error("Device is not opened");if(!r.configuration.interfaces.find((e=>e.claimed)))throw new Error("Device interface is not claimed")},async send(e){C.debug("Send to communication.device: ",e);const t=(0,w.cv)(e);if("ok"!==(await r.transferOut(2,t)).status)throw new Error("Can not sent command to communication.device.")},async disconnect(){C.debug("Closing communication.device..."),await r.close(),C.debug("Device is closed")},onDisconnected(e){a.on(d,e)}})},P=({devicePicker:e})=>async(t,n,r)=>{if(!window.WebSocket)throw new Error("WebSocket feature is not supported in this browser!");return new Promise(((a,i)=>{const o=h(t);o.next();const c=((e,t,n)=>{const r=new(m()),a=new WebSocket(e);let i=l;a.binaryType="arraybuffer";const o=e=>{a.send(JSON.stringify(e))};return a.onopen=()=>{i="axidraw-web-ws-status-connected",o({type:"auth",code:t})},a.onmessage=e=>{const t=JSON.parse(e.data);switch(t.type){case"devices":i="axidraw-web-ws-status-authorized",n(t.devices).then((e=>{o({type:"device_id",device:e.path})}));break;case"ready":i=u,r.emit(b);break;case"ebb":r.emit(f,Uint8Array.from(t.resp.data));break;default:throw new Error(`Unknown message type: ${t.type}`)}},a.onerror=()=>{r.emit(v,"Host is not available.")},a.onclose=e=>{switch(C.debug(`Device is closed: [${e.code}]${e.reason}`),i=l,e.code){case 3e3:r.emit(v,"Forbidden: password is incorrect.");break;case 3001:r.emit(v,`Device is not available. ${e.reason}`);break;case 3002:r.emit(v,"Device is not connected.");break;case 3003:r.emit(v,"Unknown message type.");break;case 3004:r.emit(v,"Disconnect from client.");break;case 3005:r.emit(v,"Server internal error.");break;case 1006:r.emit(v,"Disconnect from server.");break;default:r.emit(v,e.reason)}},{onConnected(e){r.on(b,e)},onMessage(e){r.on(f,e)},onDisconnected(e){r.on(v,e)},send(e){o({type:"command",command:e})},close(){a.close(3004)},get status(){return i}}})(n,r,e),s=new(m());c.onConnected((()=>{a(_({get isReady(){return c.status===u},checkStatus(){if(c.status!==u)throw new Error("Device is not ready.")},send(e){C.debug(`Send to communication.device: ${e}`),c.send(e)},disconnect(){c.close()},onDisconnected(e){s.on(d,e)}}))})),c.onMessage((e=>{o.next(e)})),c.onDisconnected((e=>{o.return(),s.emit(d,e),C.debug("Device is closed",e),i(e)}))}))};function N(e,t){switch(e){default:case o:return function({devicePicker:e}){return T({type:o,connectDevice:A({devicePicker:e})})}({devicePicker:t});case c:return function({devicePicker:e}){return T({type:c,connectDevice:P({devicePicker:e})})}({devicePicker:t})}}var R=n(475);const O="axidraw_web_device_status_connected",$="axidraw_web_device_status_disconnected",B=!!navigator.usb;var F=n(2105),W=n(2221),q=n(5589);const U=`wss://${window.location.host}/axidraw`,I=({onConnected:e,onDisconnected:t})=>{const{deviceStatus:n,deviceType:a,setDeviceType:i,deviceVersion:l,device:u,connectionError:b,connectDevice:v,disconnectDevice:f}=(()=>{const[e,t]=(0,r.useState)($),[n,a]=(0,r.useState)(B?o:c),[i,l]=(0,r.useState)(null),[u,b]=(0,r.useState)(null),[v,f]=(0,r.useState)(null);(0,r.useEffect)((()=>{e!==O&&b(N(n,Z))}),[n,e]),(0,r.useEffect)((()=>{f(null)}),[u,n,t]),(0,r.useEffect)((()=>()=>{null==u||u.disconnectDevice()}),[u]),(0,r.useEffect)((()=>{const e=()=>{t(O),l(u.version)},n=e=>{t($),l(""),e&&f(e)};return null==u||u.on(s,e),null==u||u.on(d,n),()=>{null==u||u.off(s,e),null==u||u.off(d,n)}}),[u]);const p=(0,r.useCallback)((async(...t)=>{if(u&&e===$)try{await u.connectDevice(...t)}catch(e){f(e.toString()),await u.disconnectDevice()}else f(u?"Device is already connected yet.":"Device is not created yet.")}),[u]),m=(0,r.useCallback)((async()=>{if(u&&e===O)try{await u.executeCommand(R.r),await u.disconnectDevice()}catch(e){f(e.toString())}else f("Device is not connected yet.")}),[u,e]);return{device:u,deviceType:n,setDeviceType:a,deviceStatus:e,deviceVersion:i,connectionError:v,connectDevice:p,disconnectDevice:m}})(),[p,m]=(0,r.useState)(U),[w,g]=(0,r.useState)("axidraw-web");return(0,r.useEffect)((()=>{n===O?e(u):t(u)}),[u,n]),r.createElement("div",{className:"grid grid-cols-1 gap-4"},r.createElement("h3",null,"Device"),n===$&&r.createElement(r.Fragment,null,r.createElement("p",null,"Connect to AxiDraw via USB or WebSocket."),r.createElement("label",{className:F.Z.radioLabel},r.createElement("input",{type:"radio",value:o,checked:a===o,onChange:()=>i(o)})," ",r.createElement("span",null,"USB")),r.createElement("label",{className:F.Z.radioLabel},r.createElement("input",{type:"radio",value:c,checked:a===c,onChange:()=>i(c)})," ",r.createElement("span",null,"WebSocket")),b&&r.createElement(q.Z,{type:"alert"},b),a===o&&r.createElement("div",{className:"grid grid-cols-2 gap-4 lg:gap-6"},r.createElement(W.Z,{onClick:()=>{v(!0)}},"Pair"),r.createElement(W.Z,{variant:"primary",onClick:()=>{v()}},"Connect")),a===c&&r.createElement(r.Fragment,null,r.createElement("label",{className:F.Z.inputLabel},r.createElement("span",null,"URL:"),r.createElement("input",{type:"text",value:p,onChange:e=>m(e.target.value)})),r.createElement("label",{className:F.Z.inputLabel},r.createElement("span",null,"Password:"),r.createElement("input",{type:"password",value:w,onChange:e=>g(e.target.value)})),r.createElement(W.Z,{variant:"primary",onClick:()=>{v(p,w)}},"Connect"))),n===O&&r.createElement(r.Fragment,null,r.createElement("div",{className:"grid grid-flow-col items-center gap-4"},r.createElement("p",null,a===o?"USB":"WebSocket"),r.createElement("p",null,"EBB v",l),r.createElement(W.Z,{onClick:()=>f()},"Disconnect"))))};I.propTypes={onConnected:i().func,onDisconnected:i().func};var j=I},5589:function(e,t,n){"use strict";n.d(t,{Z:function(){return k}});var r=n(7294),a=n(5697),i=n.n(a),o=n(4184),c=n.n(o),s=n(3379),d=n.n(s),l=n(7795),u=n.n(l),b=n(695),v=n.n(b),f=n(9216),p=n.n(f),m=n(2468),w={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=v()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};w.domAPI=u(),w.insertStyleElement=p(),d()(m.Z,w);var g=m.Z&&m.Z.locals?m.Z.locals:void 0;function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const h=({type:e="info",children:t,...n})=>r.createElement("div",y({className:c()(g.root,g[e])},n),t);h.propTypes={type:i().oneOf(["info","warn","alert","success"]),children:i().node.isRequired};var k=h},2221:function(e,t,n){"use strict";n.d(t,{Z:function(){return k}});var r=n(7294),a=n(5697),i=n.n(a),o=n(4184),c=n.n(o),s=n(3379),d=n.n(s),l=n(7795),u=n.n(l),b=n(695),v=n.n(b),f=n(9216),p=n.n(f),m=n(2785),w={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=v()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};w.domAPI=u(),w.insertStyleElement=p(),d()(m.Z,w);var g=m.Z&&m.Z.locals?m.Z.locals:void 0;function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const h=({variant:e="secondary",submit:t,children:n,...a},i)=>r.createElement("button",y({className:c()(g.root,g[e]),type:t?"submit":"button",ref:i},a),n);h.propTypes={variant:i().oneOf(["primary","secondary"]),children:i().node.isRequired,submit:i().bool};var k=(0,r.forwardRef)(h)},2468:function(e,t,n){"use strict";var r=n(3645),a=n.n(r)()((function(e){return e[1]}));a.push([e.id,"._9kj2{--tw-text-opacity:1;border-radius:.25rem;color:rgba(51,51,51,var(--tw-text-opacity));display:block;padding:1rem}._1BaOk{background-color:rgba(221,247,255,var(--tw-bg-opacity))}._1BaOk,.WNgDe{--tw-bg-opacity:1}.WNgDe{background-color:rgba(253,225,203,var(--tw-bg-opacity))}.bttbk{background-color:rgba(245,255,195,var(--tw-bg-opacity))}._2NaAw,.bttbk{--tw-bg-opacity:1}._2NaAw{background-color:rgba(255,203,203,var(--tw-bg-opacity))}",""]),a.locals={root:"_9kj2",info:"_1BaOk",warn:"WNgDe",success:"bttbk",alert:"_2NaAw"},t.Z=a},2785:function(e,t,n){"use strict";var r=n(3645),a=n.n(r)()((function(e){return e[1]}));a.push([e.id,"._3oqR9{--tw-text-opacity:1;--tw-bg-opacity:1;background-color:rgba(236,233,230,var(--tw-bg-opacity));border-radius:.25rem;color:rgba(51,51,51,var(--tw-text-opacity));display:inline-block;line-height:1;padding:.5rem 1rem;white-space:nowrap}._3oqR9:not([disabled]):hover{--tw-bg-opacity:1;background-color:rgba(245,243,240,var(--tw-bg-opacity))}._3oqR9:not([disabled]):focus{--tw-bg-opacity:1;background-color:rgba(219,215,214,var(--tw-bg-opacity))}._3oqR9[disabled]{--tw-text-opacity:1;color:rgba(202,199,198,var(--tw-text-opacity))}._1sbJ-{--tw-bg-opacity:1;--tw-text-opacity:1;background-color:rgba(79,167,255,var(--tw-bg-opacity));color:rgba(255,255,255,var(--tw-text-opacity))}._1sbJ-:not([disabled]):hover{--tw-bg-opacity:1;background-color:rgba(61,147,229,var(--tw-bg-opacity))}._1sbJ-:not([disabled]):focus{--tw-bg-opacity:1;background-color:rgba(43,131,214,var(--tw-bg-opacity))}._1sbJ-[disabled]{--tw-bg-opacity:1;--tw-text-opacity:1;background-color:rgba(236,233,230,var(--tw-bg-opacity));color:rgba(202,199,198,var(--tw-text-opacity))}a._3oqR9{cursor:pointer;text-decoration:none}",""]),a.locals={root:"_3oqR9",primary:"_1sbJ-"},t.Z=a},849:function(e,t,n){"use strict";var r=n(3645),a=n.n(r)()((function(e){return e[1]}));a.push([e.id,".f94ob{display:grid;gap:1rem;grid-template-columns:repeat(1,minmax(0,1fr))}@media (min-width:1024px){.f94ob{gap:1.5rem}}._18tDx,._1mOZw{align-items:center;display:inline-flex}._18tDx span,._1mOZw span{margin-left:.5rem}._18tDx input[disabled],._1mOZw input[disabled]{--tw-bg-opacity:1;background-color:rgba(241,237,237,var(--tw-bg-opacity))}._3FTaA{align-items:stretch;display:inline-flex;flex-direction:column}._3FTaA span{margin-bottom:.5rem}._3FTaA input[disabled],._3FTaA select[disabled],._3FTaA textarea[disabled]{--tw-bg-opacity:1;background-color:rgba(241,237,237,var(--tw-bg-opacity))}",""]),a.locals={root:"f94ob",checkboxLabel:"_18tDx",radioLabel:"_1mOZw",inputLabel:"_3FTaA"},t.Z=a},2105:function(e,t,n){"use strict";var r=n(3379),a=n.n(r),i=n(7795),o=n.n(i),c=n(695),s=n.n(c),d=n(9216),l=n.n(d),u=n(849),b={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=s()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};b.domAPI=o(),b.insertStyleElement=l(),a()(u.Z,b),t.Z=u.Z&&u.Z.locals?u.Z.locals:void 0}}]);