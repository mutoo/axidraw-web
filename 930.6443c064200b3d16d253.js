(self.webpackChunkaxidraw_web=self.webpackChunkaxidraw_web||[]).push([[930],{5374:function(e,t,n){"use strict";n.d(t,{G7:function(){return r},Hr:function(){return o},d4:function(){return i},Pz:function(){return a},x1:function(){return s},FP:function(){return l}});const r="\r",o="\r\n",i="\n\r",a="OK\r\n",s=1,l=2029},7369:function(e,t,n){"use strict";n.d(t,{em:function(){return a},lm:function(){return s},qb:function(){return l.Z},r:function(){return c.Z},sc:function(){return u},sm:function(){return d.Z},sp:function(){return p.Z},sr:function(){return m},tp:function(){return h}});var r=n(848),o=n(5374);(0,r.fA)("A","Get analog values",(function*(){const e=yield"A\r",t=yield*(0,r.Tb)(o.Hr,e);return(0,r.F7)(t,(e=>e.trim().substr(2).split(",").reduce(((e,t)=>{const[n,o]=t.split(":");return{...e,[(0,r.Hq)(n)]:(0,r.Hq)(o)}}),{})))}),{version:"2.2.3"});var i=n(1980);(0,r.fA)("AC","Analog configure",(function*(e,t){const n=yield`AC,${[e,t].join(",")}\r`;return yield*(0,i.Z)(n)}),{version:"2.2.3"}),(0,r.fA)("BL","Enter bootloader",(function*(){const e=yield"BL\r";return yield*(0,i.Z)(e)}),{version:"1.9.5"}),(0,r.fA)("C","Configure pin direction",(function*(e,t,n,r,o){const a=yield`C,${[e,t,n,r,o].join(",")}\r`;return yield*(0,i.Z)(a)})),(0,r.fA)("CK","Check input",(function*(e,t,n,i,a,s,l,c){const u=yield`CK,${[e,t,n,i,a,s,l,c].join(",")}\r`,d=yield*(0,r.Tb)(o.Pz,u);return(0,r.F7)(d,(e=>e.substring(0,e.length-6).split(/\s+/).map(((e,t)=>{const n=e.split("=")[1];return t<6?(0,r.Hq)(n):n}))))})),(0,r.fA)("CS","Clear step position",(function*(){const e=yield"CS\r";return yield*(0,i.Z)(e)}),{version:"2.4.3"}),(0,r.fA)("CU","Configure user options",(function*(e,t){const n=yield`CU,${[e,t].join(",")}\r`;return yield*(0,i.Z)(n)}));var a=(0,r.fA)("EM","Enable Motors",(function*(e,t){const n=yield`EM,${[e,t].join(",")}\r`;return yield*(0,i.Z)(n)}),{execution:o.x1});(0,r.fA)("ES","E stop",(function*(e){const t=yield(0,r.iW)("ES",e),n=yield*(0,r.Tb)(o.Pz,t);return(0,r.F7)(n,(e=>{const t=e.substring(0,e.length-6).split(",").map(r.Hq);return{interrupted:t[0],axis1:{steps:t[1],remain:t[3]},axis2:{steps:t[2],remain:t[4]}}}))}),{version:"2.2.7"}),(0,r.fA)("HM","Home or absolute move",(function*(e,t,n){const o=yield(0,r.iW)(`HM,${e}`,t,n);return yield*(0,i.Z)(o)}),{execution:o.x1,version:"2.6.2"}),(0,r.fA)("I","Input (digital)",(function*(){const e=yield"I\r",t=yield*(0,r.Tb)(o.Hr,e);return(0,r.F7)(t,(e=>e.trim().substr(2).split(",").map(r.Hq)))}));var s=(0,r.fA)("LM","Low-level move, step-limited",(function*(e,t,n,o,a,s,l){const c=yield(0,r.iW)(`LM,${[e,t,n,o,a,s].join(",")}`,l);return yield*(0,i.Z)(c)}),{execution:o.x1,version:"2.7.0"});(0,r.fA)("LT","Low-level move, time-limited",(function*(e,t,n,o,a,s){const l=yield(0,r.iW)(`LT,${[e,t,n,o,a].join(",")}`,s);return yield*(0,i.Z)(l)}),{execution:o.x1,version:"2.7.0"}),(0,r.fA)("MR","Memory Read",(function*(e){const t=yield`MR,${e}\r`,n=yield*(0,r.Tb)(o.Hr,t);return(0,r.F7)(n,(e=>(0,r.Hq)(e.substr(3))))})),(0,r.fA)("MW","Memory Write",(function*(e,t){const n=yield`MW,${e},${t}\r`;return yield*(0,i.Z)(n)})),(0,r.fA)("ND","Node count decrement",(function*(){const e=yield"ND\r";return yield*(0,i.Z)(e)}),{version:"1.9.5"}),(0,r.fA)("NI","Node count increment",(function*(){const e=yield"NI\r";return yield*(0,i.Z)(e)}),{version:"1.9.5"}),(0,r.fA)("O","Output (digital)",(function*(e,t,n,o,a){const s=yield(0,r.iW)(`O,${e}`,t,n,o,a);return yield*(0,i.Z)(s)})),(0,r.fA)("PC","Pulse configure",(function*(e,t,n,o,a,s,l,c){const u=yield(0,r.iW)(`PC,${e},${t}`,n,o,a,s,l,c);return yield*(0,i.Z)(u)})),(0,r.fA)("PD","Pin direction",(function*(e,t,n){const r=yield`PD,${e},${t},${n}\r`;return yield*(0,i.Z)(r)})),(0,r.fA)("PG","Pulse go",(function*(e){const t=yield`PG,${e}\r`;return yield*(0,i.Z)(t)})),(0,r.fA)("PI","Pin input",(function*(e,t){const n=yield`PI,${e},${t}\r`,i=yield*(0,r.Tb)(o.Hr,n);return(0,r.F7)(i,(e=>(0,r.Hq)(e.substr(3))))})),(0,r.fA)("PO","Pin output",(function*(e,t,n){const r=yield`PO,${e},${t},${n}\r`;return yield*(0,i.Z)(r)}));var l=n(8315);(0,r.fA)("QC","Query current",(function*(){const e=yield"QC\r",t=yield*(0,r.Tb)(o.Pz,e);return(0,r.F7)(t,(e=>{const t=e.substring(0,e.length-6).split(",").map((e=>((0,r.Hq)(e)/1023*3.3).toFixed(2)));return{ra0:{voltage:t[0],maxCurrent:(t[0]/1.76).toFixed(2)},vPlus:{voltage:(9.2*t[1]+.3).toFixed(2)}}}))}),{version:"2.2.3"}),(0,r.fA)("QE","Query motor enable",(function*(){const e=yield"QE\r",t=yield*(0,r.Tb)(o.Pz,e);return(0,r.F7)(t,(e=>e.substring(0,e.length-6).split(",").map(r.Hq)))}),{version:"2.8.0"}),(0,r.fA)("QG","Query general",(function*(){const e=yield"QG\r",t=yield*(0,r.Tb)(o.Hr,e);return(0,r.F7)(t,(e=>{const t=(0,r.Hq)(e);return{fifo:(1&t)>0,mtr2:(2&t)>0,mtr1:(4&t)>0,cmd:(8&t)>0,pen:(16&t)>0,prg:(32&t)>0,rb2:(64&t)>0,rb5:(128&t)>0}}))}),{version:"2.6.2"}),(0,r.fA)("QL","Query layer",(function*(){const e=yield"QL\r",t=yield*(0,r.Tb)(o.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.2"}),(0,r.fA)("QM","Query motors",(function*(){const e=yield"QM\r",t=yield*(0,r.Tb)(o.d4,e);return(0,r.F7)(t,(e=>{const t=e.trim().substr(3).split(",").map(r.Hq);return{command:t[0],motor1:t[1],motor2:t[2],fifo:t[3]}}))}),{version:"2.4.4"}),(0,r.fA)("QN","Query node count",(function*(){const e=yield"QN\r",t=yield*(0,r.Tb)(o.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.2"}),(0,r.fA)("QP","Query pen",(function*(){const e=yield"QP\r",t=yield*(0,r.Tb)(o.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"1.9.0"}),(0,r.fA)("QR","Query RC Servo power state",(function*(){const e=yield"QR\r",t=yield*(0,r.Tb)(o.Pz,e);return(0,r.F7)(t,(e=>(0,r.Hq)(e)))}),{version:"2.6.0"}),(0,r.fA)("QS","Query step position",(function*(){const e=yield"QS\r",t=yield*(0,r.Tb)(o.Pz,e);return(0,r.F7)(t,(e=>{const t=e.substring(0,e.length-6).split(",").map(r.Hq);return{a1:t[0],a2:t[1]}}))}),{version:"2.4.3"}),(0,r.fA)("QT","Query EBB nickname tag",(function*(){const e=yield"QT\r",t=yield*(0,r.Tb)(o.Pz,e);return(0,r.F7)(t,(e=>e.substring(0,e.length-6)))}),{version:"2.5.4"});var c=n(5707);(0,r.fA)("RB","Reboot",(function*(){return"RB\r"}),{version:"2.5.4"}),(0,r.fA)("S2","General RC Servo output",(function*(e,t,n,o){const a=yield(0,r.iW)(`S2,${e},${t}`,n,o);return yield*(0,i.Z)(a)}),{execution:o.x1,version:"2.2.0"});var u=(0,r.fA)("SC","Stepper and Servo mode configure",(function*(e,t){const n=yield`SC,${e},${t}\r`;return yield*(0,i.Z)(n)}));(0,r.fA)("SE","Set engraver",(function*(e,t,n){const o=yield(0,r.iW)(`SE,${e}`,t,n);return yield*(0,i.Z)(o)}),{execution:o.x1,version:"2.1.0"}),(0,r.fA)("SL","Set layer",(function*(e){const t=yield`SL,${e}\r`;return yield*(0,i.Z)(t)}),{version:"1.9.2"});var d=n(1632);(0,r.fA)("SN","Set node count",(function*(e){const t=yield`SN,${e}\r`;return yield*(0,i.Z)(t)}),{version:"1.9.5"});var p=n(1519),m=(0,r.fA)("SR","Set RC Servo power timeout",(function*(e,t){const n=yield(0,r.iW)(`SR,${e}`,t);return yield*(0,i.Z)(n)}),{version:"2.6.0"});(0,r.fA)("ST","Set EBB nickname tag",(function*(e){const t=yield`ST,${e}\r`;return yield*(0,i.Z)(t)}),{version:"2.5.5"}),(0,r.fA)("T","Timed analog/digital read",(function*(e,t){const n=yield`T,${e},${t}\r`;return yield*(0,i.Z)(n)}));var h=(0,r.fA)("TP","Toggle pen",(function*(e){const t=yield(0,r.iW)("TP",e);return yield*(0,i.Z)(t)}),{version:"1.9.0"});n(2206),(0,r.fA)("XM","Stepper move, mixed-axis geometries",(function*(e,t,n){const r=yield`XM,${e},${t},${n}\r`;return yield*(0,i.Z)(r)}),{execution:o.x1,version:"2.3.0"})},5930:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return xr}});var r=n(7294),o=(n.p,n(5697)),i=n.n(o),a=n(1275);const s=e=>96/25.4*e,l=e=>e/96*25.4,c=(0,r.createContext)();c.displayName="Plotter Context";var u=c;const d=e=>t=>{t.preventDefault(),null==e||e(t)};var p=n(4184),m=n.n(p),h=n(3379),f=n.n(h),g=n(7795),v=n.n(g),y=n(695),b=n.n(y),x=n(9216),w=n.n(x),E=n(306),M={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};M.domAPI=v(),M.insertStyleElement=w(),f()(E.Z,M);var C=E.Z&&E.Z.locals?E.Z.locals:void 0;function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const A=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),o=s(n.width),i=s(n.height),a=s(n.padding),[l,c]=(0,r.useState)(!1);return r.createElement("g",S({onDragOver:d(),onDragEnter:d((()=>c(!0))),onDragLeave:d((()=>c(!1))),onDrop:d((e=>{if(c(!1),!e.dataTransfer.files.length)return;const n=Array.from(e.dataTransfer.files).find((e=>"image/svg+xml"===e.type));n?t.loadFromFile(n):alert("Only SVG files are supported.")}))},e),r.createElement("rect",{className:C.shadow,width:o,height:i,filter:"url(#svgShadow)"}),r.createElement("rect",{className:m()(C.paper,{[C.dropping]:l}),width:o,height:i}),r.createElement("rect",{className:C.printable,width:o-2*a,height:i-2*a,x:a,y:a}))}));A.propTypes={};var P=A,k=n(518),T={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};T.domAPI=v(),T.insertStyleElement=w(),f()(k.Z,T);var Z=k.Z&&k.Z.locals?k.Z.locals:void 0;const $=({margin:e})=>{const t=s(e);return r.createElement("filter",{id:"svgShadow"},r.createElement("feOffset",{id:"svgOffset0",result:"svgOffset0",in:"SourceAlpha",dy:"0",dx:"0"}),r.createElement("feGaussianBlur",{id:"svgBlur0",result:"svgBlur0",in:"svgOffset0",stdDeviation:`${t/4} ${t/4}`}),r.createElement("feBlend",{id:"svgBlend0",result:"svgBlend0",in:"SourceGraphic",in2:"svgBlur0"}))};$.propTypes={margin:i().number};var N=$,I=n(5901);const D=n.n(I)().get("plotter");function*F(e){for(const t of e.children){const e=t.nodeName;switch(e){case"svg":case"g":case"a":yield*F(t);break;case"rect":case"circle":case"ellipse":case"line":case"polyline":case"polygon":case"path":yield{action:"count",el:t,type:e};break;default:yield{action:"discard",el:t,type:e}}}}function R(e){const t={},n=[];for(const r of F(e))switch(r.action){case"count":t[r.type]=(t[r.type]||0)+1;break;case"discard":default:t[r.action]=(t[r.action]||0)+1,D.debug(`Unsupported element type: ${r.type}`),n.push(r.el)}for(const e of n)e.remove();return{counts:t}}function O(e,t){var n,r;return null!==(n=null===(r=e[t])||void 0===r?void 0:r.baseVal.value)&&void 0!==n?n:0}function L(e,{groups:t,elementId:n}){return e.groupId=t.join("-"),e.elementId=n,e}function z(e){const t=[];switch(e.nodeName){case"rect":{let n=O(e,"width"),r=O(e,"height");const o=O(e,"x"),i=O(e,"y");let a=O(e,"rx"),s=O(e,"ry");a=Math.min(a,n/2),s=Math.min(s,r/2),0===a||0===s?t.push(["M",[o,i]],["v",r],["h",n],["v",-r],["h",-n]):(n-=2*a,r-=2*s,t.push(["M",[o,i+s]],["v",r],["a",[a,s,0,0,0,[a,s]]],["h",n],["a",[a,s,0,0,0,[a,-s]]],["v",-r],["a",[a,s,0,0,0,[-a,-s]]],["h",-n],["a",[a,s,0,0,0,[-a,s]]]))}break;case"circle":case"ellipse":{const n=O(e,"cx"),r=O(e,"cy"),o=O(e,"r"),i="circle"===e.nodeName?o:O(e,"rx"),a="circle"===e.nodeName?o:O(e,"ry");if(0===i||0===a)return null;t.push(["M",[n,r-a]],["a",[i,a,0,0,0,[0,2*a]]],["a",[i,a,0,0,0,[0,2*-a]]])}break;default:throw new Error(`Can't generate path definition from ${e.nodeName}`)}return t.getCTM=()=>e.getCTM(),t.parsed=!0,t}function _([e,t],{a:n,b:r,c:o,d:i,e:a,f:s}){return[n*e+o*t+a,r*e+i*t+s]}function q(e,t,n){return[_(e,n),_(t,n)]}const H=(e,t,n,r)=>Math.atan2(e*r-t*n,e*n+t*r),Q=([e,t],[n,r])=>[(e+n)/2,(t+r)/2];function j([e,t],[n,r],[o,i]){return[[e+2*(n-e)/3,t+2*(r-t)/3],[o+2*(n-o)/3,i+2*(r-i)/3]]}function*U(e,t){const n=e.getCTM();switch(e.nodeName){case"line":{const r=[O(e,"x1"),O(e,"y1")],o=[O(e,"x2"),O(e,"y2")];return void(yield L(q(r,o,n),t))}case"polyline":case"polygon":{const{points:r}=e,o=r.length;for(let e=0;e<o-1;e+=1){const o=r[e],i=r[e+1];yield L(q([o.x,o.y],[i.x,i.y],n),t)}if("polygon"===e.nodeName){const e=r[o-1],i=r[0];yield L(q([e.x,e.y],[i.x,i.y],n),t)}}}}const B=([e,t],[n,r])=>Math.sqrt((e-n)**2+(t-r)**2),V=([e,t],[n,r])=>(e-n)**2+(t-r)**2,G=([e,t],[n,r],o=1e-4)=>Math.abs(e-n)<o&&Math.abs(t-r)<o;function*W(e,t,n,r){if(!e||"A"!==e[0])throw new Error(`invalid arc: ${e}`);const{cos:o,sin:i,PI:a}=Math,[s,l]=t;let[c,u,d,p,m,h,[f,g]]=e;if(0===u||0===d){const e=[f,g];return yield L(q(t,e,n),r),e}u=Math.abs(u),d=Math.abs(d);const v=p*Math.PI/180,y=o(v),b=i(v),x=new DOMMatrix([y,-b,b,y,0,0]),[w,E]=_([(s-f)/2,(l-g)/2],x);let M=u*u,C=d*d;const S=w*w,A=E*E,P=S/M+A/C;if(P>1){const e=Math.sqrt(P);u*=e,d*=e,M=u*u,C=d*d}let k=(M*C-M*A-C*S)/(M*A+C*S);k<0&&(k=0);const T=m===h?-1:1,Z=Math.sqrt(k),$=T*Z*u*E/d,N=-T*Z*d*w/u,I=new DOMMatrix([y,b,-b,y,0,0]),[D,F]=_([$,N],I),R=D+(s+f)/2,O=F+(l+g)/2,z=(w-$)/u,Q=(E-N)/d,j=(-w-$)/u,U=(-E-N)/d,B=H(1,0,z,Q),V=2*a,G=H(z,Q,j,U)%V;let W=G;0===h&&G>0&&(W-=V),1===h&&G<0&&(W+=V);const{maxError:X}=r,Y=new DOMMatrix([n.a,n.b,n.c,n.d,0,0]);return yield*function*e(t,a,s,l){const c=(t+a)/2,[p,m]=_([u*o(c),d*i(c)],I),h=[R+p,O+m],f=(([e,t],[n,r],[o,i])=>Math.abs(e*(i-r)-t*(o-n)+o*r-n*i)/Math.sqrt((o-n)**2+(i-r)**2))(h,s,l),[g,v]=_([f,0],Y);g*g+v*v<=X*X?yield L(q(s,l,n),r):(yield*e(t,c,s,h),yield*e(c,a,h,l))}(B,B+W,[s,l],[f,g]),[f,g]}function*X(e,t,n,r){if(!e||"C"!==e[0])throw new Error(`invalid bezier: ${e}`);const[o,i,a,s]=e,{maxError:l}=r,c=n.inverse(),u=new DOMMatrix([c.a,c.b,c.c,c.d,0,0]),[d,p]=_([l,0],u),m=d*d+p*p;return yield*function*e(t,o,i,a){if(function([e,t],[n,r],[o,i],[a,s],l){let c=(3*n-2*e-a)**2,u=(3*r-2*t-s)**2;const d=(3*o-2*a-e)**2,p=(3*i-2*s-t)**2;return c<d&&(c=d),u<p&&(u=p),c+u<=16*l}(t,o,i,a,m))yield L(q(t,a,n),r);else{const n=Q(t,o),r=Q(o,i),s=Q(n,r),l=Q(i,a),c=Q(r,l),u=Q(s,c),d=u;yield*e(t,n,s,u),yield*e(d,c,l,a)}}(t,i,a,s),s}const Y=(e,t)=>({type:e,execute:t}),K=(e,t,n,r,o)=>{const i=e.toUpperCase(),a=e===i;if(a||!n.toAbsolute)return r(t,n,a),[e,...t];const s=o(t,n);return r(s,n,!0),[i,...s]},J=(e,t)=>{const n=[...e],[r,o]=n[n.length-1];return n[n.length-1]=[r+t.x,o+t.y],n},ee=([e],t)=>[e+t.x],te=([e],t)=>[e+t.y],ne=(e,t)=>e.map((([e,n])=>[e+t.x,n+t.y])),re=(e,t,n)=>{n?t.x=e[0]:t.x+=e[0]},oe=(e,t,n)=>{n?t.y=e[0]:t.y+=e[0]},ie=(e,t,n)=>{const r=e[e.length-1];n?(t.x=r[0],t.y=r[1]):(t.x+=r[0],t.y+=r[1])};var ae=Y("L",(function*(e,t){const[n,...r]=e;for(const e of r)yield K(n,[e],t,ie,J)})),se=Y("M",(function*(e,t){const[n,r,...o]=e;yield K(n,[r],t,((...e)=>{ie(...e),((e,t)=>{var n,r;t.startX=null!==(n=t.x)&&void 0!==n?n:0,t.startY=null!==(r=t.y)&&void 0!==r?r:0})(...e)}),J),o.length&&(yield*ae.execute([{M:"L",m:"l"}[n],...o],t))})),le=Y("H",(function*(e,t){const[n,...r]=e;for(const e of r)yield K(n,[e],t,re,ee)})),ce=Y("V",(function*(e,t){const[n,...r]=e;for(const e of r)yield K(n,[e],t,oe,te)})),ue=Y("C",(function*(e,t){const[n,...r]=e;for(const e of r)yield K(n,e,t,ie,ne)})),de=Y("S",(function*(e,t){const[n,...r]=e;for(const e of r)yield K(n,e,t,ie,ne)})),pe=Y("Q",(function*(e,t){const[n,...r]=e;for(const e of r)yield K(n,e,t,ie,ne)})),me=Y("T",(function*(e,t){const[n,...r]=e;for(const e of r)yield K(n,[e],t,ie,J)})),he=Y("A",(function*(e,t){const[n,...r]=e;for(const e of r)yield K(n,e,t,ie,J)})),fe=Y("Z",(function*(e,t){((e,t)=>{var n,r;t.x=null!==(n=t.startX)&&void 0!==n?n:0,t.y=null!==(r=t.startY)&&void 0!==r?r:0})(0,t),yield[t.isAbsolute?"Z":e[0]]}));const ge={},ve=(...e)=>{const t=e.reduce(((e,t)=>e+t.source),"");return new RegExp(t)},ye=(...e)=>{const t=e.map((e=>e.source)).join("|");return new RegExp(`(?:${t})`)},be=e=>new RegExp(`(?:${e.source})?`),xe=(e,...t)=>function(n,r=0){const o=t.reduce((function(e,t){const r=t(n,e.idx);return e.idx=r.idx,e.values.push(r.value),e}),{idx:r,values:[]});return{idx:o.idx,value:e(...o.values)}},we=e=>{const t=new RegExp((null==e?void 0:e.source)||"","y");return function(e,n=0){t.lastIndex=n;const r=t.exec(e);if(!r)throw ge;const o=r[0];return{idx:t.lastIndex,value:o}}},Ee=(e,t=null)=>function(n,r){try{return e(n,r)}catch(e){if(e===ge)return{idx:r,value:t};throw e}},Me=/\s/,Ce=new RegExp(`(?:${Me.source})*`),Se=we(Ce),Ae=new RegExp(`(?:${Me.source})+`),Pe=/\d+/,ke=/[+-]/,Te=ve(/[Ee]/,be(ke),Pe),Ze=/\./,$e=ye(ve(be(Pe),Ze,Pe),ve(Pe,Ze)),Ne=ye(ve($e,be(Te)),ve(Pe,Te)),Ie=Pe,De=/,/,Fe=ye(ve(Ae,be(De),Ce),ve(De,Ce)),Re=we(Fe),Oe=we(be(Fe)),Le=xe((e=>parseInt(e,10)),we(/[01]/)),ze=xe((e=>parseFloat(e)),we(ye(Ne,Ie))),_e=xe((e=>parseFloat(e)),we(ve(be(ke),ye(Ne,Ie)))),qe=_e,He=xe((function(e,t,n){return[e,n]}),qe,Oe,qe),Qe=(e,t=Oe)=>{return xe((function(e,t){return[e,...t]}),e,(n=xe((function(e,t){return t}),t,e),function(e,t=0){const r=[];let o=t;for(;;)try{const t=n(e,o);r.push(t.value),o=t.idx}catch(e){if(e===ge)break;throw e}return{idx:o,value:r}}));var n},je=Qe(He),Ue=(e,t)=>xe((function(e,t,n){return[e,...n]}),e,Se,t),Be=Ue(we(/[Mm]/),je),Ve=Ue(we(/[Ll]/),je),Ge=xe((e=>[e]),we(/[Zz]/)),We=Qe(qe),Xe=Ue(we(/[Hh]/),We),Ye=Ue(we(/[Vv]/),We),Ke=Qe(xe(((e,t,n,r,o)=>[e,n,o]),He,Oe,He,Oe,He)),Je=Ue(we(/[Cc]/),Ke),et=Qe(xe(((e,t,n)=>[e,n]),He,Oe,He)),tt=Ue(we(/[Ss]/),et),nt=Ue(we(/[Qq]/),et),rt=Ue(we(/[Tt]/),je),ot=Qe(xe(((e,t,n,r,o,i,a,s,l,c,u)=>[e,n,o,a,l,u]),ze,Oe,ze,Oe,_e,Re,Le,Oe,Le,Oe,He)),it=Ue(we(/[Aa]/),ot);var at;const st=Qe((at={Z:Ge,L:Ve,H:Xe,V:Ye,C:Je,S:tt,Q:nt,T:rt,A:it},function(e,t=0){const n=e[t],r=at[null==n?void 0:n.toUpperCase()];if(!r)throw ge;return r(e,t)}),Se),lt=Qe(xe((function(e,t,n){return[e,...n||[]]}),Be,Se,Ee(st)),Se),ct=xe((function(e,t){return(null==t?void 0:t.flatMap((e=>e)))||null}),Se,Ee(lt),Se),ut={M:se,L:ae,H:le,V:ce,C:ue,S:de,Q:pe,T:me,A:he,Z:fe};function dt(e="M 0 0"){return((e="")=>{if(!e)return[];const t=ct(e);if(!t.value)throw new Error("Invalid svg path.");return t.value})(e)}function*pt(e,t){let n=null;if(e.parsed)n=e;else{const t=e.getAttribute("d");if(!t)return;n=dt(t)}const r=e.getCTM();let o,i,a,s=[0,0];for(const e of function*(e,t=!0){const n={x:0,y:0,startX:0,startY:0,toAbsolute:t};for(const t of e){const e=ut[t[0].toUpperCase()];yield*e.execute(t,n)}}(n))switch(e[0]){case"M":s=e[1],i=s;break;case"L":o=e[1],yield L(q(s,o,r),t),s=o;break;case"H":o=[e[1],s[1]],yield L(q(s,o,r),t),s=o;break;case"V":o=[s[0],e[1]],yield L(q(s,o,r),t),s=o;break;case"Q":{const n=["C",...j(s,e[1],e[2]),e[2]];s=yield*X(n,s,r,t),a=e}break;case"T":{if(!a||"Q"!==a[0]&&"T"!==a[0])throw new Error("invalid T command can only follow by Q or T.");const n=2*s[0]-a[1][0],o=2*s[1]-a[1][1],i=["C",...j(s,[n,o],e[1]),e[1]];s=yield*X(i,s,r,t),a=["Q",[n,o],e[1]]}break;case"C":{const n=e;s=yield*X(n,s,r,t),a=n}break;case"S":{if(!a)throw new Error(`invalid S command: ${e}`);let n,o;switch(a[0]){case"C":[n,o]=a[2];break;case"S":[n,o]=a[1];break;default:throw new Error("invalid S command can only follow by C or S.")}const i=["C",[2*s[0]-n,2*s[1]-o],e[1],e[2]];s=yield*X(i,s,r,t),a=e}break;case"A":s=yield*W(e,s,r,t);break;case"Z":i&&(yield L(q(s,i,r),t),s=i)}}function*mt(e,t){for(const n of e.children)switch(n.nodeName){case"svg":case"g":case"a":t.groupId+=1,t.groups.push(t.groupId),yield*mt(n,t),t.groups.pop();break;case"rect":case"circle":case"ellipse":{const e=z(n);e&&(t.elementId+=1,yield*pt(e,t))}break;case"line":case"polyline":case"polygon":t.elementId+=1,yield*U(n,t);break;case"path":t.elementId+=1,yield*pt(n,t);break;default:D.info(`unsupported type: ${n.nodeName}`)}}const ht={maxError:.1};var ft=n(2849),gt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};gt.domAPI=v(),gt.insertStyleElement=w(),f()(ft.Z,gt);var vt=ft.Z&&ft.Z.locals?ft.Z.locals:void 0,yt=n(8949);const bt="rtree-type-node-internal",xt="rtree-type-node-leaf";function wt(e,t){if(!e)return t;const{p0:[n,r],p1:[o,i]}=e,{p0:[a,s],p1:[l,c]}=t;return{p0:[Math.min(n,a),Math.min(r,s)],p1:[Math.max(o,l),Math.max(i,c)]}}function Et(e,t){const n=wt(e.mbr,t),{p0:[r,o],p1:[i,a]}=e.mbr,{p0:[s,l],p1:[c,u]}=n,d=(i-r)*(a-o),p=(c-s)*(u-l);return{node:e,extendedMbr:n,extendedArea:p,originalArea:d,cost:p-d}}function Mt(e){return e.length?e.reduce(wt):null}function Ct(e,t,n,r){for(let o=n;o<r;o+=1){const n=t[o];e.entries.push(n),n.parent=e;const r=Et(e,n.mbr);e.mbr=r.extendedMbr}}function St([e,t],{p0:[n,r],p1:[o,i]}){let a=e;a<n?a=n:a>o&&(a=o);let s=t;return s<r?s=r:s>i&&(s=i),(e-a)**2+(t-s)**2}function At([e,t],{p0:[n,r],p1:[o,i]}){const a=(n+o)/2,s=(r+i)/2,l=(e-(e<=a?n:o))**2+(t-(t>=s?r:i))**2,c=(t-(t<=s?r:i))**2+(e-(e>=a?n:o))**2;return Math.min(l,c)}const Pt=(e,t)=>{let n=null,r=0;const o=e=>function(...t){return{nid:r++,type:xt,parent:e,entries:[...t],mbr:Mt(t.map((e=>e.mbr)))}},i=e=>function(...t){return{nid:r++,type:bt,parent:e,entries:[...t],mbr:Mt(t.map((e=>e.mbr)))}};function a(r,o){if(o.entries.length<=t)return;const a=o.entries.sort((({mbr:{p0:[e],p1:[t]}},{mbr:{p0:[n],p1:[r]}})=>(e+t)/2-(n+r)/2)),s=r(a[0]);a[0].parent=s;const l=r(a[a.length-1]);a[a.length-1].parent=l;for(let t=1;t<a.length-1;t+=1){const n=a.length-1-t;if(e-s.entries.length===n){Ct(s,a,t,a.length-1);break}if(e-l.entries.length===n){Ct(l,a,t,a.length-1);break}const r=a[t],o=Et(s,r.mbr),i=Et(l,r.mbr);let c=i;o.cost===i.cost?o.originalArea===i.originalArea?s.entries.length<l.entries.length&&(c=o):o.originalArea<i.originalArea&&(c=o):o.cost<i.cost&&(c=o),c.node.entries.push(r),r.parent=c.node,c.node.mbr=c.extendedMbr}return o===n?(n=i(null)(s,l),s.parent=n,void(l.parent=n)):[s,l]}function s(e,t){if(e.type===bt){const n=e.entries.map((e=>Et(e,t.mbr))).sort(((e,t)=>e.cost!==t.cost?e.cost-t.cost:e.originalArea-t.originalArea))[0],r=s(n.node,t);if(!r)return void(n.node.mbr=n.extendedMbr);const o=e.entries.indexOf(n.node);return e.entries.splice(o,1,r[0],r[1]),r[0].parent=e,r[1].parent=e,a(i(e.parent),e)}return e.entries.push(t),a(o(e.parent),e)}function l(e){e.type===bt?e.entries.forEach((e=>{l(e)})):e.entries.forEach((e=>{s(n,e)}))}function c(t){const r=[];let i=t;for(;i!==n;){const t=i.parent;if(i.entries.length<e){const e=t.entries.indexOf(i);t.entries.splice(e,1),r.push(i)}else i.mbr=Mt(i.entries.map((e=>e.mbr)));i=t}0===n.entries.length&&(n=o(null)()),r.forEach((e=>l(e)))}function u(e,t){if(e.type===bt)e.entries.filter((e=>function(e,t){const{p0:[n,r],p1:[o,i]}=e,{p0:[a,s],p1:[l,c]}=t;return n<=a&&a<=o&&n<=l&&l<=o&&r<=s&&s<=i&&r<=c&&c<=i}(e.mbr,t.mbr))).forEach((e=>{u(e,t)}));else{const n=e.entries.findIndex((e=>e.id===t.id));if(-1===n)return;e.entries.splice(n,1),c(e)}e===n&&1===e.entries.length&&e.entries[0].type===bt&&(n=e.entries[0],n.parent=null)}function d(e,t,n){if(e.type===xt)e.entries.forEach((e=>{const[r,o]=t,[i,a]=e.mbr.p0,s=(r-i)**2+(o-a)**2;s<n.distSq&&(n.distSq=s,n.id=e.id)}));else{let r=e.entries.map((e=>({minDist:St(t,e.mbr),minMaxDist:At(t,e.mbr),subNode:e}))).sort(((e,t)=>e.minMaxDist-t.minMaxDist));r=r.filter((e=>e===r[0]||e.minDist<=r[0].minMaxDist)).sort(((e,t)=>e.minDist-t.minDist));for(let e=0;e<r.length;e+=1){const o=r[e];if(o.minDist>n.distSq)break;d(o.subNode,t,n)}}}return{get root(){return n},insert(e){n?s(n,e):n=o(null)(e)},remove(e){n&&u(n,e)},nnSearch(e){if(!n)return null;const t={distSq:Number.MAX_VALUE};return d(n,e,t),t.id}}},kt="axidraw-web-plotter-status-standby",Tt="axidraw-web-plotter-status-paused",Zt="axidraw-web-plotter-status-plotting",$t="axidraw-web-plotter-action-pause",Nt="axidraw-web-plotter-action-stop",It="axidraw-web-plotter-speed-mode-constant",Dt="axidraw-web-plotter-speed-mode-accelerating",Ft=([e,t],[n,r],[o,i])=>Math.abs(e*(i-r)-t*(o-n)+o*r-n*i)/Math.sqrt((o-n)**2+(i-r)**2);function*Rt(e,t,n){if(!e||0===e.length)return{skip:0};const{connectedError:r}=n;if(1===e.length)return yield{line:t(e[0]),groupId:n.lindGroupId},{skip:1};const o=s(r**2),i=[];let a=0,l=null;for(let t=e.length;a<t-1;a+=1){const t=e[a],n=e[a+1];i.push(t),l=[t[1],n[0]];const r=V(l[0],l[1]);if(r>o)break;r>0&&i.push(l),l=null}const c=((e,t)=>{if(null==e||!e.length)return{lines:[]};if(1===e.length)return{lines:e};const n=s(t.flatLineError);if(!n)return{lines:e};const r=e.map((e=>e[0])),o=e[e.length-1];return r.push(o[1]),[...function*e(t,o){if(t>=o)return;const i=r[t],a=r[o];if(t+1===o){const e=[i,a];return void(yield{reduced:0,line:e})}let s=-1,l=Number.MIN_VALUE;if(G(i,a))if(t+1===o)yield{reduced:1,line:null};else{const n=Math.floor((t+o)/2);yield*e(t,n),yield*e(n,o)}else{for(let e=t+1;e<=o-1;e+=1){const t=Ft(r[e],i,a);t>l&&(s=e,l=t)}if(l>n)yield*e(t,s),yield*e(s,o);else{const e=o-t-1,n=[i,a];yield{reduced:e,line:n}}}}(0,r.length-1)].reduce(((e,t)=>{var n;return t.line&&e.lines.push(t.line),e.reduced+=null!==(n=t.reduced)&&void 0!==n?n:0,e}),{lines:[],reduced:0})})(i,n);for(const e of c.lines)yield{line:t(e),groupId:n.lindGroupId};return l?(n.lindGroupId+=1,{skip:a+1,reduced:c.reduced}):{skip:a,reduced:c.reduced}}const Ot={connectedError:.2,planAhead:10,flatLineError:.1,allowReorder:!1};const Lt=e=>{if(!e||!e.length)return"";let t=[0,0];return e.reduce(((e,[[n,r],[o,i]])=>(G([n,r],t)?e.push(`${o} ${i}`):e.push(`M ${n} ${r} ${o} ${i}`),t=[o,i],e)),["M 0 0"]).join(" ")},zt="axidraw-web-planning-phase-setup",_t="axidraw-web-planning-phase-planning",qt="axidraw-web-planning-phase-plotting";function Ht(){return(Ht=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Qt=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),o=(0,r.useRef)(null),i=s(n.padding),a=s(n.width),l=s(n.height),{contentFitPage:c,contentPreserveAspectRatio:d}=n;return(0,r.useLayoutEffect)((()=>{const e=o.current,n=null==e?void 0:e.children[0];if(!n)return;if(!n.hasAttribute("data-cleaned")){const e=R(n);t.updateFileInfo(e.counts),n.setAttribute("data-cleaned",!0)}if(!n.hasAttribute("data-original-viewBox")){const e=n.getAttribute("viewBox");n.setAttribute("data-original-viewBox",e)}n.setAttribute("width",a-2*i),n.setAttribute("height",l-2*i),n.setAttribute("x",i),n.setAttribute("y",i),n.setAttribute("preserveAspectRatio",d);const r=n.getAttribute("data-original-viewBox"),s=n.getBBox();n.setAttribute("viewBox",c?`${s.x} ${s.y} ${s.width} ${s.height}`:r)}),[n.size,n.padding,n.orientation,n.alignment.vertical,n.alignment.horizontal,n.contentFitPage,t.svgContent]),(0,r.useLayoutEffect)((()=>{if(t.phase===_t){const e=o.current,n=null==e?void 0:e.children[0];if(!n)return;t.updateLines(function(e,t){const n={...ht};return n.maxError=s(n.maxError),n.groupId=0,n.elementId=0,n.pathId=0,n.groups=[],[...mt(e,n)]}(n))}}),[t.phase]),r.createElement("g",Ht({className:m()(vt.root,t.phase===zt?"block":"hidden"),dangerouslySetInnerHTML:{__html:t.svgContent},ref:o},e))}));Qt.propTypes={};var jt=Qt,Ut=n(3273),Bt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Bt.domAPI=v(),Bt.insertStyleElement=w(),f()(Ut.Z,Bt);var Vt=Ut.Z&&Ut.Z.locals?Ut.Z.locals:void 0;function Gt(){return(Gt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Wt=(0,a.Pi)((({strokeWidth:e,...t})=>{const{planning:n,page:o}=(0,r.useContext)(u),i=l(1);return r.createElement("g",Gt({className:m()(Vt.root,n.phase===_t||n.phase===qt?"block":"hidden"),style:{"--planning-stroke-width":e*i+"%"},transform:o.pageToScreenMatrix.toString()},t),r.createElement("path",{className:Vt.motionPenUp,d:n.connectionsAsPathDef}),r.createElement("path",{className:Vt.motionPenDown,d:n.linesAsPathDef}))}));Wt.propTypes={strokeWidth:i().number};var Xt=Wt,Yt=n(9930),Kt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Kt.domAPI=v(),Kt.insertStyleElement=w(),f()(Yt.Z,Kt);var Jt=Yt.Z&&Yt.Z.locals?Yt.Z.locals:void 0;const en="axidraw-web-page-orientation-landscape",tn="axidraw-web-page-orientation-portrait",nn="axidraw-web-page-alignment-vertical-center",rn="axidraw-web-page-alignment-vertical-top",on="axidraw-web-page-alignment-vertical-bottom",an="axidraw-web-page-alignment-horizontal-center",sn="axidraw-web-page-alignment-horizontal-start",ln="axidraw-web-page-alignment-horizontal-end",cn=[{type:"axidraw-web-page-size-a4",alias:"A4 (297mm x 210mm)",width:297,height:210,defaultPadding:15},{type:"axidraw-web-page-size-a5",alias:"A5 (210mm x 148mm)",width:210,height:148,defaultPadding:10},{type:"axidraw-web-page-size-a6",alias:"A6 (148mm x 105mm)",width:148,height:105,defaultPadding:5}],un=cn[0];function dn(){return(dn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const pn=(0,a.Pi)((({...e})=>{const{page:t}=(0,r.useContext)(u);return r.createElement("g",dn({className:Jt.root,transform:t.orientation===tn?`translate(${s(t.width)},0) rotate(90) `:null},e),r.createElement("polyline",{className:m()(Jt.axis,Jt.x),points:`0,0 ${s(10)},0 ${s(8)},${s(-2)}`}),r.createElement("polyline",{className:m()(Jt.axis,Jt.y),points:`0,0 0,${s(10)} ${s(-2)},${s(8)}`}),r.createElement("circle",{className:Jt.z,r:s(2),cx:"0",cy:"0"}))}));pn.propTypes={};var mn=pn;const hn=(0,a.Pi)((({margin:e=20})=>{const{page:t,planning:n}=(0,r.useContext)(u),o=s(e),i=`${-o} ${-o} ${s(t.width)+2*o} ${s(t.height)+2*o}`,a=(0,r.useRef)(null),[l,c]=(0,r.useState)(1);return(0,r.useLayoutEffect)((()=>{c(s(n.previewStrokeWidth)/(e=>{const{width:t,height:n}=e.baseVal;return Math.sqrt(t**2+n**2)/Math.sqrt(2)})(a.current.viewBox)*100)}),[i,n.previewStrokeWidth]),r.createElement("svg",{className:Z.root,viewBox:i,preserveAspectRatio:"xMidYMid meet",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",ref:a},r.createElement("defs",null,r.createElement(N,{margin:e})),r.createElement(P,null),r.createElement(jt,null),r.createElement(Xt,{strokeWidth:l}),r.createElement(mn,null))}));hn.propTypes={margin:i().number};var fn=hn,gn=n(4697),vn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};vn.domAPI=v(),vn.insertStyleElement=w(),f()(gn.Z,vn);var yn=gn.Z&&gn.Z.locals?gn.Z.locals:void 0,bn=n(7369),xn=n(5374);const wn=({a1:e,a2:t})=>({x:(e+t)/2,y:(e-t)/2}),En=e=>85899.34592*Math.abs(e)|0,Mn=(e,t=1)=>xn.FP/2**(t-1)/25.4*e|0,Cn=({x:e,y:t},n=1)=>(({x:e,y:t})=>({a1:e+t,a2:e-t}))({x:Mn(e,n),y:Mn(t,n)}),Sn=(e,t,n)=>.024*Math.abs(e-t)/n*1e3;var An=n(9062);function*Pn({t:e,stepLong:t,stepShort:n}){const r=Math.abs(n),o=1310*r,i=Math.sign(n),a=Math.floor((e-o)/(r+1)),s=t/e,l=Math.floor(s*a),c=Math.floor(1310*s);let u=t;for(let e=0,t=2*r+1;e<t;e+=1)e%2==0?a>0&&(u-=l,yield{time:a,longStep:l,shortStep:0,remaining:u}):(u-=c,yield{time:1310,longStep:c,shortStep:i,remaining:u})}const kn=([e,t],[n,r],o,i)=>{const a=(e*n+t*r)/(Math.sqrt(e*e+t*t)*Math.sqrt(n*n+r*r)),s=Math.sqrt((1-a)/2),l=Mn(i.cornering)*s/(1-s);return Math.sqrt(o*l)},Tn=(e,t,n,r,o,i,a={})=>{const s={cornering:.1,lookingForward:10,...a},l=e[t];if(1===l.pen)return 0;const c=[l];for(let n=1;n<s.lookingForward;n+=1){const r=e[t+n];if(1===r.pen)break;c.push(r)}const u=c.filter((e=>{const{line:t}=e;return V(t[0],t[1])>0}));if(u.length<=1)return 0;const d={exitRate:0};for(let e=u.length-1;e>0;e-=1){const t=u[e],n=u[e-1],[[i,a]]=n.line,[[l,c],[p,m]]=t.line,h=Cn({x:i-l,y:a-c}),f=Cn({x:p-l,y:m-c}),g=Math.sqrt(f.a1**2+f.a2**2),v=Math.sqrt(o*g*2+d.exitRate),y=kn([h.a1,h.a2],[f.a1,f.a2],o,s);d.exitRate=Math.min(y,v,r)}const p=Math.sqrt(o*i*2+n);return 0|Math.min(p,d.exitRate)},Zn=(e,t,n,r,o)=>{if(t!==r){const i=Math.sign(r-t),a=Math.abs(t-r)/o,s=(t+r)*a/2,l=e-s|0;l<0&&D.error(`don't have enough room to acc: ${l}`);const c={s:Math.min(e,s),t:a,v0:t,vt:r,dir:i};return l<=0?[c]:t<r?[c,...Zn(l,r,n,r,o)]:[...Zn(l,t,n,t,o),c]}const i=(n-t)/o,a=(t+n)*i/2,s={s:a,t:i,v0:t,vt:n,dir:1},l={s:a,t:i,v0:n,vt:t,dir:-1};if(a===e/2)return[s,l];if(a<e/2){const t=e-2*a;return[a>0?s:null,{s:t,t:t/n,v0:n,vt:n,dir:0},a>0?l:null].filter(Boolean)}const c=Math.sqrt(o*e+t*t),u=(c-t)/o;return[{s:e/2,t:u,v0:t,vt:c,dir:1},{s:e/2,t:u,v0:c,vt:t,dir:-1}]};function $n(e){if((null==e?void 0:e.length)<2)return e;const t=[];for(let n=0;n<e.length;n+=1){const r=e[n],o=e[n+1];o&&Math.abs(r.vt-o.v0)<.001&&r.dir===o.dir?(t.push({s:r.s+o.s,t:r.t+o.t,v0:r.v0,vt:o.vt,dir:r.dir}),n+=1):t.push(r)}return t}const Nn=(e,t,n)=>{const r=Math.sqrt(t**2+n**2),o=t/r,i=n/r;let a=t,s=n,l=0;const c=[];for(const t of e){const e=En(t.v0),n=t.v0<=t.vt?1:-1,r=(En(t.vt)-En(t.v0))/(25e3*t.t),u=0|Math.abs(e*o),d=0|Math.abs(e*i),p=t.s*o|0,m=t.s*i|0,h=n*Math.abs(r*o)|0,f=n*Math.abs(r*i)|0;0===p&&0===m||0!==p&&0===u&&0===h||0!==m&&0===d&&0===f||(D.debug(`low-level-move: ${p}, ${m} with v0 ${u}, ${d} acc ${h}, ${f}`),c.push({time:1e3*t.t,initRate1:u,step1:p,accel1:h,initRate2:d,step2:m,accel2:f}),a-=p,s-=m,l=t.vt)}return{LMParams:c,endRate:l,remaining:{a1:a,a2:s}}},In={a1:0,a2:0,rate:0,pen:1};const Dn={a1:0,a2:0,rate:0,pen:1};var Fn=n(2105),Rn=n(2221),On=n(5589),Ln=n(7446),zn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};zn.domAPI=v(),zn.insertStyleElement=w(),f()(Ln.Z,zn);var _n=Ln.Z&&Ln.Z.locals?Ln.Z.locals:void 0;function qn(){return(qn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Hn=({active:e,children:t,...n})=>r.createElement("div",qn({className:m()(_n.root,e?_n.active:"")},n),t);Hn.propTypes={active:i().bool,children:i().node};var Qn=Hn,jn=n(3848),Un={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Un.domAPI=v(),Un.insertStyleElement=w(),f()(jn.Z,Un);var Bn=jn.Z&&jn.Z.locals?jn.Z.locals:void 0;const Vn=(0,n(6010).f)("plotter");function Gn(){return(Gn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const Wn=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),o=(0,r.useRef)(null);return r.createElement(Qn,Gn({active:t.phase===zt},e),r.createElement("section",null,r.createElement("h3",null,"Setup"),r.createElement("p",null,"In this phase, you could"," ",r.createElement("input",{className:"hidden",type:"file",accept:"image/svg+xml",ref:o,onChange:async e=>{const{files:n}=e.target;n.length&&t.loadFromFile(n[0])}}),r.createElement(Rn.Z,{variant:t.svgContent?"secondary":"primary",onClick:()=>{var e;Vn("load svg"),null===(e=o.current)||void 0===e||e.click()}},"Load SVG")," ","and set up the page. Or simply ",r.createElement("b",null,"Drag & Drop")," your svg into the page area.")),r.createElement("section",{className:Bn.inputs},r.createElement("h4",{className:"col-span-2"},"Dimension"),r.createElement("label",{htmlFor:"page-size"},"Page Size: "),r.createElement("select",{id:"page-size",value:n.size.type,onChange:e=>{const t=cn.find((t=>t.type===e.target.value));t&&n.setSize(t)}},cn.map((e=>r.createElement("option",{key:e.type,value:e.type},e.alias)))),r.createElement("label",{htmlFor:"page-padding"},"Padding(mm): "),r.createElement("input",{id:"page-padding",type:"number",min:"0",value:n.padding,onChange:e=>n.setPadding(e.target.value)}),r.createElement("label",null,"Orientation:"),r.createElement("div",{className:"inline-flex items-center"},r.createElement("label",{className:m()(Fn.Z.radioLabel,"mr-2")},r.createElement("input",{type:"radio",name:"orientation",value:en,checked:n.orientation===en,onChange:()=>n.setOrientation(en)}),r.createElement("span",null,"Landscape")),r.createElement("label",{className:Fn.Z.radioLabel},r.createElement("input",{type:"radio",name:"orientation",value:tn,checked:n.orientation===tn,onChange:()=>n.setOrientation(tn)}),r.createElement("span",null,"Portrait"))),r.createElement("label",{className:m()(Fn.Z.checkboxLabel,"col-start-2"),htmlFor:"page-fit"},r.createElement("input",{type:"checkbox",id:"page-fit",checked:n.contentFitPage,onChange:e=>{n.setContentFitPage(e.target.checked)}}),r.createElement("span",null,"Fit content to page")),r.createElement("h4",{className:"col-span-2"},"Alignment"),r.createElement("label",{htmlFor:"page-align-h"},"Horizontal:"),r.createElement("select",{id:"page-align-h",value:n.alignment.horizontal,onChange:e=>n.setAlignmentHorizontal(e.target.value)},r.createElement("option",{value:sn},"Left"),r.createElement("option",{value:an},"Center"),r.createElement("option",{value:ln},"Right")),r.createElement("label",{className:"aw-label",htmlFor:"page-align-v"},"Vertical:"),r.createElement("select",{id:"page-align-v",value:n.alignment.vertical,onChange:e=>n.setAlignmentVertical(e.target.value)},r.createElement("option",{value:rn},"Top"),r.createElement("option",{value:nn},"Center"),r.createElement("option",{value:on},"Bottom"))),r.createElement("section",{className:"grid grid-cols-1 gap-4"},t.svgContent?r.createElement(On.Z,{type:"info"},"Plan the motion before sending it to the plotter."):r.createElement(On.Z,{type:"warn"},"Load SVG first."),r.createElement(Rn.Z,{variant:t.svgContent?"primary":"secondary",disabled:!t.svgContent,onClick:()=>{t.setPhase(_t),Vn("go to",_t)}},r.createElement("span",{className:"inline-block w-32"},"Next")),t.fileInfo&&r.createElement(r.Fragment,null,r.createElement("h4",null,"Svg Info:"),r.createElement("dl",{className:"grid grid-cols-2 gap-4"},Object.entries(t.fileInfo).map((e=>r.createElement(r.Fragment,null,r.createElement("dt",null,e[0]),r.createElement("dd",null,e[1]))))))))}));Wn.propTypes={};var Xn=Wn,Yn=n(3162),Kn=n(7536),Jn={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Jn.domAPI=v(),Jn.insertStyleElement=w(),f()(Kn.Z,Jn);var er=Kn.Z&&Kn.Z.locals?Kn.Z.locals:void 0;function tr(){return(tr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const nr=(0,a.Pi)((({...e})=>{const{planning:t,page:n}=(0,r.useContext)(u),[o,i]=(0,r.useState)(.2),[a,l]=(0,r.useState)(.1),[c,d]=(0,r.useState)(!0),p=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{t.phase===_t&&p.current.click()}),[t.phase]),r.createElement(Qn,tr({active:t.phase===_t},e),r.createElement("section",null,r.createElement("h3",null,"Planning"),r.createElement("p",{className:"mb-4"},"In this phase, the SVG would be transformed into coordinates on the page, then it will plan the motion for AxiDraw to plot the picture."),r.createElement(Rn.Z,{onClick:()=>{t.setPhase(zt),Vn("go to",zt)}},"Back to Setup")),r.createElement("section",null,r.createElement("form",{className:er.form,onSubmit:e=>{e.preventDefault(),Vn("plan"),t.planMotion({screenToPageMatrix:n.screenToPageMatrix,origin:n.orientation===en?[0,0]:[s(n.size.height),0],connectedError:o,flatLineError:a,allowReorder:c})}},r.createElement("label",{htmlFor:"connected-error"},"Connected: "),r.createElement("input",{id:"connected-error",type:"number",min:"0",step:"0.05",max:"10",value:o,onChange:e=>i(parseFloat(e.target.value))}),r.createElement("label",{htmlFor:"flatten-error"},"Flatten: "),r.createElement("input",{id:"flatten-error",type:"number",min:"0",step:"0.01",max:"2",value:a,onChange:e=>l(parseFloat(e.target.value))}),r.createElement("label",{className:m()(Fn.Z.checkboxLabel,"col-start-2"),htmlFor:"allow-reorder"},r.createElement("input",{type:"checkbox",id:"allow-reorder",checked:c,onChange:e=>{d(e.target.checked)}}),r.createElement("span",null,"Optimizing order")),r.createElement("div",{className:"col-start-2 grid grid-cols-2 gap-4"},r.createElement(Rn.Z,{submit:!0,ref:p},"Re-plan"),r.createElement(Rn.Z,{onClick:()=>{const e=new Blob([`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="${n.width}mm" height="${n.height}mm" viewBox="0 0 ${n.width} ${n.height}">\n  <g style="stroke: #000000; stroke-width: 0.1; fill: none;">\n      <path d="${t.linesAsPathDef}"></path>\n  </g>  \n</svg>\n`],{type:"image/svg+xml;charset=utf-8"});(0,Yn.saveAs)(e,`${t.filename}-aw.svg`)}},"Export SVG")))),r.createElement("section",{className:"grid grid-cols-1 gap-4"},r.createElement(On.Z,{type:"info"},"Adjust parameters above and redo the planning until you are satisfied."),r.createElement(Rn.Z,{variant:"primary",onClick:()=>{t.setPhase(qt),Vn("go to",qt)}},r.createElement("span",{className:"inline-block w-32"},"Next")),r.createElement("h4",null,"Planning Info:"),r.createElement("dl",{className:"grid grid-cols-2 gap-4"},Object.entries(t.linesInfo).map((e=>r.createElement(r.Fragment,null,r.createElement("dt",null,e[0]),r.createElement("dd",null,e[1])))),Object.entries(t.motionsInfo).map((e=>r.createElement(r.Fragment,null,r.createElement("dt",null,e[0]),r.createElement("dd",null,e[1])))))))}));nr.propTypes={};var rr=nr,or=n(6370);const ir=[{cmd:bn.r},{cmd:bn.em,title:"Disable Motor",params:[0,0]},{cmd:bn.tp},{cmd:bn.sp,title:"Pen Up",params:[1]},{cmd:bn.sp,title:"Pen Down",params:[0]}],ar=({device:e})=>{const{work:t}=(0,r.useContext)(u),[n,o]=(0,r.useState)(""),i=(0,r.useCallback)((async(t,n=[])=>{try{const r=await e.executeCommand(t,...n);o("object"==typeof r?JSON.stringify(r):r)}catch(e){o(e.toString())}}),[e]);return(0,r.useEffect)((()=>{const n=(0,yt.U5)((()=>({servoMin:t.servoMin.get(),servoMax:t.servoMax.get(),servoRate:t.servoRate.get()})),(async({servoMin:t,servoMax:n,servoRate:r})=>{e&&(await e.executeCommand(bn.sc,4,t),await e.executeCommand(bn.sc,5,n),await e.executeCommand(bn.sc,10,r))}));return()=>{n()}}),[]),r.createElement("form",{className:Fn.Z.root},r.createElement("h3",null,"Simple Debugger"),r.createElement(On.Z,{type:"info"},"Debug AxiDraw before plotting here."),r.createElement("div",{className:"grid grid-cols-2 gap-2 lg:grid-cols-3"},ir.map((e=>{const t=e.title||e.cmd.title;return r.createElement(Rn.Z,{key:t,onClick:()=>{i(e.cmd,e.params),Vn("debug",t)}},t)}))),r.createElement("label",{className:Fn.Z.inputLabel},r.createElement("span",null,"Result:"),r.createElement("textarea",{rows:"3",defaultValue:n,readOnly:!0})))};ar.propTypes={device:i().object.isRequired};var sr=ar,lr=n(3409),cr={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=b()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};cr.domAPI=v(),cr.insertStyleElement=w(),f()(lr.Z,cr);var ur=lr.Z&&lr.Z.locals?lr.Z.locals:void 0;const dr=(0,a.Pi)((()=>{const{work:e,planning:t}=(0,r.useContext)(u),[n,o]=(0,r.useState)(e.estimate({motions:t.motions})),i=(0,r.useRef)();return(0,r.useEffect)((()=>(clearTimeout(i.current),i.current=setTimeout((()=>{o(e.estimate({motions:t.motions}))}),100),()=>{clearTimeout(i.current)}))),n?r.createElement("section",{className:"grid grid-cols-1 gap-4"},r.createElement(On.Z,{type:"info"},"Estimated total plotting time: ",(0,An.mr)(n/1e3))):null}));dr.propTypes={};var pr=dr;function mr(){return(mr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const hr=(0,a.Pi)((({...e})=>{const{planning:t,work:n}=(0,r.useContext)(u),o=n.device.get(),i=n.plottingInProgress.get(),[a,s]=(0,r.useState)(null);return(0,r.useEffect)((()=>(n.setDevice(a),()=>{null==a||a.disconnectDevice()})),[a]),r.createElement(Qn,mr({active:t.phase===qt},e),!o&&r.createElement("section",{className:"space-y-4"},r.createElement("h3",null,"Plotting"),r.createElement(On.Z,{type:"warn"},"Please connect to device before plotting."),r.createElement("div",{className:"grid grid-cols-2 gap-4"},r.createElement(Rn.Z,{onClick:()=>{t.setPhase(_t),Vn("go to",_t)}},"Back to planning"),r.createElement(Rn.Z,{onClick:()=>{t.setPhase(zt),Vn("go to",zt)}},"Start new plot"))),r.createElement(or.Z,{onConnected:e=>s(e),onDisconnected:()=>s(null)}),o&&r.createElement("section",{className:"space-y-4"},r.createElement("h3",null,"Plotting"),r.createElement("form",{className:ur.form,onSubmit:e=>{e.preventDefault(),i||(Vn("control","plot"),n.plot({motions:t.motions}))}},r.createElement("label",{className:"mr-2"},"Constant"),r.createElement("div",{className:"flex items-center"},r.createElement("label",{className:m()(Fn.Z.radioLabel,"mr-2")},r.createElement("input",{type:"radio",value:It,disabled:n.plotterStatus!==kt,checked:n.speedMode===It,onChange:()=>{n.setSpeedMode(It)}}),r.createElement("span",null,"Velocity"))," ",r.createElement("label",{className:Fn.Z.radioLabel},r.createElement("input",{type:"radio",value:Dt,disabled:n.plotterStatus!==kt,checked:n.speedMode===Dt,onChange:()=>{n.setSpeedMode(Dt)}}),r.createElement("span",null,"Acceleration"))),n.speedMode===Dt&&r.createElement(r.Fragment,null,r.createElement("h4",{className:"col-span-2"},"Moving Optimization"),r.createElement("label",{htmlFor:"motion-accel"},"Acceleration"),r.createElement("input",{id:"motion-accel",type:"number",min:"100",step:"100",max:"100000",value:n.penDownMoveAccel.get(),onChange:e=>n.setPenDownMoveAccel(parseInt(e.target.value,10))}),r.createElement("label",{htmlFor:"motion-cornering"},"Cornering"),r.createElement("input",{id:"motion-cornering",type:"number",min:"0.01",step:"0.01",max:"2",value:n.cornering.get(),onChange:e=>n.setCornering(parseFloat(e.target.value))})),r.createElement("h4",{className:"col-span-2"},"Moving Speed"," ",n.speedMode===Dt&&"(Max)"),r.createElement("label",{htmlFor:"pen-up-speed"},"Pen Up"),r.createElement("input",{id:"pen-up-speed",type:"number",min:"1000",step:"100",max:"20000",value:n.penUpMoveSpeed.get(),onChange:e=>n.setPenUpMoveSpeed(parseInt(e.target.value,10))}),r.createElement("label",{htmlFor:"pen-down-speed"},"Pen Down"),r.createElement("input",{id:"pen-down-speed",type:"number",min:"1000",step:"100",max:"20000",value:n.penDownMoveSpeed.get(),onChange:e=>n.setPenDownMoveSpeed(parseInt(e.target.value,10))}),r.createElement("h4",{className:"col-span-2"},"Pen Servo Control"),r.createElement("label",{htmlFor:"servo-min"},"Pen Up"),r.createElement("input",{id:"servo-min",type:"number",min:n.servoMax.get(),step:"100",max:"32000",value:n.servoMin.get(),onChange:e=>n.setServoMin(parseInt(e.target.value,10))}),r.createElement("label",{htmlFor:"servo-max"},"Pen Down"),r.createElement("input",{id:"servo-max",type:"number",min:"12000",step:"100",max:n.servoMin.get(),value:n.servoMax.get(),onChange:e=>n.setServoMax(parseInt(e.target.value,10))}),r.createElement("div",{className:"col-start-2"},n.plotterStatus===kt&&r.createElement(Rn.Z,{variant:"primary",submit:!0},"Start"),r.createElement("div",{className:"grid grid-cols-2 gap-4"},n.plotterStatus===Zt&&r.createElement(Rn.Z,{onClick:()=>{n.pause(),Vn("control","pause")},disabled:null!==n.control.get()},"Pause"),n.plotterStatus===Tt&&r.createElement(Rn.Z,{onClick:()=>{n.resume(),Vn("control","resume")}},"Resume"),n.plotterStatus!==kt&&r.createElement(Rn.Z,{onClick:()=>{n.stop(),Vn("control","stop")},disabled:null!==n.control.get()},"Stop"))))),r.createElement(pr,null),o&&n.plotterStatus===kt&&r.createElement(sr,{device:o}))}));hr.propTypes={};var fr=hr,gr=n(4807);const vr=(0,yt.ky)({size:un,padding:un.defaultPadding,orientation:en,alignment:{vertical:nn,horizontal:an},contentFitPage:!0,get width(){return this.orientation===en?this.size.width:this.size.height},get height(){return this.orientation===en?this.size.height:this.size.width},setSize(e){this.size=e,this.padding=e.defaultPadding},setPadding(e){this.padding=e},setOrientation(e){this.orientation=e},setAlignmentVertical(e){this.alignment.vertical=e},setAlignmentHorizontal(e){this.alignment.horizontal=e},setContentFitPage(e){this.contentFitPage=e},get contentPreserveAspectRatio(){return`${{[sn]:"xMin",[an]:"xMid",[ln]:"xMax"}[this.alignment.horizontal]}${{[rn]:"YMin",[nn]:"YMid",[on]:"YMax"}[this.alignment.vertical]} meet`},get screenToPageMatrix(){const e=l(1),t=new DOMMatrix;if(t.scaleSelf(e),this.orientation===en)return t;const n=new DOMMatrix;n.translateSelf(-this.size.height,0);const r=new DOMMatrix;return r.rotateSelf(0,0,-90),r.multiply(n).multiply(t)},get pageToScreenMatrix(){return this.screenToPageMatrix.inverse()}}),yr=(0,yt.ky)({svgContent:null,filename:null,fileInfo:null,lines:null,motions:null,previewStrokeWidth:.4,setPreviewStrokeWidth(e){this.previewStrokeWidth=e},phase:zt,setPhase(e){this.phase=e},loadFromUrl(e){fetch(e).then((e=>e.text())).then((t=>{(0,yt.z)((()=>{const n=e.split("/").pop();this.loadSVGContent(n.split(/\.svg/i)[0],t)}))}))},loadFromFile(e){const t=new FileReader;t.onload=t=>{(0,yt.z)((()=>{this.loadSVGContent(e.name,t.target.result)}))},t.readAsText(e)},loadSVGContent(e,t){this.filename=e.split(/\.svg/i)[0],this.svgContent=t,this.lines=null,this.motions=null},updateFileInfo(e){this.fileInfo=e},updateLines(e){this.lines=e,this.motions=null},planMotion(e){var t;if(null===(t=this.lines)||void 0===t||!t.length)throw new Error("Lines are not ready");this.motions=function(e,t={}){const n={...Ot,...t};n.lindGroupId=0;let r=null,o=[],i=null;for(const t of function*(e,t){if(!e||!e.length)return;const{screenToPageMatrix:n}=t,r=([e,t])=>q(e,t,n),o=s(t.planAhead);let i=0;for(let n=0,s=e.length;n<s;){var a;const s=[e[n]];let l=0,c=1;for(;l<o;){const t=e[n+c];if(!t)break;l+=B(t[0],t[1]),s.push(t),c+=1}const u=yield*Rt(s,r,t);n+=u.skip,i+=null!==(a=u.reduced)&&void 0!==a?a:0}D.debug(`Reduced lines ${i}`)}(e,n))r!==t.groupId&&(i=[],o.push(i),r=t.groupId),i.push(t.line);n.allowReorder&&(o=function(e){const t=Pt(2,4),n={};let r=1;function o(e,t){const o={id:r,mbr:(i=e,{p0:[...i],p1:[...i]}),groupId:t};var i;return n[r]=o,r+=1,o}e.forEach(((e,n)=>{const r=o(e[0][0],n),i=o(e[e.length-1][1],n);r.pairId=i.id,t.insert(r),i.pairId=r.id,i.isEndPoint=!0,t.insert(i)}));const i={pos:[0,0]},a=[];for(;;){const e=t.nnSearch(i.pos);if(!e)break;const r=n[e];t.remove(r);const o=n[r.pairId];t.remove(o);const s={id:r.groupId};r.isEndPoint&&(s.revert=!0),a.push(s),i.pos=o.mbr.p0}return a.map((t=>t.revert?e[t.id].reverse().map((([e,t])=>[t,e])):e[t.id]))}(o));const a=[];let l=[0,0];const c=t.connectedError*t.connectedError;for(const e of o){const t=e[0][0];!G(l,t)&&V(l,t)>c&&a.push({line:[l,t],pen:1}),a.push(...e.map((e=>({line:e,pen:0})))),l=e[e.length-1][1]}return a.push({line:[l,[0,0]],pen:1}),a}(this.lines,e)},get linesInfo(){var e;return{lines:(null===(e=this.lines)||void 0===e?void 0:e.length)||0}},get motionsInfo(){var e;const t={penDown:0,penUp:0};return(null===(e=this.motions)||void 0===e?void 0:e.reduce(((e,t)=>(e[0===t.pen?"penDown":"penUp"]+=1,e)),t))||t},get linesAsPathDef(){var e;return Lt(null===(e=this.motions)||void 0===e?void 0:e.filter((e=>0===e.pen)).map((e=>e.line)))},get connections(){var e;return(null===(e=this.motions)||void 0===e?void 0:e.filter((e=>1===e.pen)).map((e=>e.line)))||[]},get connectionsAsPathDef(){return Lt(this.connections)}},null,{name:"axidraw-web-work",deep:!1}),br=(0,yt.ky)({device:yt.LO.box(null,{deep:!1}),async setDevice(e){if(this.device.set(e),e){const t=this.servoMin.get(),n=this.servoMax.get(),r=this.servoRate.get(),o=Sn(t,n,r);await e.executeCommand(bn.sc,4,t),await e.executeCommand(bn.sc,5,n),await e.executeCommand(bn.sc,10,r),await e.executeCommand(bn.sp,1,o)}const t=this.plottingInProgress.get();!e&&t&&(t.return(),this.plottingInProgress.set(null))},speedMode:Dt,setSpeedMode(e){this.speedMode=e},servoMin:yt.LO.box(2e4),async setServoMin(e){this.servoMin.set(e)},servoMax:yt.LO.box(16e3),async setServoMax(e){this.servoMax.set(e)},servoRate:yt.LO.box(400),async setServoRate(e){this.servoRate.set(e)},penDownMoveAccel:yt.LO.box(4e4),penDownMoveSpeed:yt.LO.box(5e3),penUpMoveSpeed:yt.LO.box(1e4),cornering:yt.LO.box(.1),setPenDownMoveAccel(e){this.penDownMoveAccel.set(e)},setPenDownMoveSpeed(e){this.penDownMoveSpeed.set(e)},setPenUpMoveSpeed(e){this.penUpMoveSpeed.set(e)},setCornering(e){this.cornering.set(e)},control:yt.LO.box(null),plotterStatus:kt,plottingInProgress:yt.LO.box(null,{deep:!1}),estimate({motions:e}){return e?function({speedMode:e,servoMin:t,servoMax:n,servoRate:r,penUpMoveSpeed:o,penDownMoveSpeed:i,penDownMoveAccel:a,cornering:s,motions:l}){const c={...Dn},u={min:t.get(),max:n.get(),rate:r.get()};let d=0;try{for(let t=0,n=l.length;t<n;t+=1){const{line:n,pen:r}=l[t],p=r,m=n;if(0===V(m[0],m[1]))continue;c.pen!==p&&(d+=Sn(u.min,u.max,u.rate),c.pen=p,c.rate=0);const h=0===p?i.get():o.get(),f=Cn({x:m[1][0],y:m[1][1]}),g=f.a1-c.a1,v=f.a2-c.a2,y=Math.sqrt(g**2+v**2);let b=0,x=0,w=0;if(e===It){const e=Math.abs(g),t=Math.abs(v),n=1310*e,r=1310*t;if(b=Math.ceil(y/h*1e3),b>n&&b>r&&(b=Math.max(n,r)),b>n&&e>0)for(const{time:e,remaining:t}of Pn({t:b,stepLong:v,stepShort:g}))d+=e,w=t;else if(b>r&&t>0)for(const{time:e,remaining:t}of Pn({t:b,stepLong:g,stepShort:v}))d+=e,x=t;else b>0&&(d+=b);c.rate=h}else{const e=a.get(),n=Tn(l,t,c.rate,h,e,y,{cornering:s.get()}),r=Zn(y,c.rate,h,n,e),{LMParams:o,remaining:i,endRate:u}=Nn($n(r),g,v);for(const{time:e}of o)d+=e;x=i.a1,w=i.a2,b=1e3*r.reduce(((e,t)=>e+t.t),0),c.rate=u}c.a1=f.a1-x,c.a2=f.a2-w}}catch(e){D.error(e)}return d}({motions:e,speedMode:this.speedMode,servoMin:this.servoMin,servoMax:this.servoMax,servoRate:this.servoRate,penDownMoveAccel:this.penDownMoveAccel,penUpMoveSpeed:this.penUpMoveSpeed,penDownMoveSpeed:this.penDownMoveSpeed,cornering:this.cornering}):0},async plot({motions:e}){const t=this.device.get();if(!t)throw new Error("Device is not connect.");const n=async function*({device:e,speedMode:t,servoMin:n,servoMax:r,servoRate:o,penUpMoveSpeed:i,penDownMoveSpeed:a,penDownMoveAccel:s,cornering:l,motions:c,control:u}){let d=null;const p={min:n.get(),max:r.get(),rate:o.get()},m=async(t=!0)=>{d={...In},await e.executeCommand(bn.r),t&&(await e.executeCommand(bn.sc,4,n.get()),await e.executeCommand(bn.sc,5,r.get()),await e.executeCommand(bn.sc,10,o.get())),await e.executeCommand(bn.sp,1,Sn(p.min,p.max,p.rate)),await e.executeCommand(bn.sr,6e4)};await m(!0);let h=0;try{for(let m=0,f=c.length;m<f;m+=1){p.min!==n.get()&&(await e.executeCommand(bn.sc,4,n.get()),p.min=n.get(),D.debug(`update servo min: ${p.min}`)),p.max!==r.get()&&(await e.executeCommand(bn.sc,5,r.get()),p.max=r.get(),D.debug(`update servo max: ${p.max}`)),p.rate!==o.get()&&(await e.executeCommand(bn.sc,10,o.get()),p.rate=o.get(),D.debug(`update servo rate: ${p.rate}`));const{line:f,pen:g}=c[m];let v=u.get();(await e.executeCommand(bn.qb)||v===$t)&&(D.debug("action: pause"),await e.executeCommand(bn.sp,1,Sn(p.min,p.max,p.rate)),d.pen=1,v=yield Tt);const y=v===Nt;y&&D.debug("action: stop");const b=y?1:g,{x:x,y:w}=wn(d),E=y?[[x,w],[0,0]]:f;if(0===V(E[0],E[1]))continue;d.pen!==b&&(D.debug("pen "+(1===b?"up":"down")),await e.executeCommand(bn.sp,b,Sn(p.min,p.max,p.rate)),d.pen=b,d.rate=0);const M=0===b?a.get():i.get(),C=Cn({x:E[1][0],y:E[1][1]}),S=C.a1-d.a1,A=C.a2-d.a2,P=Math.sqrt(S**2+A**2);let k=0,T=0,Z=0;if(t===It){const t=Math.abs(S),n=Math.abs(A),r=1310*t,o=1310*n;if(k=Math.ceil(P/M*1e3),k>r&&k>o&&(k=Math.max(r,o)),k>r&&t>0){D.warn(`Vertical edge occurs: SM,${k},${S},${A}`);for(const{longStep:t,shortStep:n,time:r,remaining:o}of Pn({t:k,stepLong:A,stepShort:S}))await e.executeCommand(bn.sm,r,n,t),Z=o}else if(k>o&&n>0){D.warn(`Horizontal edge occurs: SM,${k},${S},${A}`);for(const{longStep:t,shortStep:n,time:r,remaining:o}of Pn({t:k,stepLong:S,stepShort:A}))await e.executeCommand(bn.sm,r,t,n),T=o}else k>0&&(D.debug(`step-move: ${S}, ${A} in ${k}ms`),await e.executeCommand(bn.sm,k,S,A));d.rate=M}else{const t=s.get(),n=Tn(c,m,d.rate,M,t,P,{cornering:l.get()}),r=Zn(P,d.rate,M,n,t),{LMParams:o,remaining:i,endRate:a}=Nn($n(r),S,A);for(const{initRate1:t,step1:n,accel1:r,initRate2:i,step2:a,accel2:s}of o)await e.executeCommand(bn.lm,t,n,r,i,a,s,3);T=i.a1,Z=i.a2,k=1e3*r.reduce(((e,t)=>e+t.t),0),d.rate=a}if((T||Z)&&D.debug(`remaining: ${T}, ${Z}`),d.a1=C.a1-T,d.a2=C.a2-Z,h=k,y){D.debug("stop plotting");break}}h+=3e3,D.debug(`pen is homing: ${h}`),await(0,An.gw)(h)}catch(e){D.error(e)}finally{await m(!1),D.debug("finished plotting")}return kt}({device:t,motions:e,speedMode:this.speedMode,servoMin:this.servoMin,servoMax:this.servoMax,servoRate:this.servoRate,penDownMoveAccel:this.penDownMoveAccel,penUpMoveSpeed:this.penUpMoveSpeed,penDownMoveSpeed:this.penDownMoveSpeed,cornering:this.cornering,control:this.control});this.plottingInProgress.set(n),await this.resume()},async resume({action:e}={}){const t=this.plottingInProgress.get();if(!t)return;this.plotterStatus=Zt;const n=await t.next(e);this.plotterStatus=n.value,this.control.set(null),n.done&&(this.plottingInProgress.set(null),this.device.get().disconnectDevice())},pause(){this.control.set($t)},async stop(){this.plotterStatus===Tt?this.resume({action:Nt}):this.control.set(Nt)}});var xr=()=>r.createElement(u.Provider,{value:{planning:yr,page:vr,work:br}},r.createElement("main",{className:yn.workspace},r.createElement(fn,null),r.createElement(gr.Z,null)),r.createElement("aside",{className:yn.panel},r.createElement(Xn,null),r.createElement(rr,null),r.createElement(fr,null)))},9062:function(e,t,n){"use strict";n.d(t,{gw:function(){return r},Vs:function(){return o},mr:function(){return i}});const r=e=>new Promise((t=>{setTimeout(t,e)})),o=(e,t)=>new Promise(((n,r)=>{setTimeout((()=>{r(new Error(t))}),e)})),i=e=>{if(!e)return"0m0s";let t=0|e;const n=t%60;t=e/60|0;const r=t%60;t=r/60|0;const o=t%60;return t=o/60|0,t?"more than 1 hour":o?`${o}h${r}m${n}s`:`${r}m${n}s`}},7446:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,'._10ryd{bottom:0;left:0;position:absolute;right:0;top:0}._10ryd>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}._10ryd{display:none;overflow-y:scroll;padding-left:2rem;padding-right:2rem}._10ryd:after,._10ryd:before{content:"";height:2rem}._2RtXA,._10ryd:after,._10ryd:before{display:block}',""]),o.locals={root:"_10ryd",active:"_2RtXA"},t.Z=o},7536:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,"._3eMFG{align-items:center;display:grid;gap:1rem;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;margin-bottom:1rem}",""]),o.locals={form:"_3eMFG"},t.Z=o},3409:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,"._3iEUx{align-items:center;display:grid;gap:1rem;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;margin-bottom:1rem}",""]),o.locals={form:"_3iEUx"},t.Z=o},3848:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,"._11H5z{align-items:center;display:grid;gap:1rem;grid-template-columns:-webkit-max-content 1fr;grid-template-columns:max-content 1fr;margin-bottom:1rem}",""]),o.locals={inputs:"_11H5z"},t.Z=o},9930:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,"._2uf5o{fill:none}._1w0lW{stroke-width:1mm;stroke-linejoin:round;stroke-linecap:round}.uNj6-{stroke:red}._25v8K{stroke:#0f0}._2lXdL{fill:#00f}",""]),o.locals={root:"_2uf5o",axis:"_1w0lW",x:"uNj6-",y:"_25v8K",z:"_2lXdL"},t.Z=o},306:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,".VetUz{fill:rgba(0,0,0,.25)}.Iwi1G{fill:#fff}.Iwi1G.CZ6FL{fill:#eef}._1Q1eR{fill:none;stroke:#b8b8b8;stroke-width:.4mm;stroke-dasharray:5 5}",""]),o.locals={shadow:"VetUz",paper:"Iwi1G",dropping:"CZ6FL",printable:"_1Q1eR"},t.Z=o},3273:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,":root{--planning-stroke-width:1}.py2vP{stroke-width:var(--planning-stroke-width);stroke-linecap:round;stroke-linejoin:round;fill:none}._1iEPV{stroke:#e2e2e2}._3HiNq{stroke:#333}",""]),o.locals={root:"py2vP",motionPenUp:"_1iEPV",motionPenDown:"_3HiNq"},t.Z=o},2849:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,"._1MCds *{stroke:#333!important}",""]),o.locals={root:"_1MCds"},t.Z=o},518:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,"._1VH7z{height:calc(100% - 70px);width:100%}",""]),o.locals={root:"_1VH7z"},t.Z=o},4697:function(e,t,n){"use strict";var r=n(3645),o=n.n(r)()((function(e){return e[1]}));o.push([e.id,"._3w6hI{right:0;right:450px}._3jRw_,._3w6hI{bottom:0;left:0;position:fixed;top:0}._3jRw_{background-color:#efefef;font-size:1rem;left:auto;line-height:1.5rem;right:0;width:450px}",""]),o.locals={workspace:"_3w6hI",panel:"_3jRw_"},t.Z=o}}]);